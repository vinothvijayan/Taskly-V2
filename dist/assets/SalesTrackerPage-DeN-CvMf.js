var Os=Object.defineProperty;var Fs=(n,r,e)=>r in n?Os(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e;var p=(n,r,e)=>Fs(n,typeof r!="symbol"?r+"":r,e);import{c as lt,t as it,a as je,m as As,b as Hs,d as Ls,e as Mn,s as gt,j as t,f as dt,T as $s,g as _s,h as $t,i as _t,P as ot,C as Rn,U as Ge,k as ze,l as Ue,n as Ye,o as qe,B as W,p as Et,r as N,A as Mt,q as Rt,u as Pt,S as zs,v as rt,w as pe,X as Pn,L as yt,M as Us,x as Ke,y as nn,z as sn,D as Ie,E as an,F as ut,G as Ys,R as j,H as qs,I as Bs,O as Ws,J as Qs,K as Vs,N as Xs,Q as Ot,V as On,W as rn,Y as ln,Z as Fn,_ as An,$ as Hn,a0 as Ln,a1 as Gs,a2 as $n,a3 as Ks,a4 as Zs,a5 as Js,a6 as ea,a7 as _n,a8 as zn,a9 as ta,aa as Te,ab as Se,ac as hn,ad as at,ae as na,af as sa,ag as aa,ah as zt,ai as ra,aj as ia,ak as Ut,al as la,am as oa}from"./index-CIyudF9t.js";import{T as ca,a as da,b as fn,c as He,d as ua,e as Le,r as ma,u as kt,w as ha}from"./xlsx-DJeG-6lL.js";import{g as fa,s as Un,a as xa,b as pa,l as xn,i as ga,w as pn,c as wa,f as ge}from"./format-CrtYonqb.js";import{T as Yn}from"./trending-up-CNy9roDy.js";import{T as ya}from"./textarea-D92HBPlJ.js";import{A as Tt}from"./index-FV4twmxk.js";import{S as ba,A as qn,a as Bn,b as Wn,c as Qn,d as Vn,e as Xn,f as Gn,g as Kn,u as Zn,h as Jn,P as es,D as ts,i as va,j as Ft,k as ns,v as ss,C as as}from"./alert-dialog-X9brdY__.js";import{S as rs}from"./save-C8XAIkYW.js";import{C as is}from"./calendar-HIZ4iU5R.js";import{S as St}from"./separator-BKX0jZPM.js";import{D as ls}from"./download-oltLK3aY.js";import{S as gn,a as ja,C as Na}from"./skeletons-_JGSiiy5.js";import{R as os,a as wt,b as Gt}from"./resizable-CGjVgm2S.js";import{U as wn,F as cs}from"./upload-C2OkWRCf.js";import{g as ds,s as Kt,a as us,e as Ca}from"./en-US-PHonLEz-.js";import"./startOfMonth-DUJ2JjBB.js";import"./subDays-gmpfwhzv.js";import"./chevron-left-D9T-5X23.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],Da=lt("chevrons-right",ka);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Sa=lt("circle-play",Ta);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ea=lt("funnel",Ia);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ra=lt("hash",Ma);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Oa=lt("phone-call",Pa);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],Aa=lt("phone-off",Fa);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],La=lt("user-check",Ha);function $a(){return Object.assign({},ds())}function _a(n){let e=it(n).getDay();return e===0&&(e=7),e}function za(n,r){const e=r instanceof Date?je(r,0):new r(0);return e.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),e.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),e}const Ua=10;class ms{constructor(){p(this,"subPriority",0)}validate(r,e){return!0}}class Ya extends ms{constructor(r,e,s,a,i){super(),this.value=r,this.validateValue=e,this.setValue=s,this.priority=a,i&&(this.subPriority=i)}validate(r,e){return this.validateValue(r,this.value,e)}set(r,e,s){return this.setValue(r,e,this.value,s)}}class qa extends ms{constructor(){super(...arguments);p(this,"priority",Ua);p(this,"subPriority",-1)}set(e,s){return s.timestampIsSet?e:je(e,za(e,Date))}}class q{run(r,e,s,a){const i=this.parse(r,e,s,a);return i?{setter:new Ya(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(r,e,s){return!0}}class Ba extends q{constructor(){super(...arguments);p(this,"priority",140);p(this,"incompatibleTokens",["R","u","t","T"])}parse(e,s,a){switch(s){case"G":case"GG":case"GGG":return a.era(e,{width:"abbreviated"})||a.era(e,{width:"narrow"});case"GGGGG":return a.era(e,{width:"narrow"});case"GGGG":default:return a.era(e,{width:"wide"})||a.era(e,{width:"abbreviated"})||a.era(e,{width:"narrow"})}}set(e,s,a){return s.era=a,e.setFullYear(a,0,1),e.setHours(0,0,0,0),e}}const ce={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},$e={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function de(n,r){return n&&{value:r(n.value),rest:n.rest}}function se(n,r){const e=r.match(n);return e?{value:parseInt(e[0],10),rest:r.slice(e[0].length)}:null}function _e(n,r){const e=r.match(n);if(!e)return null;if(e[0]==="Z")return{value:0,rest:r.slice(1)};const s=e[1]==="+"?1:-1,a=e[2]?parseInt(e[2],10):0,i=e[3]?parseInt(e[3],10):0,l=e[5]?parseInt(e[5],10):0;return{value:s*(a*As+i*Hs+l*Ls),rest:r.slice(e[0].length)}}function hs(n){return se(ce.anyDigitsSigned,n)}function ie(n,r){switch(n){case 1:return se(ce.singleDigit,r);case 2:return se(ce.twoDigits,r);case 3:return se(ce.threeDigits,r);case 4:return se(ce.fourDigits,r);default:return se(new RegExp("^\\d{1,"+n+"}"),r)}}function It(n,r){switch(n){case 1:return se(ce.singleDigitSigned,r);case 2:return se(ce.twoDigitsSigned,r);case 3:return se(ce.threeDigitsSigned,r);case 4:return se(ce.fourDigitsSigned,r);default:return se(new RegExp("^-?\\d{1,"+n+"}"),r)}}function on(n){switch(n){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function fs(n,r){const e=r>0,s=e?r:1-r;let a;if(s<=50)a=n||100;else{const i=s+50,l=Math.trunc(i/100)*100,o=n>=i%100;a=n+l-(o?100:0)}return e?a:1-a}function xs(n){return n%400===0||n%4===0&&n%100!==0}class Wa extends q{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(e,s,a){const i=l=>({year:l,isTwoDigitYear:s==="yy"});switch(s){case"y":return de(ie(4,e),i);case"yo":return de(a.ordinalNumber(e,{unit:"year"}),i);default:return de(ie(s.length,e),i)}}validate(e,s){return s.isTwoDigitYear||s.year>0}set(e,s,a){const i=e.getFullYear();if(a.isTwoDigitYear){const o=fs(a.year,i);return e.setFullYear(o,0,1),e.setHours(0,0,0,0),e}const l=!("era"in s)||s.era===1?a.year:1-a.year;return e.setFullYear(l,0,1),e.setHours(0,0,0,0),e}}class Qa extends q{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(e,s,a){const i=l=>({year:l,isTwoDigitYear:s==="YY"});switch(s){case"Y":return de(ie(4,e),i);case"Yo":return de(a.ordinalNumber(e,{unit:"year"}),i);default:return de(ie(s.length,e),i)}}validate(e,s){return s.isTwoDigitYear||s.year>0}set(e,s,a,i){const l=fa(e,i);if(a.isTwoDigitYear){const m=fs(a.year,l);return e.setFullYear(m,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Kt(e,i)}const o=!("era"in s)||s.era===1?a.year:1-a.year;return e.setFullYear(o,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Kt(e,i)}}class Va extends q{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(e,s){return It(s==="R"?4:s.length,e)}set(e,s,a){const i=je(e,0);return i.setFullYear(a,0,4),i.setHours(0,0,0,0),Un(i)}}class Xa extends q{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(e,s){return It(s==="u"?4:s.length,e)}set(e,s,a){return e.setFullYear(a,0,1),e.setHours(0,0,0,0),e}}class Ga extends q{constructor(){super(...arguments);p(this,"priority",120);p(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,s,a){switch(s){case"Q":case"QQ":return ie(s.length,e);case"Qo":return a.ordinalNumber(e,{unit:"quarter"});case"QQQ":return a.quarter(e,{width:"abbreviated",context:"formatting"})||a.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return a.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(e,{width:"wide",context:"formatting"})||a.quarter(e,{width:"abbreviated",context:"formatting"})||a.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,s){return s>=1&&s<=4}set(e,s,a){return e.setMonth((a-1)*3,1),e.setHours(0,0,0,0),e}}class Ka extends q{constructor(){super(...arguments);p(this,"priority",120);p(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,s,a){switch(s){case"q":case"qq":return ie(s.length,e);case"qo":return a.ordinalNumber(e,{unit:"quarter"});case"qqq":return a.quarter(e,{width:"abbreviated",context:"standalone"})||a.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return a.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(e,{width:"wide",context:"standalone"})||a.quarter(e,{width:"abbreviated",context:"standalone"})||a.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,s){return s>=1&&s<=4}set(e,s,a){return e.setMonth((a-1)*3,1),e.setHours(0,0,0,0),e}}class Za extends q{constructor(){super(...arguments);p(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);p(this,"priority",110)}parse(e,s,a){const i=l=>l-1;switch(s){case"M":return de(se(ce.month,e),i);case"MM":return de(ie(2,e),i);case"Mo":return de(a.ordinalNumber(e,{unit:"month"}),i);case"MMM":return a.month(e,{width:"abbreviated",context:"formatting"})||a.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return a.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(e,{width:"wide",context:"formatting"})||a.month(e,{width:"abbreviated",context:"formatting"})||a.month(e,{width:"narrow",context:"formatting"})}}validate(e,s){return s>=0&&s<=11}set(e,s,a){return e.setMonth(a,1),e.setHours(0,0,0,0),e}}class Ja extends q{constructor(){super(...arguments);p(this,"priority",110);p(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(e,s,a){const i=l=>l-1;switch(s){case"L":return de(se(ce.month,e),i);case"LL":return de(ie(2,e),i);case"Lo":return de(a.ordinalNumber(e,{unit:"month"}),i);case"LLL":return a.month(e,{width:"abbreviated",context:"standalone"})||a.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return a.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(e,{width:"wide",context:"standalone"})||a.month(e,{width:"abbreviated",context:"standalone"})||a.month(e,{width:"narrow",context:"standalone"})}}validate(e,s){return s>=0&&s<=11}set(e,s,a){return e.setMonth(a,1),e.setHours(0,0,0,0),e}}function er(n,r,e){const s=it(n),a=xa(s,e)-r;return s.setDate(s.getDate()-a*7),s}class tr extends q{constructor(){super(...arguments);p(this,"priority",100);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(e,s,a){switch(s){case"w":return se(ce.week,e);case"wo":return a.ordinalNumber(e,{unit:"week"});default:return ie(s.length,e)}}validate(e,s){return s>=1&&s<=53}set(e,s,a,i){return Kt(er(e,a,i),i)}}function nr(n,r){const e=it(n),s=pa(e)-r;return e.setDate(e.getDate()-s*7),e}class sr extends q{constructor(){super(...arguments);p(this,"priority",100);p(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(e,s,a){switch(s){case"I":return se(ce.week,e);case"Io":return a.ordinalNumber(e,{unit:"week"});default:return ie(s.length,e)}}validate(e,s){return s>=1&&s<=53}set(e,s,a){return Un(nr(e,a))}}const ar=[31,28,31,30,31,30,31,31,30,31,30,31],rr=[31,29,31,30,31,30,31,31,30,31,30,31];class ir extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"subPriority",1);p(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(e,s,a){switch(s){case"d":return se(ce.date,e);case"do":return a.ordinalNumber(e,{unit:"date"});default:return ie(s.length,e)}}validate(e,s){const a=e.getFullYear(),i=xs(a),l=e.getMonth();return i?s>=1&&s<=rr[l]:s>=1&&s<=ar[l]}set(e,s,a){return e.setDate(a),e.setHours(0,0,0,0),e}}class lr extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"subpriority",1);p(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(e,s,a){switch(s){case"D":case"DD":return se(ce.dayOfYear,e);case"Do":return a.ordinalNumber(e,{unit:"date"});default:return ie(s.length,e)}}validate(e,s){const a=e.getFullYear();return xs(a)?s>=1&&s<=366:s>=1&&s<=365}set(e,s,a){return e.setMonth(0,a),e.setHours(0,0,0,0),e}}function cn(n,r,e){var u,w,k,H;const s=ds(),a=(e==null?void 0:e.weekStartsOn)??((w=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:w.weekStartsOn)??s.weekStartsOn??((H=(k=s.locale)==null?void 0:k.options)==null?void 0:H.weekStartsOn)??0,i=it(n),l=i.getDay(),m=(r%7+7)%7,c=7-a,d=r<0||r>6?r-(l+c)%7:(m+c)%7-(l+c)%7;return Mn(i,d)}class or extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(e,s,a){switch(s){case"E":case"EE":case"EEE":return a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return a.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return a.day(e,{width:"wide",context:"formatting"})||a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"})}}validate(e,s){return s>=0&&s<=6}set(e,s,a,i){return e=cn(e,a,i),e.setHours(0,0,0,0),e}}class cr extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(e,s,a,i){const l=o=>{const m=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+m};switch(s){case"e":case"ee":return de(ie(s.length,e),l);case"eo":return de(a.ordinalNumber(e,{unit:"day"}),l);case"eee":return a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"});case"eeeee":return a.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return a.day(e,{width:"wide",context:"formatting"})||a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"})}}validate(e,s){return s>=0&&s<=6}set(e,s,a,i){return e=cn(e,a,i),e.setHours(0,0,0,0),e}}class dr extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(e,s,a,i){const l=o=>{const m=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+m};switch(s){case"c":case"cc":return de(ie(s.length,e),l);case"co":return de(a.ordinalNumber(e,{unit:"day"}),l);case"ccc":return a.day(e,{width:"abbreviated",context:"standalone"})||a.day(e,{width:"short",context:"standalone"})||a.day(e,{width:"narrow",context:"standalone"});case"ccccc":return a.day(e,{width:"narrow",context:"standalone"});case"cccccc":return a.day(e,{width:"short",context:"standalone"})||a.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return a.day(e,{width:"wide",context:"standalone"})||a.day(e,{width:"abbreviated",context:"standalone"})||a.day(e,{width:"short",context:"standalone"})||a.day(e,{width:"narrow",context:"standalone"})}}validate(e,s){return s>=0&&s<=6}set(e,s,a,i){return e=cn(e,a,i),e.setHours(0,0,0,0),e}}function ur(n,r){const e=it(n),s=_a(e),a=r-s;return Mn(e,a)}class mr extends q{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(e,s,a){const i=l=>l===0?7:l;switch(s){case"i":case"ii":return ie(s.length,e);case"io":return a.ordinalNumber(e,{unit:"day"});case"iii":return de(a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"}),i);case"iiiii":return de(a.day(e,{width:"narrow",context:"formatting"}),i);case"iiiiii":return de(a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"}),i);case"iiii":default:return de(a.day(e,{width:"wide",context:"formatting"})||a.day(e,{width:"abbreviated",context:"formatting"})||a.day(e,{width:"short",context:"formatting"})||a.day(e,{width:"narrow",context:"formatting"}),i)}}validate(e,s){return s>=1&&s<=7}set(e,s,a){return e=ur(e,a),e.setHours(0,0,0,0),e}}class hr extends q{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(e,s,a){switch(s){case"a":case"aa":case"aaa":return a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return a.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(e,{width:"wide",context:"formatting"})||a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,s,a){return e.setHours(on(a),0,0,0),e}}class fr extends q{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(e,s,a){switch(s){case"b":case"bb":case"bbb":return a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return a.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(e,{width:"wide",context:"formatting"})||a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,s,a){return e.setHours(on(a),0,0,0),e}}class xr extends q{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["a","b","t","T"])}parse(e,s,a){switch(s){case"B":case"BB":case"BBB":return a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return a.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(e,{width:"wide",context:"formatting"})||a.dayPeriod(e,{width:"abbreviated",context:"formatting"})||a.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,s,a){return e.setHours(on(a),0,0,0),e}}class pr extends q{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["H","K","k","t","T"])}parse(e,s,a){switch(s){case"h":return se(ce.hour12h,e);case"ho":return a.ordinalNumber(e,{unit:"hour"});default:return ie(s.length,e)}}validate(e,s){return s>=1&&s<=12}set(e,s,a){const i=e.getHours()>=12;return i&&a<12?e.setHours(a+12,0,0,0):!i&&a===12?e.setHours(0,0,0,0):e.setHours(a,0,0,0),e}}class gr extends q{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(e,s,a){switch(s){case"H":return se(ce.hour23h,e);case"Ho":return a.ordinalNumber(e,{unit:"hour"});default:return ie(s.length,e)}}validate(e,s){return s>=0&&s<=23}set(e,s,a){return e.setHours(a,0,0,0),e}}class wr extends q{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["h","H","k","t","T"])}parse(e,s,a){switch(s){case"K":return se(ce.hour11h,e);case"Ko":return a.ordinalNumber(e,{unit:"hour"});default:return ie(s.length,e)}}validate(e,s){return s>=0&&s<=11}set(e,s,a){return e.getHours()>=12&&a<12?e.setHours(a+12,0,0,0):e.setHours(a,0,0,0),e}}class yr extends q{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(e,s,a){switch(s){case"k":return se(ce.hour24h,e);case"ko":return a.ordinalNumber(e,{unit:"hour"});default:return ie(s.length,e)}}validate(e,s){return s>=1&&s<=24}set(e,s,a){const i=a<=24?a%24:a;return e.setHours(i,0,0,0),e}}class br extends q{constructor(){super(...arguments);p(this,"priority",60);p(this,"incompatibleTokens",["t","T"])}parse(e,s,a){switch(s){case"m":return se(ce.minute,e);case"mo":return a.ordinalNumber(e,{unit:"minute"});default:return ie(s.length,e)}}validate(e,s){return s>=0&&s<=59}set(e,s,a){return e.setMinutes(a,0,0),e}}class vr extends q{constructor(){super(...arguments);p(this,"priority",50);p(this,"incompatibleTokens",["t","T"])}parse(e,s,a){switch(s){case"s":return se(ce.second,e);case"so":return a.ordinalNumber(e,{unit:"second"});default:return ie(s.length,e)}}validate(e,s){return s>=0&&s<=59}set(e,s,a){return e.setSeconds(a,0),e}}class jr extends q{constructor(){super(...arguments);p(this,"priority",30);p(this,"incompatibleTokens",["t","T"])}parse(e,s){const a=i=>Math.trunc(i*Math.pow(10,-s.length+3));return de(ie(s.length,e),a)}set(e,s,a){return e.setMilliseconds(a),e}}class Nr extends q{constructor(){super(...arguments);p(this,"priority",10);p(this,"incompatibleTokens",["t","T","x"])}parse(e,s){switch(s){case"X":return _e($e.basicOptionalMinutes,e);case"XX":return _e($e.basic,e);case"XXXX":return _e($e.basicOptionalSeconds,e);case"XXXXX":return _e($e.extendedOptionalSeconds,e);case"XXX":default:return _e($e.extended,e)}}set(e,s,a){return s.timestampIsSet?e:je(e,e.getTime()-us(e)-a)}}class Cr extends q{constructor(){super(...arguments);p(this,"priority",10);p(this,"incompatibleTokens",["t","T","X"])}parse(e,s){switch(s){case"x":return _e($e.basicOptionalMinutes,e);case"xx":return _e($e.basic,e);case"xxxx":return _e($e.basicOptionalSeconds,e);case"xxxxx":return _e($e.extendedOptionalSeconds,e);case"xxx":default:return _e($e.extended,e)}}set(e,s,a){return s.timestampIsSet?e:je(e,e.getTime()-us(e)-a)}}class kr extends q{constructor(){super(...arguments);p(this,"priority",40);p(this,"incompatibleTokens","*")}parse(e){return hs(e)}set(e,s,a){return[je(e,a*1e3),{timestampIsSet:!0}]}}class Dr extends q{constructor(){super(...arguments);p(this,"priority",20);p(this,"incompatibleTokens","*")}parse(e){return hs(e)}set(e,s,a){return[je(e,a),{timestampIsSet:!0}]}}const Tr={G:new Ba,y:new Wa,Y:new Qa,R:new Va,u:new Xa,Q:new Ga,q:new Ka,M:new Za,L:new Ja,w:new tr,I:new sr,d:new ir,D:new lr,E:new or,e:new cr,c:new dr,i:new mr,a:new hr,b:new fr,B:new xr,h:new pr,H:new gr,K:new wr,k:new yr,m:new br,s:new vr,S:new jr,X:new Nr,x:new Cr,t:new kr,T:new Dr},Sr=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ir=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Er=/^'([^]*?)'?$/,Mr=/''/g,Rr=/\S/,Pr=/[a-zA-Z]/;function yn(n,r,e,s){var S,Q,g,B;const a=$a(),i=a.locale??Ca,l=a.firstWeekContainsDate??((Q=(S=a.locale)==null?void 0:S.options)==null?void 0:Q.firstWeekContainsDate)??1,o=a.weekStartsOn??((B=(g=a.locale)==null?void 0:g.options)==null?void 0:B.weekStartsOn)??0;if(r==="")return n===""?it(e):je(e,NaN);const m={firstWeekContainsDate:l,weekStartsOn:o,locale:i},c=[new qa],d=r.match(Ir).map(y=>{const x=y[0];if(x in xn){const $=xn[x];return $(y,i.formatLong)}return y}).join("").match(Sr),u=[];for(let y of d){ga(y)&&pn(y,r,n),wa(y)&&pn(y,r,n);const x=y[0],$=Tr[x];if($){const{incompatibleTokens:le}=$;if(Array.isArray(le)){const F=u.find(L=>le.includes(L.token)||L.token===x);if(F)throw new RangeError(`The format string mustn't contain \`${F.fullToken}\` and \`${y}\` at the same time`)}else if($.incompatibleTokens==="*"&&u.length>0)throw new RangeError(`The format string mustn't contain \`${y}\` and any other token at the same time`);u.push({token:x,fullToken:y});const D=$.run(n,y,i.match,m);if(!D)return je(e,NaN);c.push(D.setter),n=D.rest}else{if(x.match(Pr))throw new RangeError("Format string contains an unescaped latin alphabet character `"+x+"`");if(y==="''"?y="'":x==="'"&&(y=Or(y)),n.indexOf(y)===0)n=n.slice(y.length);else return je(e,NaN)}}if(n.length>0&&Rr.test(n))return je(e,NaN);const w=c.map(y=>y.priority).sort((y,x)=>x-y).filter((y,x,$)=>$.indexOf(y)===x).map(y=>c.filter(x=>x.priority===y).sort((x,$)=>$.subPriority-x.subPriority)).map(y=>y[0]);let k=it(e);if(isNaN(k.getTime()))return je(e,NaN);const H={};for(const y of w){if(!y.validate(k,m))return je(e,NaN);const x=y.set(k,H,m);Array.isArray(x)?(k=x[0],Object.assign(H,x[1])):k=x}return je(e,k)}function Or(n){return n.match(Er)[1].replace(Mr,"'")}const Fr=()=>({interested:0,notInterested:0,followUp:0,callback:0,notPicked:0,sendDetails:0,totalCalls:0,duration:0}),Yt=(n,r)=>{const e={};let s=0,a=0,i=0;return n.forEach(l=>{l.callHistory.forEach(o=>{if(r!=="all"&&o.type!==r)return;const m=ge(gt(new Date(o.timestamp)),"yyyy-MM-dd");e[m]||(e[m]=Fr());const c=e[m];switch(c.totalCalls+=1,c.duration+=o.duration,s+=1,i+=o.duration,o.feedback){case"Interested":c.interested+=1,a+=1;break;case"Not Interested":c.notInterested+=1;break;case"Follow Up":c.followUp+=1;break;case"Callback":c.callback+=1;break;case"Not Picked":c.notPicked+=1;break;case"Send Details":c.sendDetails+=1;break}})}),{totalCalls:s,interested:a,totalDuration:i,avgDuration:s>0?Math.round(i/s):0,tableData:e}},jt=({title:n,value:r,subValue:e,icon:s,color:a})=>t.jsxs(ze,{className:"shadow-sm border-2",children:[t.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(Ye,{className:"text-sm font-medium text-muted-foreground",children:n}),t.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${a.replace("text-","bg-")}`,children:t.jsx(s,{className:`h-4 w-4 ${a}`})})]}),t.jsxs(qe,{children:[t.jsx("div",{className:"text-2xl font-bold",children:r}),e&&t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e})]})]}),bn=n=>{const r=Math.floor(n/3600),e=Math.floor(n%3600/60),s=n%60;return[r,e,s].map(a=>a.toString().padStart(2,"0")).join(":")},qt=({data:n,onDateClick:r,onDeleteDate:e})=>{const s=Object.keys(n.tableData).sort((a,i)=>new Date(i).getTime()-new Date(a).getTime());return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[t.jsx(jt,{title:"Total Calls",value:n.totalCalls.toString(),icon:ot,color:"text-blue-500"}),t.jsx(jt,{title:"Interested",value:n.interested.toString(),subValue:`${n.totalCalls>0?(n.interested/n.totalCalls*100).toFixed(1):0}%`,icon:Yn,color:"text-green-500"}),t.jsx(jt,{title:"Total Duration",value:bn(n.totalDuration),icon:Rn,color:"text-purple-500"}),t.jsx(jt,{title:"Avg Duration",value:`${Math.round(n.avgDuration/60)}m ${n.avgDuration%60}s`,icon:Ge,color:"text-orange-500"})]}),t.jsxs(ze,{className:"shadow-sm",children:[t.jsx(Ue,{children:t.jsx(Ye,{className:"text-lg",children:"Daily Call Summary"})}),t.jsx(qe,{className:"p-0",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(ca,{children:[t.jsx(da,{children:t.jsxs(fn,{className:"bg-muted/50",children:[t.jsx(He,{className:"font-semibold",children:"Date"}),t.jsx(He,{className:"text-center font-semibold",children:"Interested"}),t.jsx(He,{className:"text-center font-semibold",children:"Not Interested"}),t.jsx(He,{className:"text-center font-semibold",children:"Follow Up"}),t.jsx(He,{className:"text-center font-semibold",children:"Send Details"}),t.jsx(He,{className:"text-center font-semibold",children:"Callback"}),t.jsx(He,{className:"text-center font-semibold",children:"Not Picked"}),t.jsx(He,{className:"text-center font-bold",children:"Total Calls"}),t.jsx(He,{className:"text-right font-semibold",children:"Duration"}),t.jsx(He,{className:"text-center font-semibold",children:"Actions"})]})}),t.jsx(ua,{children:s.map(a=>{const i=n.tableData[a];return t.jsxs(fn,{className:"hover:bg-muted/50 transition-colors",children:[t.jsx(Le,{onClick:()=>r(a),className:"cursor-pointer font-medium",children:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-300 font-medium",children:i.interested})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-300 font-medium",children:i.notInterested})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-300 font-medium",children:i.followUp})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300 font-medium",children:i.sendDetails})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-yellow-50 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300 font-medium",children:i.callback})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-gray-50 text-gray-700 dark:bg-gray-900 dark:text-gray-300 font-medium",children:i.notPicked})}),t.jsx(Le,{className:"text-center",children:t.jsx("span",{className:"font-bold text-lg",children:i.totalCalls})}),t.jsx(Le,{className:"text-right font-medium",children:bn(i.duration)}),t.jsx(Le,{className:"text-center",children:t.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>e(a,i.totalCalls),children:t.jsx(Et,{className:"h-4 w-4"})})})]},a)})})]})})})]})]})},Ar=({contacts:n,onDateClick:r,onDeleteDate:e})=>{const s=Yt(n,"New Call"),a=Yt(n,"Follow-up"),i=Yt(n,"all");return t.jsx(dt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:t.jsxs($s,{defaultValue:"new-calls",className:"space-y-6",children:[t.jsxs(_s,{className:"grid w-full grid-cols-3 md:w-auto md:inline-grid bg-muted p-1 h-auto",children:[t.jsx($t,{value:"new-calls",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"New Calls"}),t.jsx($t,{value:"follow-up",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Follow-up Calls"}),t.jsx($t,{value:"consolidated",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Consolidated Report"})]}),t.jsx(_t,{value:"new-calls",children:t.jsx(qt,{data:s,onDateClick:l=>r(l,"New Call"),onDeleteDate:e})}),t.jsx(_t,{value:"follow-up",children:t.jsx(qt,{data:a,onDateClick:l=>r(l,"Follow-up"),onDeleteDate:e})}),t.jsx(_t,{value:"consolidated",children:t.jsx(qt,{data:i,onDateClick:l=>r(l,"all"),onDeleteDate:e})})]})})},vn=n=>{switch(n){case"Interested":return t.jsx(pe,{className:"bg-green-100 text-green-800 border-green-200",children:"Interested"});case"Follow Up":return t.jsx(pe,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Follow-up"});case"Callback":return t.jsx(pe,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Callback"});case"Send Details":return t.jsx(pe,{className:"bg-indigo-100 text-indigo-800 border-indigo-200",children:"Send Details"});case"Not Interested":return t.jsx(pe,{variant:"destructive",children:"Not Interested"});case"Not Picked":return t.jsx(pe,{variant:"outline",children:"Not Picked"});default:return t.jsx(pe,{variant:"secondary",children:n})}},Hr=n=>{const r=Math.floor(n/60),e=n%60;return`${r}m ${e.toString().padStart(2,"0")}s`},Dt=({contact:n,onUpdateCallLogMessage:r,onMarkAsSent:e})=>{const[s,a]=N.useState(null),[i,l]=N.useState(!1);if(!n)return null;const o=n.callHistory?Object.values(n.callHistory).sort((d,u)=>new Date(u.timestamp).getTime()-new Date(d.timestamp).getTime()):[],m=d=>d.split(" ").map(u=>u[0]).join("").toUpperCase(),c=async()=>{!s||!n||(l(!0),await r(n.id,s.originalIndex,s.content),l(!1),a(null))};return t.jsxs("div",{className:"p-4 md:p-6 flex-1 flex flex-col bg-background overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6 flex-shrink-0",children:[t.jsx(Mt,{className:"h-16 w-16 border",children:t.jsx(Rt,{className:"text-2xl bg-muted",children:m(n.name)})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:n.name}),t.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[t.jsx(ot,{className:"h-4 w-4"}),n.phone]})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-6 flex-1 overflow-hidden",children:[t.jsxs("div",{className:"md:w-1/3 space-y-4 flex-shrink-0",children:[t.jsxs(ze,{className:"shadow-sm",children:[t.jsx(Ue,{children:t.jsx(Ye,{className:"text-base",children:"Key Info"})}),t.jsxs(qe,{className:"space-y-4 text-sm",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[t.jsx(Yn,{className:"h-4 w-4"}),"Status"]}),vn(n.status)]}),t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[t.jsx(Ra,{className:"h-4 w-4"}),"Total Calls"]}),t.jsx("span",{className:"font-medium",children:n.callCount})]}),t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Last Contact"]}),t.jsx("span",{className:"font-medium text-right",children:ge(new Date(n.lastContacted),"PP")})]})]})]}),n.status==="Send Details"&&t.jsx(dt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:t.jsxs(ze,{className:"shadow-sm bg-blue-50 border-blue-200 dark:bg-blue-950 dark:border-blue-800",children:[t.jsx(Ue,{children:t.jsx(Ye,{className:"text-base text-blue-800 dark:text-blue-300",children:"Action Required"})}),t.jsxs(qe,{children:[t.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"This contact is waiting for details to be sent."}),t.jsxs(W,{onClick:()=>e(n.id),className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[t.jsx(zs,{className:"h-4 w-4 mr-2"}),"Mark Details as Sent"]})]})]})})]}),t.jsxs("div",{className:"md:w-2/3 flex flex-col overflow-hidden min-h-0",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:"Call History"}),t.jsx(rt,{className:"flex-1 -mr-6 pr-6",children:t.jsxs("div",{className:"relative pl-8 border-l-2 border-dashed border-border",children:[t.jsx(Tt,{children:o.map((d,u)=>t.jsxs(dt.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3,delay:u*.05},className:"relative mb-8",children:[t.jsx("div",{className:"absolute -left-[calc(0.5rem+1px)] top-1 h-4 w-4 rounded-full bg-primary ring-4 ring-background"}),t.jsxs("div",{className:"pl-4",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[vn(d.feedback),d.type==="New Call"&&t.jsx(pe,{variant:"outline",className:"border-green-500 text-green-600",children:"New Call"})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ge(new Date(d.timestamp),"PP, p")})]}),(s==null?void 0:s.originalIndex)!==d.originalIndex&&t.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>a({originalIndex:d.originalIndex,content:d.message}),children:t.jsx(ba,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"mt-3 space-y-3",children:[(s==null?void 0:s.originalIndex)===d.originalIndex?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ya,{value:s.content,onChange:w=>a({...s,content:w.target.value}),className:"text-sm",rows:3,autoFocus:!0}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>a(null),disabled:i,children:[t.jsx(Pn,{className:"h-4 w-4 mr-1"})," Cancel"]}),t.jsxs(W,{size:"sm",onClick:c,disabled:i,children:[i?t.jsx(yt,{className:"h-4 w-4 animate-spin"}):t.jsx(rs,{className:"h-4 w-4 mr-1"})," Save"]})]})]}):d.message&&t.jsxs("p",{className:"text-sm text-muted-foreground italic bg-muted/30 p-3 rounded-md border",children:['"',d.message,'"']}),t.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[d.spokenToName&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(La,{className:"h-3 w-3"})," Spoke to: ",t.jsx("span",{className:"font-medium text-foreground",children:d.spokenToName})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Rn,{className:"h-3 w-3"})," Duration: ",t.jsx("span",{className:"font-medium text-foreground",children:Hr(d.duration)})]})]})]})]})]},d.originalIndex))}),o.length===0&&t.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[t.jsx(Us,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),t.jsx("p",{children:"No call history recorded for this contact."})]})]})})]})]})]})},jn=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],Nn=({filters:n,onFiltersChange:r})=>{var a;const e=i=>{r({...n,dateRange:i})},s=(i,l,o)=>{const m=n[i],c=o?[...m,l]:m.filter(d=>d!==l);r({...n,[i]:c})};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium text-xs",children:"Date Range"}),t.jsxs(nn,{children:[t.jsx(sn,{asChild:!0,children:t.jsxs(W,{variant:"outline",className:Ie("w-full justify-start text-left font-normal mt-1",!n.dateRange&&"text-muted-foreground"),children:[t.jsx(Pt,{className:"mr-2 h-4 w-4"}),(a=n.dateRange)!=null&&a.from?n.dateRange.to?t.jsxs(t.Fragment,{children:[ge(n.dateRange.from,"LLL dd")," - ",ge(n.dateRange.to,"LLL dd")]}):ge(n.dateRange.from,"LLL dd, y"):t.jsx("span",{children:"Pick a date range"})]})}),t.jsx(an,{className:"w-auto p-0",align:"start",children:t.jsx(is,{initialFocus:!0,mode:"range",selected:n.dateRange,onSelect:e,numberOfMonths:1})})]})]}),t.jsx(St,{}),t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium text-xs",children:"Initial Call Status"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:jn.map(i=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{id:`initial-${i}`,checked:n.initialCallFeedback.includes(i),onCheckedChange:l=>s("initialCallFeedback",i,!!l)}),t.jsx("label",{htmlFor:`initial-${i}`,className:"text-sm",children:i})]},`initial-${i}`))})]}),t.jsx(St,{}),t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium text-xs",children:"Follow-up Call Status"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:jn.map(i=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{id:`followup-${i}`,checked:n.followUpCallFeedback.includes(i),onCheckedChange:l=>s("followUpCallFeedback",i,!!l)}),t.jsx("label",{htmlFor:`followup-${i}`,className:"text-sm",children:i})]},`followup-${i}`))})]})]})};function Lr(n){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",r.appendChild(e),e.styleSheet?e.styleSheet.cssText=n:e.appendChild(document.createTextNode(n))}const ps=j.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),bt=()=>{const n=j.useContext(ps);if(!n)throw new Error("useDrawerContext must be used within a Drawer.Root");return n};Lr(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const $r=24,_r=typeof window<"u"?N.useLayoutEffect:N.useEffect;function Cn(...n){return(...r)=>{for(let e of n)typeof e=="function"&&e(...r)}}function zr(){return dn(/^Mac/)}function Ur(){return dn(/^iPhone/)}function kn(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Yr(){return dn(/^iPad/)||zr()&&navigator.maxTouchPoints>1}function gs(){return Ur()||Yr()}function dn(n){return typeof window<"u"&&window.navigator!=null?n.test(window.navigator.platform):void 0}const Bt=typeof document<"u"&&window.visualViewport;function Dn(n){let r=window.getComputedStyle(n);return/(auto|scroll)/.test(r.overflow+r.overflowX+r.overflowY)}function ws(n){for(Dn(n)&&(n=n.parentElement);n&&!Dn(n);)n=n.parentElement;return n||document.scrollingElement||document.documentElement}const qr=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Nt=0,Wt;function Br(n={}){let{isDisabled:r}=n;_r(()=>{if(!r)return Nt++,Nt===1&&gs()&&(Wt=Wr()),()=>{Nt--,Nt===0&&(Wt==null||Wt())}},[r])}function Wr(){let n,r=0,e=u=>{n=ws(u.target),!(n===document.documentElement&&n===document.body)&&(r=u.changedTouches[0].pageY)},s=u=>{if(!n||n===document.documentElement||n===document.body){u.preventDefault();return}let w=u.changedTouches[0].pageY,k=n.scrollTop,H=n.scrollHeight-n.clientHeight;H!==0&&((k<=0&&w>r||k>=H&&w<r)&&u.preventDefault(),r=w)},a=u=>{let w=u.target;Zt(w)&&w!==document.activeElement&&(u.preventDefault(),w.style.transform="translateY(-2000px)",w.focus(),requestAnimationFrame(()=>{w.style.transform=""}))},i=u=>{let w=u.target;Zt(w)&&(w.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{w.style.transform="",Bt&&(Bt.height<window.innerHeight?requestAnimationFrame(()=>{Tn(w)}):Bt.addEventListener("resize",()=>Tn(w),{once:!0}))}))},l=()=>{window.scrollTo(0,0)},o=window.pageXOffset,m=window.pageYOffset,c=Cn(Qr(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let d=Cn(xt(document,"touchstart",e,{passive:!1,capture:!0}),xt(document,"touchmove",s,{passive:!1,capture:!0}),xt(document,"touchend",a,{passive:!1,capture:!0}),xt(document,"focus",i,!0),xt(window,"scroll",l));return()=>{c(),d(),window.scrollTo(o,m)}}function Qr(n,r,e){let s=n.style[r];return n.style[r]=e,()=>{n.style[r]=s}}function xt(n,r,e,s){return n.addEventListener(r,e,s),()=>{n.removeEventListener(r,e,s)}}function Tn(n){let r=document.scrollingElement||document.documentElement;for(;n&&n!==r;){let e=ws(n);if(e!==document.documentElement&&e!==document.body&&e!==n){let s=e.getBoundingClientRect().top,a=n.getBoundingClientRect().top,i=n.getBoundingClientRect().bottom;const l=e.getBoundingClientRect().bottom+$r;i>l&&(e.scrollTop+=a-s)}n=e.parentElement}}function Zt(n){return n instanceof HTMLInputElement&&!qr.has(n.type)||n instanceof HTMLTextAreaElement||n instanceof HTMLElement&&n.isContentEditable}function Vr(n,r){typeof n=="function"?n(r):n!=null&&(n.current=r)}function Xr(...n){return r=>n.forEach(e=>Vr(e,r))}function ys(...n){return N.useCallback(Xr(...n),n)}const bs=new WeakMap;function he(n,r,e=!1){if(!n||!(n instanceof HTMLElement))return;let s={};Object.entries(r).forEach(([a,i])=>{if(a.startsWith("--")){n.style.setProperty(a,i);return}s[a]=n.style[a],n.style[a]=i}),!e&&bs.set(n,s)}function Gr(n,r){if(!n||!(n instanceof HTMLElement))return;let e=bs.get(n);e&&(n.style[r]=e[r])}const fe=n=>{switch(n){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return n}};function Ct(n,r){if(!n)return null;const e=window.getComputedStyle(n),s=e.transform||e.webkitTransform||e.mozTransform;let a=s.match(/^matrix3d\((.+)\)$/);return a?parseFloat(a[1].split(", ")[fe(r)?13:12]):(a=s.match(/^matrix\((.+)\)$/),a?parseFloat(a[1].split(", ")[fe(r)?5:4]):null)}function Kr(n){return 8*(Math.log(n+1)-2)}function Qt(n,r){if(!n)return()=>{};const e=n.style.cssText;return Object.assign(n.style,r),()=>{n.style.cssText=e}}function Zr(...n){return(...r)=>{for(const e of n)typeof e=="function"&&e(...r)}}const ne={DURATION:.5,EASE:[.32,.72,0,1]},vs=.4,Jr=.25,ei=100,js=8,st=16,Jt=26,Vt="vaul-dragging";function Ns(n){const r=j.useRef(n);return j.useEffect(()=>{r.current=n}),j.useMemo(()=>(...e)=>r.current==null?void 0:r.current.call(r,...e),[])}function ti({defaultProp:n,onChange:r}){const e=j.useState(n),[s]=e,a=j.useRef(s),i=Ns(r);return j.useEffect(()=>{a.current!==s&&(i(s),a.current=s)},[s,a,i]),e}function Cs({prop:n,defaultProp:r,onChange:e=()=>{}}){const[s,a]=ti({defaultProp:r,onChange:e}),i=n!==void 0,l=i?n:s,o=Ns(e),m=j.useCallback(c=>{if(i){const u=typeof c=="function"?c(n):c;u!==n&&o(u)}else a(c)},[i,n,a,o]);return[l,m]}function ni({activeSnapPointProp:n,setActiveSnapPointProp:r,snapPoints:e,drawerRef:s,overlayRef:a,fadeFromIndex:i,onSnapPointChange:l,direction:o="bottom",container:m,snapToSequentialPoint:c}){const[d,u]=Cs({prop:n,defaultProp:e==null?void 0:e[0],onChange:r}),[w,k]=j.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);j.useEffect(()=>{function D(){k({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const H=j.useMemo(()=>d===(e==null?void 0:e[e.length-1])||null,[e,d]),S=j.useMemo(()=>e==null?void 0:e.findIndex(D=>D===d),[e,d]),Q=e&&e.length>0&&(i||i===0)&&!Number.isNaN(i)&&e[i]===d||!e,g=j.useMemo(()=>{const D=m?{width:m.getBoundingClientRect().width,height:m.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var F;return(F=e==null?void 0:e.map(L=>{const Z=typeof L=="string";let h=0;if(Z&&(h=parseInt(L,10)),fe(o)){const T=Z?h:w?L*D.height:0;return w?o==="bottom"?D.height-T:-D.height+T:T}const A=Z?h:w?L*D.width:0;return w?o==="right"?D.width-A:-D.width+A:A}))!=null?F:[]},[e,w,m]),B=j.useMemo(()=>S!==null?g==null?void 0:g[S]:null,[g,S]),y=j.useCallback(D=>{var F;const L=(F=g==null?void 0:g.findIndex(Z=>Z===D))!=null?F:null;l(L),he(s.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:fe(o)?`translate3d(0, ${D}px, 0)`:`translate3d(${D}px, 0, 0)`}),g&&L!==g.length-1&&L!==i&&L<i?he(a.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"0"}):he(a.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"1"}),u(e==null?void 0:e[Math.max(L,0)])},[s.current,e,g,i,a,u]);j.useEffect(()=>{if(d||n){var D;const F=(D=e==null?void 0:e.findIndex(L=>L===n||L===d))!=null?D:-1;g&&F!==-1&&typeof g[F]=="number"&&y(g[F])}},[d,n,e,g,y]);function x({draggedDistance:D,closeDrawer:F,velocity:L,dismissible:Z}){if(i===void 0)return;const h=o==="bottom"||o==="right"?(B??0)-D:(B??0)+D,A=S===i-1,T=S===0,_=D>0;if(A&&he(a.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`}),!c&&L>2&&!_){Z?F():y(g[0]);return}if(!c&&L>2&&_&&g&&e){y(g[e.length-1]);return}const K=g==null?void 0:g.reduce((f,M)=>typeof f!="number"||typeof M!="number"?f:Math.abs(M-h)<Math.abs(f-h)?M:f),G=fe(o)?window.innerHeight:window.innerWidth;if(L>vs&&Math.abs(D)<G*.4){const f=_?1:-1;if(f>0&&H){y(g[e.length-1]);return}if(T&&f<0&&Z&&F(),S===null)return;y(g[S+f]);return}y(K)}function $({draggedDistance:D}){if(B===null)return;const F=o==="bottom"||o==="right"?B-D:B+D;(o==="bottom"||o==="right")&&F<g[g.length-1]||(o==="top"||o==="left")&&F>g[g.length-1]||he(s.current,{transform:fe(o)?`translate3d(0, ${F}px, 0)`:`translate3d(${F}px, 0, 0)`})}function le(D,F){if(!e||typeof S!="number"||!g||i===void 0)return null;const L=S===i-1;if(S>=i&&F)return 0;if(L&&!F)return 1;if(!Q&&!L)return null;const h=L?S+1:S-1,A=L?g[h]-g[h-1]:g[h+1]-g[h],T=D/Math.abs(A);return L?1-T:T}return{isLastSnapPoint:H,activeSnapPoint:d,shouldFade:Q,getPercentageDragged:le,setActiveSnapPoint:u,activeSnapPointIndex:S,onRelease:x,onDrag:$,snapPointsOffset:g}}const si=()=>()=>{};function ai(){const{direction:n,isOpen:r,shouldScaleBackground:e,setBackgroundColorOnScale:s,noBodyStyles:a}=bt(),i=j.useRef(null),l=N.useMemo(()=>document.body.style.backgroundColor,[]);function o(){return(window.innerWidth-Jt)/window.innerWidth}j.useEffect(()=>{if(r&&e){i.current&&clearTimeout(i.current);const m=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!m)return;Zr(s&&!a?Qt(document.body,{background:"black"}):si,Qt(m,{transformOrigin:fe(n)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${ne.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ne.EASE.join(",")})`}));const c=Qt(m,{borderRadius:`${js}px`,overflow:"hidden",...fe(n)?{transform:`scale(${o()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${o()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{c(),i.current=window.setTimeout(()=>{l?document.body.style.background=l:document.body.style.removeProperty("background")},ne.DURATION*1e3)}}},[r,e,l])}let pt=null;function ri({isOpen:n,modal:r,nested:e,hasBeenOpened:s,preventScrollRestoration:a,noBodyStyles:i}){const[l,o]=j.useState(()=>typeof window<"u"?window.location.href:""),m=j.useRef(0),c=j.useCallback(()=>{if(kn()&&pt===null&&n&&!i){pt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:u,innerHeight:w}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-m.current}px`,left:`${-u}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const k=w-window.innerHeight;k&&m.current>=w&&(document.body.style.top=`${-(m.current+k)}px`)}),300)}},[n]),d=j.useCallback(()=>{if(kn()&&pt!==null&&!i){const u=-parseInt(document.body.style.top,10),w=-parseInt(document.body.style.left,10);Object.assign(document.body.style,pt),window.requestAnimationFrame(()=>{if(a&&l!==window.location.href){o(window.location.href);return}window.scrollTo(w,u)}),pt=null}},[l]);return j.useEffect(()=>{function u(){m.current=window.scrollY}return u(),window.addEventListener("scroll",u),()=>{window.removeEventListener("scroll",u)}},[]),j.useEffect(()=>{e||!s||(n?(!window.matchMedia("(display-mode: standalone)").matches&&c(),r||window.setTimeout(()=>{d()},500)):d())},[n,s,l,r,e,c,d]),{restorePositionSetting:d}}function ii({open:n,onOpenChange:r,children:e,onDrag:s,onRelease:a,snapPoints:i,shouldScaleBackground:l=!1,setBackgroundColorOnScale:o=!0,closeThreshold:m=Jr,scrollLockTimeout:c=ei,dismissible:d=!0,handleOnly:u=!1,fadeFromIndex:w=i&&i.length-1,activeSnapPoint:k,setActiveSnapPoint:H,fixed:S,modal:Q=!0,onClose:g,nested:B,noBodyStyles:y,direction:x="bottom",defaultOpen:$=!1,disablePreventScroll:le=!0,snapToSequentialPoint:D=!1,preventScrollRestoration:F=!1,repositionInputs:L=!0,onAnimationEnd:Z,container:h,autoFocus:A=!1}){var T,_;const[K=!1,G]=Cs({defaultProp:$,prop:n,onChange:C=>{r==null||r(C),!C&&!B&&re(),setTimeout(()=>{Z==null||Z(C)},ne.DURATION*1e3),C&&!Q&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),C||(document.body.style.pointerEvents="auto")}}),[f,M]=j.useState(!1),[R,U]=j.useState(!1),[ue,ee]=j.useState(!1),oe=j.useRef(null),ae=j.useRef(null),me=j.useRef(null),Me=j.useRef(null),xe=j.useRef(null),Re=j.useRef(!1),We=j.useRef(null),Qe=j.useRef(0),Y=j.useRef(!1),Pe=j.useRef(0),I=j.useRef(null),Ze=j.useRef(((T=I.current)==null?void 0:T.getBoundingClientRect().height)||0),ct=j.useRef(((_=I.current)==null?void 0:_.getBoundingClientRect().width)||0),Ve=j.useRef(0),mt=j.useCallback(C=>{i&&C===v.length-1&&(ae.current=new Date)},[]),{activeSnapPoint:Je,activeSnapPointIndex:Ne,setActiveSnapPoint:et,onRelease:b,snapPointsOffset:v,onDrag:P,shouldFade:O,getPercentageDragged:E}=ni({snapPoints:i,activeSnapPointProp:k,setActiveSnapPointProp:H,drawerRef:I,fadeFromIndex:w,overlayRef:oe,onSnapPointChange:mt,direction:x,container:h,snapToSequentialPoint:D});Br({isDisabled:!K||R||!Q||ue||!f||!L||!le});const{restorePositionSetting:re}=ri({isOpen:K,modal:Q,nested:B,hasBeenOpened:f,preventScrollRestoration:F,noBodyStyles:y});function Oe(){return(window.innerWidth-Jt)/window.innerWidth}function we(C){var z,V;!d&&!i||I.current&&!I.current.contains(C.target)||(Ze.current=((z=I.current)==null?void 0:z.getBoundingClientRect().height)||0,ct.current=((V=I.current)==null?void 0:V.getBoundingClientRect().width)||0,U(!0),me.current=new Date,gs()&&window.addEventListener("touchend",()=>Re.current=!1,{once:!0}),C.target.setPointerCapture(C.pointerId),Qe.current=fe(x)?C.pageY:C.pageX)}function Ce(C,z){var V,J;let X=C;const Ee=(V=window.getSelection())==null?void 0:V.toString(),be=I.current?Ct(I.current,x):null,De=new Date;if(X.hasAttribute("data-vaul-no-drag")||X.closest("[data-vaul-no-drag]"))return!1;if(x==="right"||x==="left")return!0;if(ae.current&&De.getTime()-ae.current.getTime()<500)return!1;if(be!==null&&(x==="bottom"?be>0:be<0))return!0;if(Ee&&Ee.length>0)return!1;if(De.getTime()-((J=xe.current)==null?void 0:J.getTime())<c&&be===0||z)return xe.current=De,!1;for(;X;){if(X.scrollHeight>X.clientHeight){if(X.scrollTop!==0)return xe.current=new Date,!1;if(X.getAttribute("role")==="dialog")return!0}X=X.parentNode}return!0}function ye(C){if(I.current&&R){const z=x==="bottom"||x==="right"?1:-1,V=(Qe.current-(fe(x)?C.pageY:C.pageX))*z,J=V>0,X=i&&!d&&!J;if(X&&Ne===0)return;const Ee=Math.abs(V),be=document.querySelector("[data-vaul-drawer-wrapper]"),De=x==="bottom"||x==="top"?Ze.current:ct.current;let Fe=Ee/De;const nt=E(Ee,J);if(nt!==null&&(Fe=nt),X&&Fe>=1||!Re.current&&!Ce(C.target,J))return;if(I.current.classList.add(Vt),Re.current=!0,he(I.current,{transition:"none"}),he(oe.current,{transition:"none"}),i&&P({draggedDistance:V}),J&&!i){const Ae=Kr(V),vt=Math.min(Ae*-1,0)*z;he(I.current,{transform:fe(x)?`translate3d(0, ${vt}px, 0)`:`translate3d(${vt}px, 0, 0)`});return}const Xe=1-Fe;if((O||w&&Ne===w-1)&&(s==null||s(C,Fe),he(oe.current,{opacity:`${Xe}`,transition:"none"},!0)),be&&oe.current&&l){const Ae=Math.min(Oe()+Fe*(1-Oe()),1),vt=8-Fe*8,mn=Math.max(0,14-Fe*14);he(be,{borderRadius:`${vt}px`,transform:fe(x)?`scale(${Ae}) translate3d(0, ${mn}px, 0)`:`scale(${Ae}) translate3d(${mn}px, 0, 0)`,transition:"none"},!0)}if(!i){const Ae=Ee*z;he(I.current,{transform:fe(x)?`translate3d(0, ${Ae}px, 0)`:`translate3d(${Ae}px, 0, 0)`})}}}j.useEffect(()=>{var C;function z(){if(!I.current||!L)return;const V=document.activeElement;if(Zt(V)||Y.current){var J;const X=((J=window.visualViewport)==null?void 0:J.height)||0,Ee=window.innerHeight;let be=Ee-X;const De=I.current.getBoundingClientRect().height||0,Fe=De>Ee*.8;Ve.current||(Ve.current=De);const nt=I.current.getBoundingClientRect().top;if(Math.abs(Pe.current-be)>60&&(Y.current=!Y.current),i&&i.length>0&&v&&Ne){const Xe=v[Ne]||0;be+=Xe}if(Pe.current=be,De>X||Y.current){const Xe=I.current.getBoundingClientRect().height;let Ae=Xe;Xe>X&&(Ae=X-(Fe?nt:Jt)),S?I.current.style.height=`${Xe-Math.max(be,0)}px`:I.current.style.height=`${Math.max(Ae,X-nt)}px`}else I.current.style.height=`${Ve.current}px`;i&&i.length>0&&!Y.current?I.current.style.bottom="0px":I.current.style.bottom=`${Math.max(be,0)}px`}}return(C=window.visualViewport)==null||C.addEventListener("resize",z),()=>{var V;return(V=window.visualViewport)==null?void 0:V.removeEventListener("resize",z)}},[Ne,i,v]);function ve(C){ke(),g==null||g(),C||G(!1),setTimeout(()=>{i&&et(i[0])},ne.DURATION*1e3)}function te(){if(!I.current)return;const C=document.querySelector("[data-vaul-drawer-wrapper]"),z=Ct(I.current,x);he(I.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`}),he(oe.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"1"}),l&&z&&z>0&&K&&he(C,{borderRadius:`${js}px`,overflow:"hidden",...fe(x)?{transform:`scale(${Oe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Oe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${ne.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ne.EASE.join(",")})`},!0)}function ke(){!R||!I.current||(I.current.classList.remove(Vt),Re.current=!1,U(!1),Me.current=new Date)}function Lt(C){if(!R||!I.current)return;I.current.classList.remove(Vt),Re.current=!1,U(!1),Me.current=new Date;const z=Ct(I.current,x);if(!Ce(C.target,!1)||!z||Number.isNaN(z)||me.current===null)return;const V=Me.current.getTime()-me.current.getTime(),J=Qe.current-(fe(x)?C.pageY:C.pageX),X=Math.abs(J)/V;if(X>.05&&(ee(!0),setTimeout(()=>{ee(!1)},200)),i){b({draggedDistance:J*(x==="bottom"||x==="right"?1:-1),closeDrawer:ve,velocity:X,dismissible:d}),a==null||a(C,!0);return}if(x==="bottom"||x==="right"?J>0:J<0){te(),a==null||a(C,!0);return}if(X>vs){ve(),a==null||a(C,!1);return}var Ee;const be=Math.min((Ee=I.current.getBoundingClientRect().height)!=null?Ee:0,window.innerHeight);var De;const Fe=Math.min((De=I.current.getBoundingClientRect().width)!=null?De:0,window.innerWidth),nt=x==="left"||x==="right";if(Math.abs(z)>=(nt?Fe:be)*m){ve(),a==null||a(C,!1);return}a==null||a(C,!0),te()}j.useEffect(()=>(K&&(he(document.documentElement,{scrollBehavior:"auto"}),ae.current=new Date),()=>{Gr(document.documentElement,"scrollBehavior")}),[K]);function ht(C){const z=C?(window.innerWidth-st)/window.innerWidth:1,V=C?-st:0;We.current&&window.clearTimeout(We.current),he(I.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:`scale(${z}) translate3d(0, ${V}px, 0)`}),!C&&I.current&&(We.current=setTimeout(()=>{const J=Ct(I.current,x);he(I.current,{transition:"none",transform:fe(x)?`translate3d(0, ${J}px, 0)`:`translate3d(${J}px, 0, 0)`})},500))}function ft(C,z){if(z<0)return;const V=(window.innerWidth-st)/window.innerWidth,J=V+z*(1-V),X=-st+z*st;he(I.current,{transform:fe(x)?`scale(${J}) translate3d(0, ${X}px, 0)`:`scale(${J}) translate3d(${X}px, 0, 0)`,transition:"none"})}function tt(C,z){const V=fe(x)?window.innerHeight:window.innerWidth,J=z?(V-st)/V:1,X=z?-st:0;z&&he(I.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:fe(x)?`scale(${J}) translate3d(0, ${X}px, 0)`:`scale(${J}) translate3d(${X}px, 0, 0)`})}return j.createElement(Bs,{defaultOpen:$,onOpenChange:C=>{!d&&!C||(C?M(!0):ve(!0),G(C))},open:K},j.createElement(ps.Provider,{value:{activeSnapPoint:Je,snapPoints:i,setActiveSnapPoint:et,drawerRef:I,overlayRef:oe,onOpenChange:r,onPress:we,onRelease:Lt,onDrag:ye,dismissible:d,handleOnly:u,isOpen:K,isDragging:R,shouldFade:O,closeDrawer:ve,onNestedDrag:ft,onNestedOpenChange:ht,onNestedRelease:tt,keyboardIsOpen:Y,modal:Q,snapPointsOffset:v,direction:x,shouldScaleBackground:l,setBackgroundColorOnScale:o,noBodyStyles:y,container:h,autoFocus:A}},e))}const ks=j.forwardRef(function({...n},r){const{overlayRef:e,snapPoints:s,onRelease:a,shouldFade:i,isOpen:l,modal:o}=bt(),m=ys(r,e),c=s&&s.length>0;return o?j.createElement(Ws,{onMouseUp:a,ref:m,"data-vaul-overlay":"","data-vaul-snap-points":l&&c?"true":"false","data-vaul-snap-points-overlay":l&&i?"true":"false",...n}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});ks.displayName="Drawer.Overlay";const Ds=j.forwardRef(function({onPointerDownOutside:n,style:r,onOpenAutoFocus:e,...s},a){const{drawerRef:i,onPress:l,onRelease:o,onDrag:m,keyboardIsOpen:c,snapPointsOffset:d,modal:u,isOpen:w,direction:k,snapPoints:H,container:S,handleOnly:Q,autoFocus:g}=bt(),[B,y]=j.useState(!1),x=ys(a,i),$=j.useRef(null),le=j.useRef(null),D=j.useRef(!1),F=H&&H.length>0;ai();const L=(h,A,T=0)=>{if(D.current)return!0;const _=Math.abs(h.y),K=Math.abs(h.x),G=K>_,f=["bottom","right"].includes(A)?1:-1;if(A==="left"||A==="right"){if(!(h.x*f<0)&&K>=0&&K<=T)return G}else if(!(h.y*f<0)&&_>=0&&_<=T)return!G;return D.current=!0,!0};j.useEffect(()=>{F&&window.requestAnimationFrame(()=>{y(!0)})},[]);function Z(h){$.current=null,D.current=!1,o(h)}return j.createElement(Qs,{"data-vaul-drawer-direction":k,"data-vaul-drawer":"","data-vaul-delayed-snap-points":B?"true":"false","data-vaul-snap-points":w&&F?"true":"false","data-vaul-custom-container":S?"true":"false",...s,ref:x,style:d&&d.length>0?{"--snap-point-height":`${d[0]}px`,...r}:r,onPointerDown:h=>{Q||(s.onPointerDown==null||s.onPointerDown.call(s,h),$.current={x:h.pageX,y:h.pageY},l(h))},onOpenAutoFocus:h=>{e==null||e(h),g||h.preventDefault()},onPointerDownOutside:h=>{if(n==null||n(h),!u||h.defaultPrevented){h.preventDefault();return}c.current&&(c.current=!1)},onFocusOutside:h=>{if(!u){h.preventDefault();return}},onPointerMove:h=>{if(le.current=h,Q||(s.onPointerMove==null||s.onPointerMove.call(s,h),!$.current))return;const A=h.pageY-$.current.y,T=h.pageX-$.current.x,_=h.pointerType==="touch"?10:2;L({x:T,y:A},k,_)?m(h):(Math.abs(T)>_||Math.abs(A)>_)&&($.current=null)},onPointerUp:h=>{s.onPointerUp==null||s.onPointerUp.call(s,h),$.current=null,D.current=!1,o(h)},onPointerOut:h=>{s.onPointerOut==null||s.onPointerOut.call(s,h),Z(le.current)},onContextMenu:h=>{s.onContextMenu==null||s.onContextMenu.call(s,h),Z(le.current)}})});Ds.displayName="Drawer.Content";const li=250,oi=120,ci=j.forwardRef(function({preventCycle:n=!1,children:r,...e},s){const{closeDrawer:a,isDragging:i,snapPoints:l,activeSnapPoint:o,setActiveSnapPoint:m,dismissible:c,handleOnly:d,isOpen:u,onPress:w,onDrag:k}=bt(),H=j.useRef(null),S=j.useRef(!1);function Q(){if(S.current){y();return}window.setTimeout(()=>{g()},oi)}function g(){if(i||n||S.current){y();return}if(y(),(!l||l.length===0)&&c){a();return}if(o===l[l.length-1]&&c){a();return}const $=l.findIndex(D=>D===o);if($===-1)return;const le=l[$+1];m(le)}function B(){H.current=window.setTimeout(()=>{S.current=!0},li)}function y(){window.clearTimeout(H.current),S.current=!1}return j.createElement("div",{onClick:Q,onPointerCancel:y,onPointerDown:x=>{d&&w(x),B()},onPointerMove:x=>{d&&k(x)},ref:s,"data-vaul-drawer-visible":u?"true":"false","data-vaul-handle":"","aria-hidden":"true",...e},j.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},r))});ci.displayName="Drawer.Handle";function di(n){const r=bt(),{container:e=r.container,...s}=n;return j.createElement(qs,{container:e,...s})}const Be={Root:ii,Content:Ds,Overlay:ks,Trigger:Ys,Portal:di,Title:Vs,Description:Xs},At=({shouldScaleBackground:n=!0,...r})=>t.jsx(Be.Root,{shouldScaleBackground:n,...r});At.displayName="Drawer";const ui=Be.Trigger,Ts=Be.Portal,un=N.forwardRef(({className:n,...r},e)=>t.jsx(Be.Overlay,{ref:e,className:Ie("fixed inset-0 z-50 bg-black/80",n),...r}));un.displayName=Be.Overlay.displayName;const Ht=N.forwardRef(({className:n,children:r,...e},s)=>t.jsxs(Ts,{children:[t.jsx(un,{}),t.jsxs(Be.Content,{ref:s,className:Ie("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",n),...e,children:[t.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));Ht.displayName="DrawerContent";const Ss=({className:n,...r})=>t.jsx("div",{className:Ie("grid gap-1.5 p-4 text-center sm:text-left",n),...r});Ss.displayName="DrawerHeader";const Is=N.forwardRef(({className:n,...r},e)=>t.jsx(Be.Title,{ref:e,className:Ie("text-lg font-semibold leading-none tracking-tight",n),...r}));Is.displayName=Be.Title.displayName;const Es=N.forwardRef(({className:n,...r},e)=>t.jsx(Be.Description,{ref:e,className:Ie("text-sm text-muted-foreground",n),...r}));Es.displayName=Be.Description.displayName;function mi({open:n,onOpenChange:r,onConfirm:e,logDetails:s}){const[a,i]=N.useState(""),l=a!=="Delete This",o=()=>{e(),i("")},m=c=>{c||i(""),r(c)};return s?t.jsx(qn,{open:n,onOpenChange:m,children:t.jsxs(Bn,{children:[t.jsxs(Wn,{children:[t.jsx(Qn,{children:"Are you absolutely sure?"}),t.jsxs(Vn,{children:["This action cannot be undone. This will permanently delete the call log for",t.jsxs("strong",{children:[" ",s.contactName]})," from",t.jsxs("strong",{children:[" ",ge(new Date(s.log.timestamp),"PP")]}),"."]})]}),t.jsxs("div",{className:"space-y-2 my-4",children:[t.jsx(Ke,{htmlFor:"delete-confirm",children:'To confirm, type "Delete This" below:'}),t.jsx(Ot,{id:"delete-confirm",value:a,onChange:c=>i(c.target.value),autoComplete:"off"})]}),t.jsxs(Xn,{children:[t.jsx(Gn,{children:"Cancel"}),t.jsx(Kn,{onClick:o,disabled:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}):null}function Ms({open:n,onOpenChange:r,onConfirm:e,itemCount:s,itemName:a}){const[i,l]=N.useState(""),o=i!=="Delete This",m=()=>{e(),l("")},c=d=>{d||l(""),r(d)};return s===0?null:t.jsx(qn,{open:n,onOpenChange:c,children:t.jsxs(Bn,{children:[t.jsxs(Wn,{children:[t.jsx(Qn,{children:"Are you absolutely sure?"}),t.jsxs(Vn,{children:["This action cannot be undone. This will permanently delete",t.jsxs("strong",{children:[" ",s," selected ",a]}),"."]})]}),t.jsxs("div",{className:"space-y-2 my-4",children:[t.jsx(Ke,{htmlFor:"delete-confirm",children:'To confirm, type "Delete This" below:'}),t.jsx(Ot,{id:"delete-confirm",value:i,onChange:d=>l(d.target.value),autoComplete:"off"})]}),t.jsxs(Xn,{children:[t.jsx(Gn,{children:"Cancel"}),t.jsx(Kn,{onClick:m,disabled:o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}const hi=n=>{switch(n){case"Interested":return t.jsx(pe,{className:"bg-green-100 text-green-800",children:"Interested"});case"Follow Up":return t.jsx(pe,{className:"bg-blue-100 text-blue-800",children:"Follow-up"});case"Callback":return t.jsx(pe,{className:"bg-yellow-100 text-yellow-800",children:"Callback"});case"Send Details":return t.jsx(pe,{className:"bg-indigo-100 text-indigo-800",children:"Send Details"});case"Not Interested":return t.jsx(pe,{variant:"destructive",children:"Not Interested"});case"Not Picked":return t.jsx(pe,{variant:"outline",children:"Not Picked"});default:return t.jsx(pe,{variant:"secondary",children:n})}},Rs=({call:n,isOverlay:r=!1,onSelectContact:e,isSelected:s,onDelete:a})=>t.jsxs("div",{className:Ie("w-full text-left p-3 rounded-lg border bg-background shadow-sm relative group",r?"cursor-grabbing":"cursor-grab",!r&&"hover:bg-muted/50 transition-colors",s&&"ring-2 ring-primary border-primary"),children:[a&&t.jsx(W,{variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6 text-muted-foreground hover:text-destructive opacity-0 group-hover:opacity-100 transition-opacity",onClick:i=>{i.stopPropagation(),a()},children:t.jsx(Et,{className:"h-3.5 w-3.5"})}),t.jsxs("div",{onClick:()=>e&&e(n.contact),children:[s&&t.jsx(Ks,{className:"h-4 w-4 text-white bg-primary rounded-full absolute -top-1.5 -left-1.5"}),t.jsxs("p",{className:"font-medium text-sm flex items-center gap-2 pr-6",children:[t.jsx(Zs,{className:"h-3.5 w-3.5"})," ",n.contact.name]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1.5 flex items-center gap-2",children:[t.jsx(ot,{className:"h-3 w-3"})," ",n.contact.phone]})]})]}),fi=({call:n,onSelectContact:r,onToggleSelect:e,isSelected:s,onDelete:a})=>{const{attributes:i,listeners:l,setNodeRef:o,transform:m,transition:c,isDragging:d}=Ft({id:n.log.originalIndex}),u={transform:as.Transform.toString(m),transition:c};return t.jsx("div",{ref:o,style:u,...i,...l,className:Ie(d&&"opacity-50"),onClick:()=>e(n.log.originalIndex),children:t.jsx(Rs,{call:n,onSelectContact:r,isSelected:s,onDelete:a})})},xi=({feedback:n,calls:r,onSelectContact:e,onToggleSelect:s,selectedLogIds:a,onDelete:i})=>{const{setNodeRef:l}=Ft({id:n});return t.jsxs("div",{ref:l,className:"w-72 flex-shrink-0 bg-muted/30 rounded-lg p-4 flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-shrink-0",children:[hi(n),t.jsxs("span",{className:"font-semibold text-sm text-muted-foreground",children:["(",r.length,")"]})]}),t.jsx(ns,{items:r.map(o=>o.log.originalIndex),strategy:ss,children:t.jsx("div",{className:"space-y-2",children:r.map(o=>t.jsx(fi,{call:o,onSelectContact:e,onToggleSelect:s,isSelected:a.has(o.log.originalIndex),onDelete:()=>i(o)},o.log.originalIndex))})})]})},Sn=({data:n,onSelectContact:r,onUpdateCallLogFeedback:e,onDeleteCallLog:s,onDeleteMultipleCallLogs:a})=>{const[i,l]=N.useState({}),[o,m]=N.useState(null),[c,d]=N.useState(new Set),[u,w]=N.useState(null),[k,H]=N.useState(!1),{addOpportunitiesFromContacts:S}=Ln();N.useEffect(()=>{if(n){const h=n.calls.reduce((A,T)=>{const{feedback:_}=T.log;return A[_]||(A[_]=[]),A[_].push(T),A},{});l(h),d(new Set)}},[n]);const Q=Zn(Jn(es,{activationConstraint:{distance:10}})),g=h=>Object.keys(i).find(A=>i[A].some(T=>T.log.originalIndex===h)),B=h=>{const{active:A}=h,T=A.id,_=g(T);if(_){const K=i[_].find(G=>G.log.originalIndex===T);m(K||null)}},y=h=>{const{active:A,over:T}=h;if(m(null),!T)return;const _=A.id,K=T.id,G=g(_),M=Z.includes(K)?K:g(K);if(!G||!M||G===M)return;const R=i[G].find(ue=>ue.log.originalIndex===_);if(!R)return;l(ue=>{const ee={...ue};return ee[G]=ee[G].filter(oe=>oe.log.originalIndex!==_),ee[M]||(ee[M]=[]),ee[M]=[...ee[M],R],ee});const U=M;e(R.contact.id,R.log.originalIndex,U)},x=h=>{d(A=>{const T=new Set(A);return T.has(h)?T.delete(h):T.add(h),T})},$=()=>{if(c.size===0||!n)return;const h=n.calls.filter(T=>c.has(T.log.originalIndex)).map(T=>T.contact),A=Array.from(new Map(h.map(T=>[T.id,T])).values());S(A),d(new Set)},le=()=>{u&&(s(u.contact.id,u.log.originalIndex),w(null))},D=()=>{if(c.size===0||!n)return;const h=n.calls.filter(A=>c.has(A.log.originalIndex)).map(A=>({contactId:A.contact.id,logId:A.log.originalIndex}));a(h),d(new Set),H(!1)},F=N.useMemo(()=>n?new Set(n.calls.map(h=>h.log.originalIndex)):new Set,[n]),L=()=>{c.size===F.size?d(new Set):d(F)},Z=["Interested","Follow Up","Callback","Not Interested","Not Picked","Send Details"];return t.jsxs(t.Fragment,{children:[t.jsxs(ts,{sensors:Q,onDragStart:B,onDragEnd:y,children:[t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsxs(rt,{className:"h-full w-full",children:[t.jsx("div",{className:"flex space-x-4 pb-4",children:Z.map(h=>t.jsx(xi,{feedback:h,calls:i[h]||[],onSelectContact:r,onToggleSelect:x,selectedLogIds:c,onDelete:w},h))}),t.jsx(Gs,{orientation:"horizontal"})]}),t.jsx(va,{children:o?t.jsx(Rs,{call:o,isOverlay:!0}):null})]}),n&&n.calls.length>0&&t.jsxs("div",{className:"flex-shrink-0 p-4 border-t bg-background flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(W,{variant:"outline",size:"sm",onClick:L,children:c.size===F.size?"Deselect All":"Select All"}),t.jsxs("span",{className:"text-sm font-medium",children:[c.size," log(s) selected"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(W,{onClick:()=>H(!0),disabled:c.size===0,variant:"destructive",children:[t.jsx(Et,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),t.jsxs(W,{onClick:$,disabled:c.size===0,children:[t.jsx($n,{className:"h-4 w-4 mr-2"}),"Add to Opportunities"]})]})]})]}),t.jsx(mi,{open:!!u,onOpenChange:h=>!h&&w(null),onConfirm:le,logDetails:u?{contactName:u.contact.name,log:u.log}:null}),t.jsx(Ms,{open:k,onOpenChange:H,onConfirm:D,itemCount:c.size,itemName:"call logs"})]})},pi=n=>{const{isOpen:r,onOpenChange:e,data:s}=n;return On()?t.jsx(At,{open:r,onOpenChange:e,children:t.jsxs(Ht,{className:"p-4 h-[85vh] flex flex-col",children:[t.jsxs(Ss,{className:"flex-shrink-0 text-left",children:[t.jsxs(Is,{children:["Call Details for ",s?ge(new Date(s.date),"MMMM d, yyyy"):""]}),t.jsx(Es,{children:"Drag and drop contacts to update their status. Tap to select."})]}),t.jsx(Sn,{...n})]})}):t.jsx(rn,{open:r,onOpenChange:e,children:t.jsxs(ln,{className:"max-w-[95vw] w-full h-[85vh] flex flex-col",children:[t.jsxs(Fn,{className:"flex-shrink-0",children:[t.jsxs(An,{children:["Call Details for ",s?ge(new Date(s.date),"MMMM d, yyyy"):""]}),t.jsx(Hn,{children:"Drag and drop contacts between columns to update their status. Click to select."})]}),t.jsx(Sn,{...n})]})})},Ps=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],gi=["New Contact",...Ps],wi=({open:n,onOpenChange:r,onExport:e})=>{var c,d;const[s,a]=N.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),i=u=>{a(w=>({...w,dateRange:u}))},l=(u,w,k)=>{a(H=>{const S=H[u];return k?{...H,[u]:[...S,w]}:{...H,[u]:S.filter(Q=>Q!==w)}})},o=()=>{e(s),r(!1)},m=()=>{a({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]})};return t.jsx(rn,{open:n,onOpenChange:r,children:t.jsxs(ln,{className:"sm:max-w-lg",children:[t.jsxs(Fn,{children:[t.jsx(An,{children:"Export Contacts to Excel"}),t.jsx(Hn,{children:"Select filters to refine the contact list for your export."})]}),t.jsxs("div",{className:"py-4 space-y-6",children:[t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium",children:"Date Range"}),t.jsxs(nn,{children:[t.jsx(sn,{asChild:!0,children:t.jsxs(W,{variant:"outline",className:Ie("w-full justify-start text-left font-normal mt-2",!s.dateRange&&"text-muted-foreground"),children:[t.jsx(Pt,{className:"mr-2 h-4 w-4"}),(c=s.dateRange)!=null&&c.from?s.dateRange.to?t.jsxs(t.Fragment,{children:[ge(s.dateRange.from,"LLL dd, y")," -"," ",ge(s.dateRange.to,"LLL dd, y")]}):ge(s.dateRange.from,"LLL dd, y"):t.jsx("span",{children:"Pick a date range"})]})}),t.jsx(an,{className:"w-auto p-0",align:"start",children:t.jsx(is,{initialFocus:!0,mode:"range",defaultMonth:(d=s.dateRange)==null?void 0:d.from,selected:s.dateRange,onSelect:i,numberOfMonths:2})})]})]}),t.jsx(St,{}),t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium",children:"Initial Call Status"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:gi.map(u=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{id:`export-initial-${u}`,checked:s.initialCallFeedback.includes(u),onCheckedChange:w=>l("initialCallFeedback",u,!!w)}),t.jsx("label",{htmlFor:`export-initial-${u}`,className:"text-sm font-medium leading-none",children:u==="New Contact"?"New (Never Called)":u})]},`initial-${u}`))})]}),t.jsx(St,{}),t.jsxs("div",{children:[t.jsx(Ke,{className:"font-medium",children:"Follow-up Call Status"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Ps.map(u=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{id:`export-followup-${u}`,checked:s.followUpCallFeedback.includes(u),onCheckedChange:w=>l("followUpCallFeedback",u,!!w)}),t.jsx("label",{htmlFor:`export-followup-${u}`,className:"text-sm font-medium leading-none",children:u})]},`followup-${u}`))})]})]}),t.jsxs(Js,{children:[t.jsxs(W,{variant:"outline",onClick:m,children:[t.jsx(Pn,{className:"h-4 w-4 mr-2"}),"Clear"]}),t.jsxs(W,{onClick:o,children:[t.jsx(ls,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})})},yi=({liveCallData:n,onUpdateCallLogMessage:r,onMarkAsSent:e,onFinishSession:s})=>{const[a,i]=N.useState(!1);if(!n)return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center text-muted-foreground",children:[t.jsx(ot,{className:"h-16 w-16 mx-auto mb-4 opacity-30"}),t.jsx("h3",{className:"text-xl font-semibold",children:"No Active Call"}),t.jsx("p",{className:"text-sm",children:"Live call details will appear here when a call is initiated from the Sales Dialer app."})]})});const{status:l,currentContact:o,nextContact:m,queuePosition:c}=n,d=w=>w.split(" ").map(k=>k[0]).join("").toUpperCase(),u=async()=>{i(!0),await s()};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[t.jsx("div",{className:"flex flex-col items-center justify-center",children:t.jsxs(ze,{className:"w-full max-w-md shadow-2xl border-2 border-red-500 animate-pulse-glow-destructive",children:[t.jsx(Ue,{className:"text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500",children:[t.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500 animate-ping"}),t.jsx(Ye,{className:"text-2xl font-bold",children:"Live Call in Progress"})]})}),t.jsxs(qe,{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 rounded-lg bg-muted/30",children:[t.jsx(pe,{variant:l==="calling"?"destructive":"secondary",className:"animate-pulse",children:l==="calling"?"Calling Now":"Countdown..."}),t.jsx(Mt,{className:"h-24 w-24 border-4 border-muted",children:t.jsx(Rt,{className:"text-3xl",children:d(o.name)})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-center",children:o.name}),t.jsx("p",{className:"text-lg text-muted-foreground text-center",children:o.phone})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs(ze,{children:[t.jsx(Ue,{className:"pb-2",children:t.jsxs(Ye,{className:"text-base flex items-center gap-2",children:[t.jsx(Da,{className:"h-4 w-4 text-muted-foreground"}),"Up Next"]})}),t.jsx(qe,{children:m?t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:m.name}),t.jsx("p",{className:"text-sm text-muted-foreground",children:m.phone})]}):t.jsx("p",{className:"text-sm text-muted-foreground",children:"Last contact in the queue."})})]}),t.jsxs(ze,{children:[t.jsx(Ue,{className:"pb-2",children:t.jsxs(Ye,{className:"text-base flex items-center gap-2",children:[t.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"}),"Queue Position"]})}),t.jsx(qe,{children:t.jsx("p",{className:"font-medium",children:c})})]})]})]}),t.jsx(ea,{children:t.jsxs(W,{variant:"destructive",className:"w-full",onClick:u,disabled:a,children:[a?t.jsx(yt,{className:"mr-2 h-4 w-4 animate-spin"}):t.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Finish Session"]})})]})}),t.jsx("div",{className:"h-full overflow-hidden rounded-lg border bg-background shadow-sm",children:t.jsx(Dt,{contact:o,onUpdateCallLogMessage:r,onMarkAsSent:e})})]})},Xt=20,bi=({id:n,contact:r,children:e,onRemove:s})=>{const{attributes:a,listeners:i,setNodeRef:l,transform:o,transition:m}=Ft({id:n}),c={transform:as.Transform.toString(o),transition:m};return t.jsxs("div",{ref:l,style:c,...a,...i,className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50 border cursor-grab",children:[e,t.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>s(n),children:t.jsx(Et,{className:"h-4 w-4"})})]})},In=({contact:n,isSelected:r,onToggle:e,onAdd:s})=>{const{attributes:a,listeners:i,setNodeRef:l}=Ft({id:n.id}),o=m=>m.split(" ").map(c=>c[0]).join("").toUpperCase();return t.jsxs("div",{ref:l,...a,...i,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>s(n),children:[t.jsx(ut,{id:`contact-${n.id}`,checked:r,onCheckedChange:()=>e(n.id),onClick:m=>m.stopPropagation()}),t.jsxs("label",{htmlFor:`contact-${n.id}`,className:"flex items-center gap-3 cursor-pointer flex-1",children:[t.jsx(Mt,{className:"h-10 w-10 border",children:t.jsx(Rt,{children:o(n.name)})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:n.name}),t.jsx("p",{className:"text-sm text-muted-foreground",children:n.phone})]})]})]})},vi=({contacts:n,onSaveImportedContacts:r,userProfile:e})=>{const{user:s}=_n(),{toast:a}=zn(),[i,l]=N.useState(""),[o,m]=N.useState(new Set),[c,d]=N.useState([]),[u,w]=N.useState(!1),[k,H]=N.useState([]),[S,Q]=N.useState(!1),g=N.useRef(null),[B,y]=N.useState(Xt),x=(e==null?void 0:e.role)==="superadmin",$=Zn(Jn(es,{activationConstraint:{distance:10}})),le=N.useMemo(()=>{const f=new Set(c.map(R=>R.id)),M=new Set(k.map(R=>R.id));return n.filter(R=>!f.has(R.id)&&!M.has(R.id)&&(R.name.toLowerCase().includes(i.toLowerCase())||R.phone.includes(i)))},[n,c,k,i]),D=N.useMemo(()=>le.slice(0,B),[le,B]);N.useEffect(()=>{y(Xt)},[i]);const F=f=>{m(M=>{const R=new Set(M);return R.has(f)?R.delete(f):R.add(f),R})},L=()=>{const M=[...n,...k].filter(U=>o.has(U.id)),R=[...c];M.forEach(U=>{R.some(ue=>ue.id===U.id)||R.push(U)}),d(R),m(new Set),a({title:`${M.length} contact(s) added to queue.`})},Z=f=>{c.some(M=>M.id===f.id)||d(M=>[...M,f])},h=f=>{d(M=>M.filter(R=>R.id!==f))},A=async()=>{if(!(!s||c.length===0)){w(!0);try{const f={};f[`dialingQueue/${s.uid}`]=c,f["dialerBridge/activeWebUser"]=s.uid,await at(Te(Se),f),a({title:"Dialing Queue Sent!",description:"Open the Sales Dialer app and press 'Start Dialing' to begin."}),d([])}catch(f){console.error("Failed to send dialing queue:",f),a({title:"Failed to send queue",variant:"destructive"})}finally{w(!1)}}},T=f=>{const{active:M,over:R}=f;if(!R)return;const U=String(M.id),ue=R.id,oe=[...le,...k].find(ae=>ae.id===U);oe&&(R.id==="call-queue-droppable"||c.some(ae=>ae.id===ue))&&(c.some(ae=>ae.id===U)||d(ae=>[...ae,oe]))},_=f=>{var U;const M=(U=f.target.files)==null?void 0:U[0];if(!M)return;const R=new FileReader;R.onload=ue=>{var Qe;const ee=(Qe=ue.target)==null?void 0:Qe.result,oe=ma(ee,{type:"binary"}),ae=oe.SheetNames[0],me=oe.Sheets[ae],Me=kt.sheet_to_json(me),xe=new Set;let Re=0;const We=[];Me.forEach(Y=>{const Pe=String(Y["Phone Number"]||Y.Phone||Y.phone||"").trim(),I=String(Y["Company Name"]||Y.Name||Y.name||"Unknown").trim();if(!Pe||!I)return;if(xe.has(Pe)){Re++;return}xe.add(Pe);const Ze=String(Y["Last Status"]||Y.Feedback||"").trim(),ct=String(Y["Last Message"]||Y.Message||"").trim(),Ve=parseInt(String(Y["Duration (s)"]||Y.Duration||Y["Last Duration(s)"]||0),10),mt=String(Y["Spoken To Name"]||Y["Spoken To"]||Y["Last Spoken To"]||"").trim(),Je=String(Y["Timestamp (YYYY-MM-DD HH:MM:SS)"]||Y.Timestamp||Y["Last Contacted"]||new Date().toISOString()).trim();let Ne;try{let b;if(b=yn(Je,"dd-MM-yyyy HH:mm:ss",new Date),isNaN(b.getTime())&&(b=yn(Je,"dd-MM-yyyy HH:mm",new Date)),isNaN(b.getTime()))throw new Error("Invalid Date Format");Ne=b.toISOString()}catch{console.warn(`Invalid date value found: ${Je}. Defaulting to current time.`),Ne=new Date().toISOString()}const et={originalIndex:crypto.randomUUID(),type:"Follow-up",timestamp:Ne,duration:isNaN(Ve)?0:Ve,feedback:Ze,message:ct,spokenToName:mt};We.push({id:Pe,name:I,phone:Pe,callHistory:[et],status:Ze||"New",lastContacted:Ne,callCount:1})}),H(We),a({title:"Import Complete",description:`${We.length} unique contacts loaded from file. ${Re>0?`${Re} duplicates within the file were ignored.`:""}`})},R.readAsBinaryString(M),g.current&&(g.current.value="")},K=async()=>{if(Q(!0),!s){Q(!1);return}const f={};let M=0,R=0;try{k.forEach(U=>{const ue=n.find(oe=>oe.phone===U.phone),ee=U.phone;if(ue){U.callHistory.forEach(me=>{const Me=Te(Se,`contacts/${ee}/callHistory`),xe=hn(Me).key;xe&&(f[`contacts/${ee}/callHistory/${xe}`]={feedback:me.feedback,message:me.message,timestamp:me.timestamp,duration:me.duration,spokenToName:me.spokenToName},R++)}),f[`contacts/${ee}/name`]=U.name,f[`contacts/${ee}/phoneNumber`]=U.phone;const ae=ue.callHistory.length+U.callHistory.length;f[`contacts/${ee}/callCount`]=ae}else{const oe={name:U.name,phoneNumber:U.phone,callCount:U.callHistory.length,callHistory:U.callHistory.reduce((ae,me)=>{const Me=Te(Se,"contacts"),xe=hn(Me).key;return xe&&(ae[xe]={feedback:me.feedback,message:me.message,timestamp:me.timestamp,duration:me.duration,spokenToName:me.spokenToName}),ae},{})};f[`contacts/${ee}`]=oe,M++}}),Object.keys(f).length>0?(await at(Te(Se),f),a({title:"Import Successful!",description:`Added ${M} new contacts and merged ${R} call logs into existing contacts.`}),H([])):a({title:"No New Data",description:"No new contacts or call logs found to save."})}catch(U){console.error("Error saving imported contacts:",U),a({title:"Save Failed",description:"Could not save the imported contacts to Firebase.",variant:"destructive"})}finally{Q(!1)}},G=f=>f.split(" ").map(M=>M[0]).join("").toUpperCase();return N.useMemo(()=>k.length===0?!1:k.every(f=>o.has(f.id)),[k,o]),t.jsx(ts,{sensors:$,onDragStart:()=>{},onDragEnd:T,children:t.jsxs(os,{direction:"horizontal",className:"h-full rounded-lg border",children:[t.jsx(wt,{defaultSize:30,minSize:20,children:t.jsxs(ze,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[t.jsxs(Ue,{children:[t.jsxs(Ye,{className:"flex items-center gap-2",children:[t.jsx(wn,{className:"h-5 w-5"})," Imported Contacts"]}),x&&t.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-background",children:[t.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[t.jsx(cs,{className:"h-4 w-4 text-primary"})," Master Data Import"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload a CSV/Excel file to update the master contact list."}),t.jsx("input",{type:"file",ref:g,onChange:_,accept:".xlsx, .xls, .csv",className:"hidden"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(W,{variant:"outline",onClick:()=>{var f;return(f=g.current)==null?void 0:f.click()},className:"flex-1",children:[t.jsx(wn,{className:"h-4 w-4 mr-2"})," Upload File"]}),t.jsx("a",{href:"/sample_call_import.csv",download:!0,children:t.jsx(W,{variant:"ghost",size:"icon",title:"Download Sample CSV",children:t.jsx(ls,{className:"h-4 w-4"})})})]}),t.jsxs(W,{onClick:K,disabled:S||k.length===0,className:"w-full",children:[S?t.jsx(yt,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(rs,{className:"h-4 w-4 mr-2"}),"Save ",k.length," New/Updated Contacts"]})]})]}),t.jsx(qe,{className:"flex-1 overflow-hidden p-0",children:t.jsx(rt,{className:"h-full",children:t.jsxs("div",{className:"p-4 space-y-2",children:[k.map(f=>t.jsx(In,{contact:f,isSelected:o.has(f.id),onToggle:F,onAdd:Z},f.id)),k.length===0&&t.jsx("div",{className:"text-center py-16 text-muted-foreground",children:t.jsx("p",{children:"Import contacts to get started."})})]})})})]})}),t.jsx(Gt,{withHandle:!0}),t.jsx(wt,{defaultSize:40,minSize:30,children:t.jsxs(ze,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[t.jsxs(Ue,{children:[t.jsxs(Ye,{className:"flex items-center gap-2",children:[t.jsx(Ge,{className:"h-5 w-5"})," Available Contacts"]}),t.jsx(Ot,{placeholder:"Search contacts...",value:i,onChange:f=>l(f.target.value)})]}),t.jsx(qe,{className:"flex-1 overflow-hidden p-0",children:t.jsx(rt,{className:"h-full",children:t.jsxs("div",{className:"p-4 space-y-2",children:[D.map(f=>t.jsx(In,{contact:f,isSelected:o.has(f.id),onToggle:F,onAdd:Z},f.id)),B<le.length&&t.jsx("div",{className:"flex justify-center py-2",children:t.jsx(W,{variant:"outline",onClick:()=>y(f=>f+Xt),children:"Load More"})})]})})})]})}),t.jsx(Gt,{withHandle:!0}),t.jsx(wt,{defaultSize:30,minSize:20,children:t.jsxs(ze,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[t.jsx(Ue,{children:t.jsxs(Ye,{className:"flex items-center gap-2",children:[t.jsx(ot,{className:"h-5 w-5"})," Call Queue"]})}),t.jsx(qe,{className:"flex-1 overflow-hidden p-0",children:t.jsx(rt,{className:"h-full",children:t.jsxs("div",{className:"p-4 space-y-2",id:"call-queue-droppable",children:[t.jsx(ns,{items:c.map(f=>f.id),strategy:ss,children:t.jsx(Tt,{children:c.map((f,M)=>t.jsx(dt.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:t.jsxs(bi,{id:f.id,contact:f,onRemove:h,children:[t.jsxs("span",{className:"font-mono text-sm text-muted-foreground cursor-grab",children:[M+1,"."]}),t.jsx(Mt,{className:"h-10 w-10 border",children:t.jsx(Rt,{children:G(f.name)})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:f.name}),t.jsx("p",{className:"text-sm text-muted-foreground",children:f.phone})]})]})},f.id))})}),c.length===0&&t.jsx("div",{className:"text-center py-16 text-muted-foreground",children:t.jsx("p",{children:"Drag contacts here to build your queue."})})]})})}),t.jsxs("div",{className:"p-4 border-t flex flex-col gap-4 flex-shrink-0",children:[t.jsxs(W,{onClick:L,disabled:o.size===0,variant:"outline",children:[t.jsx(ta,{className:"h-4 w-4 mr-2"}),"Add ",o.size>0?`(${o.size})`:""," to Queue"]}),t.jsxs(W,{onClick:A,disabled:c.length===0||u,children:[u?t.jsx(yt,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(Sa,{className:"h-4 w-4 mr-2"}),"Send Queue to Dialer (",c.length,")"]})]})]})})]})})},en=30,tn=j.forwardRef(({activeFilterCount:n,...r},e)=>t.jsxs(W,{ref:e,variant:"outline",className:"gap-2",...r,children:[t.jsx(Ea,{className:"h-4 w-4"}),"Filters",n>0&&t.jsx(pe,{variant:"secondary",className:"rounded-full px-2",children:n})]}));tn.displayName="FilterTrigger";const En=({searchTerm:n,setSearchTerm:r,isFilterOpen:e,setIsFilterOpen:s,filters:a,setFilters:i,loading:l,visibleContacts:o,handleSelectContact:m,selectedContact:c,visibleCount:d,filteredContacts:u,setVisibleCount:w,isMobile:k,activeFilterCount:H,selectedForOppIds:S,onToggleSelection:Q})=>t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(Ot,{placeholder:"Search by name or phone number...",value:n,onChange:g=>r(g.target.value),className:"pl-10"})]}),k?t.jsxs(At,{open:e,onOpenChange:s,children:[t.jsx(ui,{asChild:!0,children:t.jsx(tn,{activeFilterCount:H})}),t.jsx(Ht,{children:t.jsx(Nn,{filters:a,onFiltersChange:i})})]}):t.jsxs(nn,{open:e,onOpenChange:s,children:[t.jsx(sn,{asChild:!0,children:t.jsx(tn,{activeFilterCount:H})}),t.jsx(an,{className:"w-80",align:"end",children:t.jsx(Nn,{filters:a,onFiltersChange:i})})]})]}),t.jsx(rt,{className:"flex-1 -mx-4",children:t.jsx("div",{className:"px-4 space-y-2",children:l?t.jsx("div",{className:"space-y-2",children:[...Array(10)].map((g,B)=>t.jsx(Na,{},B))}):o.length>0?t.jsxs(t.Fragment,{children:[o.map(g=>t.jsxs("div",{onClick:()=>m(g),className:Ie("w-full text-left p-4 bg-background rounded-lg border hover:bg-muted/50 transition-colors flex items-center justify-between cursor-pointer",(c==null?void 0:c.id)===g.id&&"bg-muted/50 border-primary",S.has(g.id)&&"ring-2 ring-primary border-primary"),children:[t.jsx(ut,{checked:S.has(g.id),onCheckedChange:()=>Q(g.id),onClick:B=>B.stopPropagation(),className:"mr-4"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-semibold",children:g.name}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(ot,{className:"h-3 w-3"})," ",g.phone]}),g.callHistory.length>0&&t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(Pt,{className:"h-3 w-3"})," ",new Date(g.callHistory[0].timestamp).toLocaleDateString()]})]})]}),t.jsx(oa,{className:"h-5 w-5 text-muted-foreground"})]},g.id)),d<u.length&&t.jsx("div",{className:"flex justify-center py-4",children:t.jsx(W,{variant:"outline",onClick:()=>w(g=>g+en),children:"Load More"})})]}):t.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[t.jsx(Ge,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),t.jsx("p",{className:"font-medium",children:"No contacts found."}),t.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters."})]})})})]});function zi(){var et;const{user:n,userProfile:r}=_n(),{toast:e}=zn(),{contacts:s,loading:a}=na(),{addOpportunitiesFromContacts:i}=Ln(),[l,o]=N.useState(null),[m,c]=N.useState("contacts"),[d,u]=N.useState(null),[w,k]=N.useState(""),H=sa(w,300),[S,Q]=N.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),[g,B]=N.useState(!1),y=On(),[x,$]=N.useState(null),[le,D]=N.useState(!1),[F,L]=N.useState(en),[Z,h]=N.useState(null),[A,T]=N.useState(!1),[_,K]=N.useState(new Set),[G,f]=N.useState(null),[M,R]=N.useState(!1),U=N.useCallback(()=>{R(!0),e({title:"Syncing Contacts...",description:"Fetching the latest data from the server."}),setTimeout(()=>{R(!1),e({title:"Sync Complete!",description:"Your contact list is up to date."})},1500)},[e]);N.useEffect(()=>{if(!n)return;const b=Te(Se,"liveCallStatus"),v=aa(b,P=>{const O=P.val();if(O&&O.currentContact){const E=we=>{const Ce=we.callHistory?Object.entries(we.callHistory).map(([ve,te])=>({...te,originalIndex:ve})).sort((ve,te)=>new Date(te.timestamp).getTime()-new Date(ve.timestamp).getTime()).map((ve,te,ke)=>({...ve,type:te===ke.length-1?"New Call":"Follow-up"})):[],ye=Ce[0]||null;return{id:we.phoneNumber,name:we.name||"N/A",phone:we.phoneNumber,callHistory:Ce,status:(ye==null?void 0:ye.feedback)||"No History",lastContacted:(ye==null?void 0:ye.timestamp)||new Date().toISOString(),callCount:we.callCount||0}},re=E(O.currentContact),Oe=O.nextContact?E(O.nextContact):void 0;h({...O,currentContact:re,nextContact:Oe}),m!=="live-call"&&c("live-call")}else h(null),m==="live-call"&&c("contacts")});return()=>{v()}},[n,m]);const ue=N.useMemo(()=>s.filter(b=>{if(H&&!(b.name.toLowerCase().includes(H.toLowerCase())||b.phone.includes(H)))return!1;const{dateRange:v,initialCallFeedback:P,followUpCallFeedback:O}=S;if(v!=null&&v.from||v!=null&&v.to){const E=v.from?gt(v.from):null,re=v.to?zt(v.to):null;if(!b.callHistory.some(we=>{const Ce=new Date(we.timestamp);return(!E||Ce>=E)&&(!re||Ce<=re)}))return!1}if(P.length>0){const E=b.callHistory.find(re=>re.type==="New Call");if(!E||!P.includes(E.feedback))return!1}return!(O.length>0&&!b.callHistory.some(re=>re.type==="Follow-up"&&O.includes(re.feedback)))}),[s,H,S]);N.useEffect(()=>{L(en)},[H,S]);const ee=N.useMemo(()=>ue.slice(0,F),[ue,F]),oe=b=>{const{dateRange:v,initialCallFeedback:P,followUpCallFeedback:O}=b,E=P.includes("New Contact"),re=P.filter(te=>te!=="New Contact");if(!(E||re.length>0||O.length>0||(v==null?void 0:v.from))){e({title:"No Filters Selected",description:"Please select at least one filter to export contacts."});return}const we=s.filter(te=>{const ke=te.callHistory&&te.callHistory.length>0,Lt=E&&!ke;let ht=!1;const ft=re.length>0||O.length>0;return ke&&(ft||v!=null&&v.from)&&(E&&!ft?ht=!1:ht=te.callHistory.some(tt=>{if(v!=null&&v.from){const C=gt(v.from),z=v.to?zt(v.to):zt(v.from),V=new Date(tt.timestamp);if(!(V>=C&&V<=z))return!1}if(ft){const C=tt.type==="New Call"&&re.includes(tt.feedback),z=tt.type==="Follow-up"&&O.includes(tt.feedback);if(!C&&!z)return!1}return!0})),Lt||ht});if(we.length===0){e({title:"No Contacts Found",description:"No contacts match the selected filters.",variant:"destructive"});return}const Ce=we.map(te=>{const ke=te.callHistory&&te.callHistory.length>0?te.callHistory[0]:null;return{"Company Name":te.name,"Phone Number":te.phone,"Spoke To":(ke==null?void 0:ke.spokenToName)||"N/A","Last Status":te.status,"Last Message":(ke==null?void 0:ke.message)||"N/A","Last Contacted":te.lastContacted?ge(new Date(te.lastContacted),"PPp"):"N/A"}}),ye=kt.json_to_sheet(Ce),ve=kt.book_new();kt.book_append_sheet(ve,ye,"Contacts"),ye["!cols"]=[{wch:30},{wch:20},{wch:25},{wch:20},{wch:40},{wch:30}],ha(ve,"Filtered_Contacts.xlsx"),e({title:"Export Successful",description:`Exported ${we.length} contacts.`})},ae=b=>{const v=s.find(P=>P.id===b.id);u(v||b),m==="live-call"&&T(!0)},me=(b,v)=>{const P=s.flatMap(O=>O.callHistory.filter(E=>{const re=ge(gt(new Date(E.timestamp)),"yyyy-MM-dd"),Oe=v==="all"||E.type===v;return re===b&&Oe}).map(E=>({contact:O,log:E})));$({date:b,calls:P})},Me=b=>{u(b),T(!0)},xe=async(b,v,P)=>{if(!n){e({title:"Authentication Error",variant:"destructive"});return}const O=Te(Se,`contacts/${b}/callHistory/${v}/message`);try{await Ut(O,P),e({title:"Note updated successfully!"})}catch(E){console.error("Error updating call log message:",E),e({title:"Failed to update note",variant:"destructive"})}},Re=async(b,v,P)=>{if(!n){e({title:"Authentication Error",variant:"destructive"});return}const O=Te(Se,`contacts/${b}/callHistory/${v}/feedback`);try{await Ut(O,P),e({title:"Contact status updated!"})}catch(E){console.error("Error updating call log feedback:",E),e({title:"Failed to update status",variant:"destructive"})}},We=async(b,v)=>{if(!n){e({title:"Authentication Error",variant:"destructive"});return}const P=Te(Se,`contacts/${b}/callHistory/${v}`);try{if(await Ut(P,null),e({title:"Call log deleted."}),x){const O=x.calls.filter(E=>E.log.originalIndex!==v);$({...x,calls:O})}}catch(O){console.error("Error deleting call log:",O),e({title:"Failed to delete log",variant:"destructive"})}},Qe=async b=>{if(!n||b.length===0)return;const v={};b.forEach(({contactId:P,logId:O})=>{v[`contacts/${P}/callHistory/${O}`]=null});try{if(await at(Te(Se),v),e({title:`${b.length} call log(s) deleted.`}),x){const P=new Set(b.map(E=>E.logId)),O=x.calls.filter(E=>!P.has(E.log.originalIndex));$({...x,calls:O})}}catch(P){console.error("Error deleting multiple call logs:",P),e({title:"Failed to delete logs",variant:"destructive"})}},Y=async b=>{var Ce;if(!n){e({title:"Authentication Error",variant:"destructive"});return}const v=s.find(ye=>ye.id===b),P=(Ce=v==null?void 0:v.callHistory)==null?void 0:Ce[0];if(!v||!P||P.feedback!=="Send Details"){e({title:"Invalid Action",description:"This action is only for contacts awaiting details.",variant:"destructive"});return}const O=P.originalIndex;if(!O){e({title:"Data Error",description:"Cannot find the original call log to update.",variant:"destructive"});return}const E=Te(Se,`contacts/${b}/callHistory/${O}`),re=P.message||"",we={feedback:"Interested",message:`[Details Sent on ${new Date().toLocaleDateString()}] ${re}`.trim()};try{await at(E,we),e({title:"Status Updated!",description:`${v.name} is now marked as Interested.`})}catch(ye){console.error("Error marking as sent:",ye),e({title:"Update Failed",variant:"destructive"})}},Pe=b=>{K(v=>{const P=new Set(v);return P.has(b)?P.delete(b):P.add(b),P})},I=()=>{const b=s.filter(v=>_.has(v.id));i(b),K(new Set)},Ze=async b=>{if(!n)return;const v=new Set(s.map(E=>E.phone)),P={};let O=0;if(b.forEach(E=>{if(!v.has(E.phone)){const re=`contacts/${E.phone}`;P[re]={name:E.name,phoneNumber:E.phone,callCount:0,callHistory:{}},O++}}),Object.keys(P).length===0){e({title:"No New Contacts to Save",description:"All imported contacts already exist in your master list."});return}try{await at(Te(Se),P),e({title:"Contacts Saved!",description:`${O} new contacts have been saved to your master list.`})}catch(E){throw console.error("Error saving imported contacts:",E),e({title:"Save Failed",description:"Could not save the imported contacts to Firebase.",variant:"destructive"}),E}},ct=async()=>{if(!n){e({title:"Authentication Error",variant:"destructive"});return}try{const b={};b.liveCallStatus=null,b["dialerBridge/activeWebUser"]=null,await at(Te(Se),b),e({title:"Call session finished."})}catch(b){console.error("Failed to finish session:",b),e({title:"Error",description:"Could not finish the session.",variant:"destructive"})}},Ve=(b,v)=>{f({date:b,count:v})},mt=async()=>{if(!G||!n)return;const{date:b}=G,v={};let P=0;if(s.forEach(O=>{O.callHistory.forEach(E=>{ge(gt(new Date(E.timestamp)),"yyyy-MM-dd")===b&&(v[`contacts/${O.phone}/callHistory/${E.originalIndex}`]=null,P++)})}),Object.keys(v).length>0)try{await at(Te(Se),v),e({title:`Successfully deleted ${P} call logs for ${ge(new Date(b),"PP")}.`})}catch(O){console.error("Error deleting date summary:",O),e({title:"Deletion failed",variant:"destructive"})}f(null)},Je={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},Ne=((et=S.dateRange)!=null&&et.from?1:0)+S.initialCallFeedback.length+S.followUpCallFeedback.length;return a&&s.length===0?t.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[t.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-4 flex items-center justify-between",children:[t.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[t.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:t.jsx(Ge,{className:"h-5 w-5 text-primary"})}),"Sales Tracker"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(gn,{className:"h-9 w-32"}),t.jsx(gn,{className:"h-9 w-48"})]})]}),t.jsx(ja,{})]}):t.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[t.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-2 md:p-4 flex items-center justify-between",children:[t.jsxs("h1",{className:"text-lg md:text-xl font-bold flex items-center gap-2",children:[t.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:t.jsx(Ge,{className:"h-5 w-5 text-primary"})}),t.jsx("span",{className:"hidden sm:inline",children:"Sales Tracker"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(W,{variant:"outline",size:y?"icon":"default",onClick:U,disabled:M,children:[M?t.jsx(yt,{className:Ie("h-4 w-4 animate-spin",!y&&"mr-2")}):t.jsx(ra,{className:Ie("h-4 w-4",!y&&"mr-2")}),t.jsx("span",{className:"hidden md:inline",children:"Sync"})]}),t.jsxs(W,{variant:"outline",size:y?"icon":"default",onClick:()=>D(!0),children:[t.jsx(cs,{className:Ie("h-4 w-4",!y&&"mr-2")}),t.jsx("span",{className:"hidden md:inline",children:"Export"})]}),t.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded-lg",children:[t.jsxs(W,{size:"sm",variant:m==="live-call"?"default":"ghost",onClick:()=>c("live-call"),className:"gap-2 px-2 md:px-3 relative",children:[Z&&t.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 animate-ping"}),t.jsx(ot,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden md:inline",children:"Live Call"})]}),t.jsxs(W,{size:"sm",variant:m==="dialer"?"default":"ghost",onClick:()=>c("dialer"),className:"gap-2 px-2 md:px-3",children:[t.jsx(Oa,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden md:inline",children:"Dialer"})]}),t.jsxs(W,{size:"sm",variant:m==="contacts"?"default":"ghost",onClick:()=>c("contacts"),className:"gap-2 px-2 md:px-3",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden md:inline",children:"Contacts"})]}),t.jsxs(W,{size:"sm",variant:m==="analytics"?"default":"ghost",onClick:()=>c("analytics"),className:"gap-2 px-2 md:px-3",children:[t.jsx(ia,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden md:inline",children:"Analytics"})]})]})]})]}),t.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[t.jsx(Tt,{mode:"wait",children:t.jsx(dt.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:Je,className:"p-4 md:p-6 h-full",children:m==="live-call"?t.jsx(yi,{liveCallData:Z,onUpdateCallLogMessage:xe,onMarkAsSent:Y,onFinishSession:ct}):m==="dialer"?t.jsx(vi,{contacts:s,onSaveImportedContacts:Ze,userProfile:r}):m==="contacts"?y?t.jsx(En,{searchTerm:w,setSearchTerm:k,isFilterOpen:g,setIsFilterOpen:B,filters:S,setFilters:Q,loading:a,visibleContacts:ee,handleSelectContact:ae,selectedContact:d,visibleCount:F,filteredContacts:ue,setVisibleCount:L,isMobile:y,activeFilterCount:Ne,selectedForOppIds:_,onToggleSelection:Pe}):t.jsxs(os,{direction:"horizontal",className:"h-full rounded-lg border",children:[t.jsx(wt,{defaultSize:40,minSize:30,children:t.jsx("div",{className:"p-4 h-full",children:t.jsx(En,{searchTerm:w,setSearchTerm:k,isFilterOpen:g,setIsFilterOpen:B,filters:S,setFilters:Q,loading:a,visibleContacts:ee,handleSelectContact:ae,selectedContact:d,visibleCount:F,filteredContacts:ue,setVisibleCount:L,isMobile:y,activeFilterCount:Ne,selectedForOppIds:_,onToggleSelection:Pe})})}),t.jsx(Gt,{withHandle:!0}),t.jsx(wt,{defaultSize:60,minSize:40,children:d?t.jsx(Dt,{contact:d,onUpdateCallLogMessage:xe,onMarkAsSent:Y}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center text-muted-foreground",children:[t.jsx(Ge,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),t.jsx("p",{children:"Select a contact to view details"})]})})})]}):t.jsx(rt,{className:"h-full -m-4 md:-m-6",children:t.jsx("div",{className:"p-4 md:p-6",children:t.jsx(Ar,{contacts:s,onDateClick:me,onDeleteDate:Ve})})})},m)}),t.jsx(Tt,{children:_.size>0&&m==="contacts"&&t.jsx(dt.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10",children:t.jsxs("div",{className:"flex items-center gap-4 bg-background p-3 rounded-lg shadow-lg border",children:[t.jsxs("span",{className:"text-sm font-medium",children:[_.size," contact(s) selected"]}),t.jsxs(W,{onClick:I,children:[t.jsx($n,{className:"h-4 w-4 mr-2"}),"Add to Opportunities"]})]})})})]}),y&&t.jsx(At,{open:!!d,onOpenChange:b=>!b&&u(null),children:t.jsxs(Ts,{children:[t.jsx(un,{className:"fixed inset-0 bg-black/40"}),t.jsx(Ht,{className:"bg-background flex flex-col outline-none h-[90%] mt-24 fixed bottom-0 left-0 right-0 rounded-t-lg",children:t.jsx(Dt,{contact:d,onUpdateCallLogMessage:xe,onMarkAsSent:Y})})]})}),t.jsx(pi,{isOpen:!!x,onOpenChange:b=>!b&&$(null),data:x,onSelectContact:Me,onUpdateCallLogFeedback:Re,onDeleteCallLog:We,onDeleteMultipleCallLogs:Qe}),t.jsx(wi,{open:le,onOpenChange:D,onExport:oe}),t.jsx(rn,{open:A,onOpenChange:T,children:t.jsx(ln,{className:"max-w-4xl h-[85vh] flex flex-col",children:t.jsx(Dt,{contact:d,onUpdateCallLogMessage:xe,onMarkAsSent:Y})})}),t.jsx(Ms,{open:!!G,onOpenChange:b=>!b&&f(null),onConfirm:mt,itemCount:(G==null?void 0:G.count)||0,itemName:`call logs for ${G?ge(new Date(G.date),"PP"):""}`})]})}export{zi as default};
