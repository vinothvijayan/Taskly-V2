import{c as ne,aF as oe,r as o,j as t,B as I,X as Pe,V as dt,A as ut,ay as mt,l as ht,an as Fe,ao as Le,ap as $e,aq as re,k as je,v as P,o as Ke,m as Oe,e as ze,h as pt,L as ft,aw as xt,aG as Ue,aX as gt,x as vt,aY as yt,aZ as jt,I as le,K as bt,aH as wt,aI as Nt,p as J,aJ as Ct,aK as St,az as Tt,n as Dt,C as Te,U as Et,a_ as ee,a$ as _,aT as It,aR as kt,aU as Rt,aV as At,b0 as se,a6 as Mt,t as Pt,u as Ft,w as Lt,b1 as $t,q as G,aL as Kt,aM as Ot,aN as zt,s as ge}from"./index-C20fHVmm.js";import{d as Ut,g as qt,f as Vt,C as qe,E as _t,D as Bt}from"./DeleteConfirmationDialog-DqhjKW4I.js";import{T as Ve}from"./textarea-DJZO54Po.js";import{S as Ht}from"./send-5UL8mSPm.js";import{S as _e}from"./alert-dialog-CR5ji12a.js";import{C as Wt,e as Be,S as De,a as Ee,b as Ie,c as ke,d as X}from"./select-DzEN2igF.js";import{m as Gt}from"./format-CcypP5ZI.js";import{s as Xt}from"./subDays-BYudXbBI.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Jt=ne("chevrons-up-down",Yt);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Qt=ne("ellipsis",Zt);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],He=ne("message-circle",er);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]],rr=ne("star-off",tr);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],nr=ne("star",sr);function ar(e,s,r){const m=Ut(e,s)/Gt;return qt(r==null?void 0:r.roundingMethod)(m)}function We({taskId:e,initialContent:s="",isEditing:r=!1,commentId:m,onCommentAdded:i,onCancel:d}){const{addComment:l,updateComment:p}=oe(),[u,c]=o.useState(s),[n,h]=o.useState(!1),g=1e3,j=g-u.length,S=async N=>{if(N.preventDefault(),!(!u.trim()||n)){h(!0);try{r&&m?await p(m,e,u):await l(e,u),c(""),i==null||i()}catch(F){console.error("Error submitting comment:",F)}finally{h(!1)}}},D=N=>{N.key==="Enter"&&(N.ctrlKey||N.metaKey)&&(N.preventDefault(),S(N)),N.key==="Escape"&&(d==null||d())};return t.jsxs("form",{onSubmit:S,className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Ve,{value:u,onChange:N=>c(N.target.value),onKeyDown:D,placeholder:"Add a comment... (Ctrl+Enter to submit)",className:"min-h-[80px] resize-none pr-16",maxLength:g,autoFocus:!0}),t.jsx("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:j})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-muted-foreground"}),t.jsxs("div",{className:"flex items-center gap-2",children:[d&&t.jsxs(I,{type:"button",variant:"ghost",size:"sm",onClick:d,disabled:n,children:[t.jsx(Pe,{className:"h-4 w-4 mr-1"}),"Cancel"]}),t.jsxs(I,{type:"submit",size:"sm",disabled:!u.trim()||n||j<0,children:[t.jsx(Ht,{className:"h-4 w-4 mr-1"}),n?"Posting...":r?"Update":"Comment"]})]})]})]})}function ir({comment:e}){const{deleteComment:s}=oe(),{user:r}=dt(),[m,i]=o.useState(!1),d=(r==null?void 0:r.uid)===e.userId,l=g=>{if(!g)return"";const j=g.toDate?g.toDate():new Date(g),S=Vt(j,{addSuffix:!0});return S.includes("less than a minute")?"Just now":S.includes("about a minute")?"1 minute ago":S},p=g=>g.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2),u=()=>{i(!0)},c=async()=>{confirm("Are you sure you want to delete this comment?")&&await s(e.id,e.taskId)},n=()=>{i(!1)},h=()=>{i(!1)};return m?t.jsx("div",{className:"border rounded-lg p-3 bg-muted/20",children:t.jsx(We,{taskId:e.taskId,initialContent:e.content,isEditing:!0,commentId:e.id,onCommentAdded:n,onCancel:h})}):t.jsxs("div",{className:"flex gap-3 group",children:[t.jsxs(ut,{className:"h-8 w-8 flex-shrink-0",children:[t.jsx(mt,{src:e.userPhotoURL,alt:e.userDisplayName}),t.jsx(ht,{className:"text-xs",children:p(e.userDisplayName)})]}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",children:e.userDisplayName}),t.jsx("span",{className:"text-xs text-muted-foreground",children:l(e.createdAt)}),e.isEdited&&t.jsx("span",{className:"text-xs text-muted-foreground",children:"(edited)"}),d&&t.jsxs(Fe,{children:[t.jsx(Le,{asChild:!0,children:t.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(Qt,{className:"h-3 w-3"})})}),t.jsxs($e,{align:"end",children:[t.jsxs(re,{onClick:u,children:[t.jsx(_e,{className:"h-4 w-4 mr-2"}),"Edit"]}),t.jsxs(re,{onClick:c,className:"text-destructive",children:[t.jsx(je,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),t.jsx("div",{className:"text-sm whitespace-pre-wrap break-words",children:e.content})]})]})}function lr({taskId:e,className:s,isExpanded:r,onToggleExpanded:m}){const{comments:i,commentCounts:d,loading:l,subscribeToTaskComments:p,unsubscribeFromTaskComments:u}=oe(),[c,n]=o.useState(!1),h=o.useRef(null),g=i[e]||[];d[e];const j=l[e]===!0&&g.length===0;o.useEffect(()=>{h.current&&clearTimeout(h.current);const D=p(e);return()=>{D&&u(e)}},[e,p,u]),o.useEffect(()=>{r?h.current&&(clearTimeout(h.current),h.current=null):h.current=setTimeout(()=>{u(e)},3e4)},[r,e,u]);const S=()=>{n(!1)};return t.jsx("div",{className:P("w-full pt-0",s),children:t.jsx(Ke,{initial:!1,children:r&&t.jsx(Oe.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{type:"spring",duration:.4,bounce:0},className:"overflow-hidden",children:t.jsx(ze,{className:"mt-1 border-none shadow-none bg-transparent",children:t.jsxs(pt,{className:"py-1 px-2 space-y-3",children:[" ",c?t.jsx(We,{taskId:e,onCommentAdded:S,onCancel:()=>n(!1)}):t.jsxs(I,{variant:"outline",onClick:()=>n(!0),className:"w-full justify-start text-muted-foreground h-9 rounded-md border-dashed hover:border-primary/50 hover:text-primary transition-colors",size:"sm",children:[t.jsx(He,{className:"h-3 w-3 mr-2"}),"Write a comment..."]}),j?t.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground py-4",children:[t.jsx(ft,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Loading comments..."})]}):g.length>0&&t.jsxs("div",{className:"space-y-3 border-t border-border/50 pt-2",children:[" ",g.map(D=>t.jsx(ir,{comment:D},D.id))]})]})})})})})}const or=e=>{if(!e||e.length===0)return 0;const s=e.filter(r=>r.isCompleted).length;return Math.round(s/e.length*100)};function cr({task:e}){var A;const{addSubtask:s,toggleSubtaskStatus:r,deleteSubtask:m}=xt(),[i,d]=o.useState(""),[l,p]=o.useState(!1),u=or(e.subtasks),c=((A=e.subtasks)==null?void 0:A.length)||0,{trackingSubtask:n,isTrackingSubtask:h,startSubtaskTracking:g,stopSubtaskTracking:j,getFormattedTime:S,currentSubtaskElapsedSeconds:D}=Ue(),N=async x=>{x.stopPropagation(),i.trim()&&(await s(e.id,i.trim()),d(""))},F=async(x,b)=>{var U;const $=(U=e.subtasks)==null?void 0:U.find(C=>C.id===b),E=(n==null?void 0:n.subtaskId)===b&&(n==null?void 0:n.taskId)===e.id;$&&!$.isCompleted&&E&&h?await r(e.id,b,{currentSeconds:D,stopTracking:j}):await r(e.id,b)},B=async(x,b)=>{x.stopPropagation(),confirm("Are you sure you want to delete this subtask?")&&await m(e.id,b)},K=x=>{x.stopPropagation(),x.key==="Enter"&&(x.preventDefault(),N(x))},z=()=>{p(!l)};return t.jsxs("div",{className:"pt-0 pb-3 space-y-3",children:[" ",t.jsxs(I,{variant:"ghost",onClick:z,className:"w-full justify-between py-1 px-2 h-auto hover:bg-muted/30 rounded-lg transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["Subtasks ",c>0&&`(${c})`]})]}),l?t.jsx(Wt,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(Ke,{initial:!1,children:l&&t.jsx(Oe.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{type:"spring",duration:.4,bounce:0},className:"overflow-hidden",children:t.jsxs("div",{className:"space-y-3 pt-0",children:[e.subtasks&&e.subtasks.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(gt,{value:u,className:"flex-1 h-2"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[u,"%"]})]}),t.jsx("div",{className:"space-y-2",children:e.subtasks.map(x=>{const b=(n==null?void 0:n.subtaskId)===x.id&&(n==null?void 0:n.taskId)===e.id,$=b?D:x.timeSpent||0;return t.jsxs("div",{className:"flex items-center gap-2 group",children:[t.jsx(vt,{id:`subtask-${x.id}`,checked:x.isCompleted,onCheckedChange:E=>F({},x.id),onClick:E=>E.stopPropagation(),className:"h-4 w-4"}),t.jsxs("label",{htmlFor:`subtask-${x.id}`,className:P("flex-1 text-sm cursor-pointer",x.isCompleted?"line-through text-muted-foreground":"text-foreground"),onClick:E=>E.stopPropagation(),children:[x.title,$>0&&t.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:S($)})]}),t.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity hover:text-primary",onClick:E=>{E.stopPropagation(),b&&h?j():g(e.id,x.id,x.title)},title:b&&h?"Stop tracking":"Start tracking",children:b&&h?t.jsx(yt,{className:"h-3 w-3 fill-current"}):t.jsx(jt,{className:"h-3 w-3"})}),t.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity hover:text-destructive",onClick:E=>B(E,x.id),children:t.jsx(je,{className:"h-3 w-3"})})]},x.id)})})]}),t.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[t.jsx(le,{placeholder:"Add a new subtask...",value:i,onChange:x=>d(x.target.value),onKeyPress:K,onClick:x=>x.stopPropagation(),className:"flex-1 h-9 focus-visible:ring-0 focus-visible:ring-offset-0"}),t.jsx(I,{size:"icon",onClick:N,disabled:!i.trim(),className:"h-9 w-9",children:t.jsx(bt,{className:"h-4 w-4"})})]})]})})})]})}function Yr({task:e,onEdit:s,onDelete:r,onToggleStatus:m,onTogglePriority:i,onStartTimer:d,assignedProfiles:l}){const[p,u]=o.useState(!1),[c,n]=o.useState(!1),{commentCounts:h}=oe(),{trackingTask:g,isTracking:j,startTracking:S,stopTracking:D,trackingSubtask:N}=Ue(),F=(g==null?void 0:g.id)===e.id,B=(N==null?void 0:N.taskId)===e.id,K=e.status==="completed",z=e.dueDate&&new Date(e.dueDate)<new Date&&!K,A=wt(e),x=()=>{r(e.id),u(!1)},b=C=>{const O=new Date(C),H=new Date,q=O.getTime()-H.getTime(),L=Math.ceil(q/(1e3*60*60*24));return L===0?"Today":L===1?"Tomorrow":L===-1?"Yesterday":L<0?`${Math.abs(L)} days ago`:`${L} days`},$=C=>{const O=Math.floor(C/3600),H=Math.floor(C%3600/60);return O>0?`${O}h ${H}m`:`${H}m`},E=h[e.id]||0,U={high:"border-l-destructive",medium:"border-l-primary",low:"border-l-muted-foreground"};return t.jsxs(t.Fragment,{children:[t.jsxs(ze,{className:P("relative transition-all duration-200 group cursor-pointer border-l-4","shadow-sm hover:shadow-md dark:shadow-none","bg-card",z?"border-l-destructive":U[e.priority],K&&"opacity-60 bg-muted/50",F&&"ring-2 ring-primary/50",B&&"ring-2 ring-primary/50",A&&"bg-blue-500/5",z&&"bg-destructive/5"),onClick:C=>{const O=C.target;(C.target===C.currentTarget||!O.closest("button, a, [role='menuitem'], [data-no-edit-on-click]"))&&s(e)},children:[t.jsx("div",{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(I,{onClick:C=>{C.stopPropagation(),m(e.id)},variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full hover:bg-primary/10 transition-all shrink-0",children:K?t.jsx(qe,{className:"h-5 w-5 text-green-600"}):t.jsx(Nt,{className:"h-5 w-5 text-muted-foreground group-hover:text-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsx("h3",{className:P("font-medium text-base leading-snug",K&&"line-through text-muted-foreground"),children:e.title}),t.jsxs("div",{className:"flex items-center gap-1 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsxs(I,{onClick:C=>{C.stopPropagation(),n(!c),e.lastCommentedAt&&Ct(e.id,e.lastCommentedAt)},variant:"ghost",size:"icon",className:"h-7 w-7 relative",children:[t.jsx(He,{className:"h-4 w-4 text-muted-foreground"}),E>0&&t.jsx(J,{variant:"secondary",className:"absolute -top-1 -right-2 h-4 min-w-[16px] justify-center p-0.5 text-[10px]",children:E}),A&&!c&&t.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-primary rounded-full"})]}),t.jsx(I,{onClick:C=>{C.stopPropagation(),i(e.id)},variant:"ghost",size:"icon",className:"h-7 w-7",children:e.priority==="high"?t.jsx(nr,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):t.jsx(rr,{className:"h-4 w-4 text-muted-foreground"})}),t.jsxs(Fe,{children:[t.jsx(Le,{asChild:!0,children:t.jsx(I,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:C=>C.stopPropagation(),children:t.jsx(_t,{className:"h-4 w-4"})})}),t.jsxs($e,{align:"end",className:"w-48",onClick:C=>C.stopPropagation(),children:[t.jsxs(re,{onClick:()=>s(e),children:[t.jsx(_e,{className:"h-4 w-4 mr-2"}),"Edit"]}),t.jsx(re,{onClick:()=>F?D():S(e),children:F?t.jsxs(t.Fragment,{children:[t.jsx(St,{className:"h-4 w-4 mr-2"}),"Stop Timer"]}):t.jsxs(t.Fragment,{children:[t.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Start Timer"]})}),t.jsxs(re,{onClick:()=>u(!0),className:"text-destructive",children:[t.jsx(je,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),e.description&&t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 leading-relaxed",children:e.description}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.dueDate&&t.jsxs(J,{variant:z?"destructive":"outline",children:[t.jsx(Dt,{className:"h-3 w-3 mr-1"}),b(e.dueDate)]}),typeof e.estimatedTime=="number"&&e.estimatedTime>0&&t.jsxs(J,{variant:"secondary",children:[t.jsx(Te,{className:"h-3 w-3 mr-1"}),e.estimatedTime,"m"]}),typeof e.timeSpent=="number"&&t.jsxs(J,{variant:"outline",children:[t.jsx(Te,{className:"h-3 w-3 mr-1"}),$(e.timeSpent)]}),l.length>0&&t.jsxs(J,{variant:"outline",children:[t.jsx(Et,{className:"h-3 w-3 mr-1"}),l.length]})]})]})]})}),t.jsxs("div",{className:"px-4 pb-2 border-t border-border/50","data-no-edit-on-click":!0,children:[(!K||e.subtasks&&e.subtasks.length>0)&&t.jsx(cr,{task:e}),t.jsx(lr,{taskId:e.id,isExpanded:c,onToggleExpanded:()=>n(!c)})]})]}),t.jsx(Bt,{open:p,onOpenChange:u,onConfirm:x,itemName:e.title})]})}var Re=1,dr=.9,ur=.8,mr=.17,me=.1,he=.999,hr=.9999,pr=.99,fr=/[\\\/_+.#"@\[\(\{&]/,xr=/[\\\/_+.#"@\[\(\{&]/g,gr=/[\s-]/,Ge=/[\s-]/g;function ve(e,s,r,m,i,d,l){if(d===s.length)return i===e.length?Re:pr;var p=`${i},${d}`;if(l[p]!==void 0)return l[p];for(var u=m.charAt(d),c=r.indexOf(u,i),n=0,h,g,j,S;c>=0;)h=ve(e,s,r,m,c+1,d+1,l),h>n&&(c===i?h*=Re:fr.test(e.charAt(c-1))?(h*=ur,j=e.slice(i,c-1).match(xr),j&&i>0&&(h*=Math.pow(he,j.length))):gr.test(e.charAt(c-1))?(h*=dr,S=e.slice(i,c-1).match(Ge),S&&i>0&&(h*=Math.pow(he,S.length))):(h*=mr,i>0&&(h*=Math.pow(he,c-i))),e.charAt(c)!==s.charAt(d)&&(h*=hr)),(h<me&&r.charAt(c-1)===m.charAt(d+1)||m.charAt(d+1)===m.charAt(d)&&r.charAt(c-1)!==m.charAt(d))&&(g=ve(e,s,r,m,c+1,d+2,l),g*me>h&&(h=g*me)),h>n&&(n=h),c=r.indexOf(u,c+1);return l[p]=n,n}function Ae(e){return e.toLowerCase().replace(Ge," ")}function vr(e,s,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,ve(e,s,Ae(e),Ae(s),0,0,{})}var te='[cmdk-group=""]',pe='[cmdk-group-items=""]',yr='[cmdk-group-heading=""]',Xe='[cmdk-item=""]',Me=`${Xe}:not([aria-disabled="true"])`,ye="cmdk-item-select",Z="data-value",jr=(e,s,r)=>vr(e,s,r),Ye=o.createContext(void 0),ae=()=>o.useContext(Ye),Je=o.createContext(void 0),be=()=>o.useContext(Je),Ze=o.createContext(void 0),Qe=o.forwardRef((e,s)=>{let r=Q(()=>{var a,v;return{search:"",value:(v=(a=e.value)!=null?a:e.defaultValue)!=null?v:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),m=Q(()=>new Set),i=Q(()=>new Map),d=Q(()=>new Map),l=Q(()=>new Set),p=et(e),{label:u,children:c,value:n,onValueChange:h,filter:g,shouldFilter:j,loop:S,disablePointerSelection:D=!1,vimBindings:N=!0,...F}=e,B=ee(),K=ee(),z=ee(),A=o.useRef(null),x=Rr();W(()=>{if(n!==void 0){let a=n.trim();r.current.value=a,b.emit()}},[n]),W(()=>{x(6,H)},[]);let b=o.useMemo(()=>({subscribe:a=>(l.current.add(a),()=>l.current.delete(a)),snapshot:()=>r.current,setState:(a,v,y)=>{var f,w,T,M;if(!Object.is(r.current[a],v)){if(r.current[a]=v,a==="search")O(),U(),x(1,C);else if(a==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let k=document.getElementById(z);k?k.focus():(f=document.getElementById(B))==null||f.focus()}if(x(7,()=>{var k;r.current.selectedItemId=(k=q())==null?void 0:k.id,b.emit()}),y||x(5,H),((w=p.current)==null?void 0:w.value)!==void 0){let k=v??"";(M=(T=p.current).onValueChange)==null||M.call(T,k);return}}b.emit()}},emit:()=>{l.current.forEach(a=>a())}}),[]),$=o.useMemo(()=>({value:(a,v,y)=>{var f;v!==((f=d.current.get(a))==null?void 0:f.value)&&(d.current.set(a,{value:v,keywords:y}),r.current.filtered.items.set(a,E(v,y)),x(2,()=>{U(),b.emit()}))},item:(a,v)=>(m.current.add(a),v&&(i.current.has(v)?i.current.get(v).add(a):i.current.set(v,new Set([a]))),x(3,()=>{O(),U(),r.current.value||C(),b.emit()}),()=>{d.current.delete(a),m.current.delete(a),r.current.filtered.items.delete(a);let y=q();x(4,()=>{O(),(y==null?void 0:y.getAttribute("id"))===a&&C(),b.emit()})}),group:a=>(i.current.has(a)||i.current.set(a,new Set),()=>{d.current.delete(a),i.current.delete(a)}),filter:()=>p.current.shouldFilter,label:u||e["aria-label"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:B,inputId:z,labelId:K,listInnerRef:A}),[]);function E(a,v){var y,f;let w=(f=(y=p.current)==null?void 0:y.filter)!=null?f:jr;return a?w(a,r.current.search,v):0}function U(){if(!r.current.search||p.current.shouldFilter===!1)return;let a=r.current.filtered.items,v=[];r.current.filtered.groups.forEach(f=>{let w=i.current.get(f),T=0;w.forEach(M=>{let k=a.get(M);T=Math.max(k,T)}),v.push([f,T])});let y=A.current;L().sort((f,w)=>{var T,M;let k=f.getAttribute("id"),ie=w.getAttribute("id");return((T=a.get(ie))!=null?T:0)-((M=a.get(k))!=null?M:0)}).forEach(f=>{let w=f.closest(pe);w?w.appendChild(f.parentElement===w?f:f.closest(`${pe} > *`)):y.appendChild(f.parentElement===y?f:f.closest(`${pe} > *`))}),v.sort((f,w)=>w[1]-f[1]).forEach(f=>{var w;let T=(w=A.current)==null?void 0:w.querySelector(`${te}[${Z}="${encodeURIComponent(f[0])}"]`);T==null||T.parentElement.appendChild(T)})}function C(){let a=L().find(y=>y.getAttribute("aria-disabled")!=="true"),v=a==null?void 0:a.getAttribute(Z);b.setState("value",v||void 0)}function O(){var a,v,y,f;if(!r.current.search||p.current.shouldFilter===!1){r.current.filtered.count=m.current.size;return}r.current.filtered.groups=new Set;let w=0;for(let T of m.current){let M=(v=(a=d.current.get(T))==null?void 0:a.value)!=null?v:"",k=(f=(y=d.current.get(T))==null?void 0:y.keywords)!=null?f:[],ie=E(M,k);r.current.filtered.items.set(T,ie),ie>0&&w++}for(let[T,M]of i.current)for(let k of M)if(r.current.filtered.items.get(k)>0){r.current.filtered.groups.add(T);break}r.current.filtered.count=w}function H(){var a,v,y;let f=q();f&&(((a=f.parentElement)==null?void 0:a.firstChild)===f&&((y=(v=f.closest(te))==null?void 0:v.querySelector(yr))==null||y.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function q(){var a;return(a=A.current)==null?void 0:a.querySelector(`${Xe}[aria-selected="true"]`)}function L(){var a;return Array.from(((a=A.current)==null?void 0:a.querySelectorAll(Me))||[])}function de(a){let v=L()[a];v&&b.setState("value",v.getAttribute(Z))}function ue(a){var v;let y=q(),f=L(),w=f.findIndex(M=>M===y),T=f[w+a];(v=p.current)!=null&&v.loop&&(T=w+a<0?f[f.length-1]:w+a===f.length?f[0]:f[w+a]),T&&b.setState("value",T.getAttribute(Z))}function we(a){let v=q(),y=v==null?void 0:v.closest(te),f;for(;y&&!f;)y=a>0?Ir(y,te):kr(y,te),f=y==null?void 0:y.querySelector(Me);f?b.setState("value",f.getAttribute(Z)):ue(a)}let Ne=()=>de(L().length-1),Ce=a=>{a.preventDefault(),a.metaKey?Ne():a.altKey?we(1):ue(1)},Se=a=>{a.preventDefault(),a.metaKey?de(0):a.altKey?we(-1):ue(-1)};return o.createElement(_.div,{ref:s,tabIndex:-1,...F,"cmdk-root":"",onKeyDown:a=>{var v;(v=F.onKeyDown)==null||v.call(F,a);let y=a.nativeEvent.isComposing||a.keyCode===229;if(!(a.defaultPrevented||y))switch(a.key){case"n":case"j":{N&&a.ctrlKey&&Ce(a);break}case"ArrowDown":{Ce(a);break}case"p":case"k":{N&&a.ctrlKey&&Se(a);break}case"ArrowUp":{Se(a);break}case"Home":{a.preventDefault(),de(0);break}case"End":{a.preventDefault(),Ne();break}case"Enter":{a.preventDefault();let f=q();if(f){let w=new Event(ye);f.dispatchEvent(w)}}}}},o.createElement("label",{"cmdk-label":"",htmlFor:$.inputId,id:$.labelId,style:Mr},u),ce(e,a=>o.createElement(Je.Provider,{value:b},o.createElement(Ye.Provider,{value:$},a))))}),br=o.forwardRef((e,s)=>{var r,m;let i=ee(),d=o.useRef(null),l=o.useContext(Ze),p=ae(),u=et(e),c=(m=(r=u.current)==null?void 0:r.forceMount)!=null?m:l==null?void 0:l.forceMount;W(()=>{if(!c)return p.item(i,l==null?void 0:l.id)},[c]);let n=tt(i,d,[e.value,e.children,d],e.keywords),h=be(),g=V(x=>x.value&&x.value===n.current),j=V(x=>c||p.filter()===!1?!0:x.search?x.filtered.items.get(i)>0:!0);o.useEffect(()=>{let x=d.current;if(!(!x||e.disabled))return x.addEventListener(ye,S),()=>x.removeEventListener(ye,S)},[j,e.onSelect,e.disabled]);function S(){var x,b;D(),(b=(x=u.current).onSelect)==null||b.call(x,n.current)}function D(){h.setState("value",n.current,!0)}if(!j)return null;let{disabled:N,value:F,onSelect:B,forceMount:K,keywords:z,...A}=e;return o.createElement(_.div,{ref:se(d,s),...A,id:i,"cmdk-item":"",role:"option","aria-disabled":!!N,"aria-selected":!!g,"data-disabled":!!N,"data-selected":!!g,onPointerMove:N||p.getDisablePointerSelection()?void 0:D,onClick:N?void 0:S},e.children)}),wr=o.forwardRef((e,s)=>{let{heading:r,children:m,forceMount:i,...d}=e,l=ee(),p=o.useRef(null),u=o.useRef(null),c=ee(),n=ae(),h=V(j=>i||n.filter()===!1?!0:j.search?j.filtered.groups.has(l):!0);W(()=>n.group(l),[]),tt(l,p,[e.value,e.heading,u]);let g=o.useMemo(()=>({id:l,forceMount:i}),[i]);return o.createElement(_.div,{ref:se(p,s),...d,"cmdk-group":"",role:"presentation",hidden:h?void 0:!0},r&&o.createElement("div",{ref:u,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),ce(e,j=>o.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},o.createElement(Ze.Provider,{value:g},j))))}),Nr=o.forwardRef((e,s)=>{let{alwaysRender:r,...m}=e,i=o.useRef(null),d=V(l=>!l.search);return!r&&!d?null:o.createElement(_.div,{ref:se(i,s),...m,"cmdk-separator":"",role:"separator"})}),Cr=o.forwardRef((e,s)=>{let{onValueChange:r,...m}=e,i=e.value!=null,d=be(),l=V(c=>c.search),p=V(c=>c.selectedItemId),u=ae();return o.useEffect(()=>{e.value!=null&&d.setState("search",e.value)},[e.value]),o.createElement(_.input,{ref:s,...m,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":u.listId,"aria-labelledby":u.labelId,"aria-activedescendant":p,id:u.inputId,type:"text",value:i?e.value:l,onChange:c=>{i||d.setState("search",c.target.value),r==null||r(c.target.value)}})}),Sr=o.forwardRef((e,s)=>{let{children:r,label:m="Suggestions",...i}=e,d=o.useRef(null),l=o.useRef(null),p=V(c=>c.selectedItemId),u=ae();return o.useEffect(()=>{if(l.current&&d.current){let c=l.current,n=d.current,h,g=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let j=c.offsetHeight;n.style.setProperty("--cmdk-list-height",j.toFixed(1)+"px")})});return g.observe(c),()=>{cancelAnimationFrame(h),g.unobserve(c)}}},[]),o.createElement(_.div,{ref:se(d,s),...i,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":p,"aria-label":m,id:u.listId},ce(e,c=>o.createElement("div",{ref:se(l,u.listInnerRef),"cmdk-list-sizer":""},c)))}),Tr=o.forwardRef((e,s)=>{let{open:r,onOpenChange:m,overlayClassName:i,contentClassName:d,container:l,...p}=e;return o.createElement(It,{open:r,onOpenChange:m},o.createElement(kt,{container:l},o.createElement(Rt,{"cmdk-overlay":"",className:i}),o.createElement(At,{"aria-label":e.label,"cmdk-dialog":"",className:d},o.createElement(Qe,{ref:s,...p}))))}),Dr=o.forwardRef((e,s)=>V(r=>r.filtered.count===0)?o.createElement(_.div,{ref:s,...e,"cmdk-empty":"",role:"presentation"}):null),Er=o.forwardRef((e,s)=>{let{progress:r,children:m,label:i="Loading...",...d}=e;return o.createElement(_.div,{ref:s,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},ce(e,l=>o.createElement("div",{"aria-hidden":!0},l)))}),R=Object.assign(Qe,{List:Sr,Item:br,Input:Cr,Group:wr,Separator:Nr,Dialog:Tr,Empty:Dr,Loading:Er});function Ir(e,s){let r=e.nextElementSibling;for(;r;){if(r.matches(s))return r;r=r.nextElementSibling}}function kr(e,s){let r=e.previousElementSibling;for(;r;){if(r.matches(s))return r;r=r.previousElementSibling}}function et(e){let s=o.useRef(e);return W(()=>{s.current=e}),s}var W=typeof window>"u"?o.useEffect:o.useLayoutEffect;function Q(e){let s=o.useRef();return s.current===void 0&&(s.current=e()),s}function V(e){let s=be(),r=()=>e(s.snapshot());return o.useSyncExternalStore(s.subscribe,r,r)}function tt(e,s,r,m=[]){let i=o.useRef(),d=ae();return W(()=>{var l;let p=(()=>{var c;for(let n of r){if(typeof n=="string")return n.trim();if(typeof n=="object"&&"current"in n)return n.current?(c=n.current.textContent)==null?void 0:c.trim():i.current}})(),u=m.map(c=>c.trim());d.value(e,p,u),(l=s.current)==null||l.setAttribute(Z,p),i.current=p}),i}var Rr=()=>{let[e,s]=o.useState(),r=Q(()=>new Map);return W(()=>{r.current.forEach(m=>m()),r.current=new Map},[e]),(m,i)=>{r.current.set(m,i),s({})}};function Ar(e){let s=e.type;return typeof s=="function"?s(e.props):"render"in s?s.render(e.props):e}function ce({asChild:e,children:s},r){return e&&o.isValidElement(s)?o.cloneElement(Ar(s),{ref:s.ref},r(s.props.children)):r(s)}var Mr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const rt=o.forwardRef(({className:e,...s},r)=>t.jsx(R,{ref:r,className:P("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...s}));rt.displayName=R.displayName;const st=o.forwardRef(({className:e,...s},r)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(Mt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(R.Input,{ref:r,className:P("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...s})]}));st.displayName=R.Input.displayName;const nt=o.forwardRef(({className:e,...s},r)=>t.jsx(R.List,{ref:r,className:P("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...s}));nt.displayName=R.List.displayName;const at=o.forwardRef((e,s)=>t.jsx(R.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));at.displayName=R.Empty.displayName;const it=o.forwardRef(({className:e,...s},r)=>t.jsx(R.Group,{ref:r,className:P("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...s}));it.displayName=R.Group.displayName;const Pr=o.forwardRef(({className:e,...s},r)=>t.jsx(R.Separator,{ref:r,className:P("-mx-1 h-px bg-border",e),...s}));Pr.displayName=R.Separator.displayName;const lt=o.forwardRef(({className:e,...s},r)=>t.jsx(R.Item,{ref:r,className:P("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...s}));lt.displayName=R.Item.displayName;function Fr({options:e,selected:s,onChange:r,placeholder:m="Select items...",label:i,className:d}){const[l,p]=o.useState(!1),u=n=>{r(s.filter(h=>h!==n))},c=n=>{s.includes(n)?r(s.filter(h=>h!==n)):r([...s,n])};return t.jsxs("div",{className:P("grid gap-2",d),children:[i&&t.jsx("label",{className:"text-sm font-medium",children:i}),t.jsxs(Pt,{open:l,onOpenChange:p,children:[t.jsx(Ft,{asChild:!0,children:t.jsxs(I,{variant:"outline",role:"combobox","aria-expanded":l,className:"w-full justify-between text-left font-normal",onClick:()=>p(!l),children:[t.jsx("div",{className:"flex gap-1 flex-wrap",children:s.length>0?s.map(n=>{const h=e.find(g=>g.value===n);return t.jsxs(J,{variant:"secondary",className:"mr-1 mb-1",onClick:g=>{g.preventDefault(),g.stopPropagation(),u(n)},children:[h==null?void 0:h.label,t.jsx("button",{className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onKeyDown:g=>{g.key==="Enter"&&u(n)},onMouseDown:g=>{g.preventDefault(),g.stopPropagation()},onClick:g=>{g.preventDefault(),g.stopPropagation(),u(n)},children:t.jsx(Pe,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},n)}):t.jsx("span",{className:"text-muted-foreground",children:m})}),t.jsx(Jt,{className:"h-4 w-4 shrink-0 opacity-50"})]})}),t.jsx(Lt,{className:"w-full p-0",children:t.jsxs(rt,{children:[t.jsx(st,{placeholder:"Search..."}),t.jsx(at,{children:"No item found."}),t.jsx(it,{children:t.jsx(nt,{children:e.map(n=>t.jsxs(lt,{onSelect:()=>c(n.value),children:[t.jsx($t,{className:P("mr-2 h-4 w-4",s.includes(n.value)?"opacity-100":"opacity-0")}),n.label]},n.value))})})]})})]})]})}function Lr({members:e,selectedIds:s,onSelectionChange:r,label:m="Assigned Members",placeholder:i="Select team members"}){const d=e.map(l=>({label:l.displayName||l.email,value:l.uid}));return t.jsx(Fr,{options:d,selected:s,onChange:r,label:m,placeholder:i})}function Jr({task:e,onSubmit:s,onCancel:r,teamMembers:m}){var c;const[i,d]=o.useState(!1),[l,p]=o.useState({title:(e==null?void 0:e.title)||"",description:(e==null?void 0:e.description)||"",priority:(e==null?void 0:e.priority)||"medium",status:(e==null?void 0:e.status)||"todo",estimatedTime:((c=e==null?void 0:e.estimatedTime)==null?void 0:c.toString())||"",dueDate:(e==null?void 0:e.dueDate)||"",assignedTo:(e==null?void 0:e.assignedTo)||[]}),u=n=>{n.preventDefault(),s({...l,estimatedTime:l.estimatedTime?parseInt(l.estimatedTime,10):void 0,assignedTo:l.assignedTo})};return t.jsxs("form",{onSubmit:u,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx(G,{htmlFor:"title",className:"text-sm font-medium",children:"Title *"}),t.jsx(le,{id:"title",value:l.title,onChange:n=>p({...l,title:n.target.value}),placeholder:"Enter task title",className:"mt-2 transition-smooth focus:ring-2 focus:ring-primary/20",required:!0})]}),t.jsxs("div",{children:[t.jsx(G,{htmlFor:"description",className:"text-sm font-medium",children:"Description"}),t.jsx(Ve,{id:"description",value:l.description,onChange:n=>p({...l,description:n.target.value}),placeholder:"Enter task description",className:"mt-2 transition-smooth focus:ring-2 focus:ring-primary/20",rows:3})]}),t.jsxs("div",{children:[t.jsx(G,{htmlFor:"dueDate",className:"text-sm font-medium",children:"Due Date"}),t.jsx(le,{id:"dueDate",type:"datetime-local",value:l.dueDate,onChange:n=>p({...l,dueDate:n.target.value}),className:"mt-2 transition-smooth focus:ring-2 focus:ring-primary/20"})]}),t.jsxs(Kt,{open:i,onOpenChange:d,children:[t.jsx(Ot,{asChild:!0,children:t.jsxs(I,{variant:"ghost",className:"w-full justify-between px-2 text-muted-foreground hover:text-foreground",children:[t.jsx("span",{children:"Advanced Options"}),t.jsx(Be,{className:P("h-4 w-4 transition-transform",i&&"rotate-180")})]})}),t.jsxs(zt,{className:"space-y-4 pt-4 animate-in fade-in-0 zoom-in-95",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(G,{htmlFor:"priority",className:"text-sm font-medium",children:"Priority"}),t.jsxs(De,{value:l.priority,onValueChange:n=>p({...l,priority:n}),children:[t.jsx(Ee,{className:"mt-2",children:t.jsx(Ie,{})}),t.jsxs(ke,{children:[t.jsx(X,{value:"low",children:"Low"}),t.jsx(X,{value:"medium",children:"Medium"}),t.jsx(X,{value:"high",children:"High"})]})]})]}),t.jsxs("div",{children:[t.jsx(G,{htmlFor:"status",className:"text-sm font-medium",children:"Status"}),t.jsxs(De,{value:l.status,onValueChange:n=>p({...l,status:n}),children:[t.jsx(Ee,{className:"mt-2",children:t.jsx(Ie,{})}),t.jsxs(ke,{children:[t.jsx(X,{value:"todo",children:"To Do"}),t.jsx(X,{value:"in-progress",children:"In Progress"}),t.jsx(X,{value:"completed",children:"Completed"})]})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx(G,{htmlFor:"estimatedTime",className:"text-sm font-medium",children:"Estimated Time (minutes)"}),t.jsx(le,{id:"estimatedTime",type:"number",value:l.estimatedTime,onChange:n=>p({...l,estimatedTime:n.target.value}),placeholder:"25",className:"mt-2 transition-smooth focus:ring-2 focus:ring-primary/20",min:"1"})]})}),m.length>0&&t.jsx("div",{children:t.jsx(Lr,{members:m,selectedIds:l.assignedTo,onSelectionChange:n=>p({...l,assignedTo:n})})})]})]})]}),t.jsxs("div",{className:"flex-shrink-0 flex gap-3 p-6 border-t",children:[t.jsx(I,{type:"button",variant:"outline",onClick:r,className:"hover-scale flex-1",children:"Cancel"}),t.jsx(I,{type:"submit",variant:"focus",className:"flex-1",children:e?"Update Task":"Create Task"})]})]})}const fe={simple:10,standard:20,complex:30},$r={high:1.5,medium:1,low:.75},Y={earlyBird:1.2,onTrack:1.1,onTime:1,slightlyLate:.75,delayed:.5,overdue:0},xe={warmUp:1.05,inTheZone:1.1,onFire:1.2},ot=e=>{const s=e.estimatedTime||25;return s<30?fe.simple:s<=90?fe.standard:fe.complex},ct=e=>$r[e.priority]||1,Kr=e=>{if(!e.dueDate||!e.completedAt)return Y.onTime;const s=new Date(e.dueDate),r=new Date(e.completedAt),m=ar(s,r);return m>24?Y.earlyBird:m>=0?Y.onTrack:m>-24?Y.slightlyLate:m>-72?Y.delayed:Y.overdue},Or=e=>{var i,d;if(e.status!=="completed")return 0;const r=ot(e)*ct(e)*Kr(e),m=((i=e.subtasks)==null?void 0:i.length)||0;if(m>0){const p=(((d=e.subtasks)==null?void 0:d.filter(u=>u.isCompleted).length)||0)/m;return r*p}return r},zr=(e,s)=>{if(e.length===0)return 0;const r=new Set(e.map(d=>ge(new Date(d.completedAt)).getTime()));let m=0,i=ge(s);for(;r.has(i.getTime());)m++,i=Xt(i,1);return m},Ur=e=>e>=7?xe.onFire:e>=4?xe.inTheZone:e>=2?xe.warmUp:1,Zr=(e,s,r)=>{const m=e.filter(u=>u.status==="completed"&&u.completedAt),i=m.filter(u=>{const c=new Date(u.completedAt);return c>=s&&c<=r}),d={};i.forEach(u=>{const c=ge(new Date(u.completedAt)).toISOString();d[c]||(d[c]=[]),d[c].push(u)});let l=0;for(const u in d){const c=new Date(u),h=d[u].reduce((S,D)=>S+Or(D),0),g=zr(m,c),j=Ur(g);l+=h*j}return e.filter(u=>u.status!=="completed"&&u.subtasks&&u.subtasks.length>0).forEach(u=>{const c=u.subtasks.length,n=u.subtasks.filter(h=>h.isCompleted).length;if(n>0){const h=n/c,j=ot(u)*ct(u)*h;l+=j}}),Math.round(l)};export{He as M,nr as S,Yr as T,Jr as a,rr as b,Zr as c,cr as d,lr as e};
