import{c as R,j as e,W as ne,aA as ve,B as A,Y as re,Z as ce,_ as oe,$ as de,v as J,w as me,D as M,aM as V,a7 as q,r as v,ah as be,s as ke,k as I,l as U,n as z,o as _,f as S,b7 as we,b8 as Ce,A as F,aL as K,q as P,C as Y,b9 as Te,a_ as W,aG as Se,U as D,ba as Ae,bb as Q,bc as X,bd as ee,a1 as Me,be as Ee,bf as De,bg as Re,bh as Le,bi as Ie,y as _e,z as $e,E as Ue,bj as ze,M as Fe,a2 as xe,bk as Pe,bl as he,bm as Oe,bn as Be,bo as qe,a8 as Ke,Q as se,L as te,bp as He,X as We,a3 as Ve}from"./index-CIyudF9t.js";import{S as Ge,c as Je,T as ae}from"./scoring-kuiBAh_1.js";import{F as ue,A as Ye,C as Ze}from"./ContributionGraph-DQDUp26k.js";import{L as Qe,S as Xe,D as es}from"./skeletons-_JGSiiy5.js";import{T as pe}from"./trending-up-CNy9roDy.js";import{A as je}from"./index-FV4twmxk.js";import{C as fe,f as ss}from"./formatDistanceToNow-Bu9e27Lo.js";import{A as ge}from"./award-CfTIYRrs.js";import{s as ts}from"./en-US-PHonLEz-.js";import{s as as}from"./startOfMonth-DUJ2JjBB.js";import{U as le}from"./user-plus-DpZnq-4A.js";import{T as ls}from"./target-BfefOx1Y.js";import"./textarea-D92HBPlJ.js";import"./select-cJBpq2ym.js";import"./subDays-gmpfwhzv.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 14V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"bce9hv"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m16 20 2 2 4-4",key:"13tcca"}]],ns=R("calendar-check-2",is);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],cs=R("crown",rs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]],ds=R("git-fork",os);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ie=R("info",ms);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],hs=R("medal",xs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M15.39 4.39a1 1 0 0 0 1.68-.474 2.5 2.5 0 1 1 3.014 3.015 1 1 0 0 0-.474 1.68l1.683 1.682a2.414 2.414 0 0 1 0 3.414L19.61 15.39a1 1 0 0 1-1.68-.474 2.5 2.5 0 1 0-3.014 3.015 1 1 0 0 1 .474 1.68l-1.683 1.682a2.414 2.414 0 0 1-3.414 0L8.61 19.61a1 1 0 0 0-1.68.474 2.5 2.5 0 1 1-3.014-3.015 1 1 0 0 0 .474-1.68l-1.683-1.682a2.414 2.414 0 0 1 0-3.414L4.39 8.61a1 1 0 0 1 1.68.474 2.5 2.5 0 1 0 3.014-3.015 1 1 0 0 1-.474-1.68l1.683-1.682a2.414 2.414 0 0 1 3.414 0z",key:"w46dr5"}]],ps=R("puzzle",us);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]],fs=R("smile-plus",js);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ns=R("square-plus",gs),O=({icon:s,title:l,description:n,children:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:e.jsx(s,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n})]})]}),e.jsx("div",{className:"pl-12 space-y-2",children:o})]}),b=({label:s,value:l,color:n})=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:s}),e.jsx(me,{variant:"secondary",className:M(n==="green"&&"text-green-600 bg-green-100 border-green-200",n==="red"&&"text-red-600 bg-red-100 border-red-200",n==="blue"&&"text-blue-600 bg-blue-100 border-blue-200"),children:l})]});function ys(){return e.jsxs(ne,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:bg-accent",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(re,{className:"sm:max-w-lg",children:[e.jsxs(ce,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"How Scoring Works"]}),e.jsx(de,{children:"Your score is calculated based on task complexity, priority, timeliness, and streaks."})]}),e.jsx(J,{className:"h-[60vh] pr-4",children:e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(O,{icon:ps,title:"Task Complexity",description:"Points based on estimated time.",children:[e.jsx(b,{label:"Simple (< 30m)",value:"+10 pts"}),e.jsx(b,{label:"Standard (30-90m)",value:"+20 pts"}),e.jsx(b,{label:"Complex (> 90m)",value:"+30 pts"})]}),e.jsxs(O,{icon:Ge,title:"Priority Bonus",description:"A multiplier applied to the base score.",children:[e.jsx(b,{label:"High Priority",value:"x 1.5",color:"red"}),e.jsx(b,{label:"Medium Priority",value:"x 1.0"}),e.jsx(b,{label:"Low Priority",value:"x 0.75"})]}),e.jsxs(O,{icon:ns,title:"Timeliness Factor",description:"Bonuses for early completion, penalties for being late.",children:[e.jsx(b,{label:"Early Bird (> 24h early)",value:"+20%",color:"green"}),e.jsx(b,{label:"On Track (< 24h early)",value:"+10%",color:"green"}),e.jsx(b,{label:"On Time (Due day)",value:"+0%"}),e.jsx(b,{label:"Slightly Late (< 24h late)",value:"-25%",color:"red"}),e.jsx(b,{label:"Delayed (1-3 days late)",value:"-50%",color:"red"}),e.jsx(b,{label:"Overdue (> 3 days late)",value:"0 pts",color:"red"})]}),e.jsxs(O,{icon:ue,title:"Daily Streak Bonus",description:"Complete tasks on consecutive days for a score multiplier.",children:[e.jsx(b,{label:"Warm-up (2-3 days)",value:"+5%",color:"blue"}),e.jsx(b,{label:"In the Zone (4-6 days)",value:"+10%",color:"blue"}),e.jsx(b,{label:"On Fire (7+ days)",value:"+20%",color:"blue"})]}),e.jsx(O,{icon:ds,title:"Progressive Tasks",description:"Earn credit for making progress on larger tasks.",children:e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc pl-4 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Partial Credit:"})," Incomplete tasks earn points based on the percentage of subtasks you've finished."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Proportional Score:"})," Completed tasks with subtasks get a final score proportional to how many subtasks were also completed."]})]})})]})})]})]})}const vs=s=>s===0?e.jsx(cs,{className:"h-5 w-5 text-yellow-400"}):s===1?e.jsx(ge,{className:"h-5 w-5 text-gray-400"}):s===2?e.jsx(hs,{className:"h-5 w-5 text-orange-400"}):e.jsx("span",{className:"text-sm font-bold w-5 text-center",children:s+1}),bs=s=>{if(s<60)return"~1m";const l=Math.floor(s/60),n=Math.floor(l/60);return n>0?`${n}h ${l%60}m`:`${l}m`};function ks(){const{tasks:s,teamMembers:l,loading:n}=V(),{userProfile:o}=q(),[p,w]=v.useState("week"),[g,c]=v.useState(null),d=v.useMemo(()=>{const t=new Date;let i,r=be(t);return p==="day"?i=ke(t):p==="week"?i=ts(t):i=as(t),l.map(m=>{const x=s.filter(u=>u.createdBy===m.uid),f=Je(x,i,r),k=x.filter(u=>{if(u.status!=="completed"||!u.completedAt)return!1;const y=new Date(u.completedAt);return y>=i&&y<=r}),C=k.length;let a=0;x.forEach(u=>{var y;(y=u.subtasks)==null||y.forEach(T=>{if(T.isCompleted&&T.completedAt){const L=new Date(T.completedAt);L>=i&&L<=r&&a++}})});const j=k.reduce((u,y)=>u+(y.timeSpent||0),0);let N=0;x.forEach(u=>{var y;(y=u.subtasks)==null||y.forEach(T=>{if(T.isCompleted&&T.completedAt){const L=new Date(T.completedAt);L>=i&&L<=r&&(N+=T.timeSpent||0)}})});const E=j+N;return{userId:m.uid,name:m.displayName||m.email,avatarUrl:m.photoURL,score:f,tasksCompleted:C+a,mainTasksCompleted:C,subtasksCompleted:a,totalTimeSpent:E}}).sort((m,x)=>x.score-m.score)},[s,l,p]);return n?e.jsx(Qe,{}):l.length<=1?null:e.jsxs(I,{className:"shadow-elegant",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Team Leaderboard"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{}),e.jsx("div",{className:"flex items-center gap-1 p-1 bg-muted rounded-lg",children:["day","week","month"].map(t=>e.jsx(A,{size:"sm",variant:p===t?"default":"ghost",onClick:()=>w(t),className:"capitalize text-xs h-7 px-2",children:t},t))})]})]})}),e.jsx(_,{children:e.jsx(je,{children:e.jsx(S.ul,{className:"space-y-1",initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.07}},children:d.length>0?d.slice(0,5).map((t,i)=>e.jsx(we,{asChild:!0,open:g===t.userId,onOpenChange:()=>c(g===t.userId?null:t.userId),children:e.jsxs(S.li,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:M("rounded-lg transition-colors",t.userId===(o==null?void 0:o.uid)&&"bg-primary/10"),children:[e.jsx(Ce,{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-4 p-2 rounded-lg",children:[e.jsx("div",{className:"w-6 flex items-center justify-center",children:vs(i)}),e.jsxs(F,{className:"h-10 w-10 border-2 border-background shadow-sm",children:[e.jsx(K,{src:t.avatarUrl}),e.jsx(P,{className:"bg-muted text-xs",children:t.name.split(" ").map(r=>r[0]).join("").toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[e.jsxs("span",{children:[t.tasksCompleted," items"]}),t.totalTimeSpent>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground/50",children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),bs(t.totalTimeSpent)]})]})]})]}),e.jsx(me,{variant:"secondary",className:"font-bold text-base px-3 py-1 rounded-full",children:t.score})]})}),e.jsx(Te,{children:e.jsx(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"pl-12 pr-4 pb-2",children:e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Performance Breakdown"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"})," Main Tasks"]}),e.jsx("span",{className:"font-bold",children:t.mainTasksCompleted})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"})," Subtasks"]}),e.jsx("span",{className:"font-bold",children:t.subtasksCompleted})]})]})})})]})},t.userId)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No completed tasks for this period yet."})})},p)})})]})}const ws=s=>s.split(" ").map(l=>l[0]).join("").toUpperCase(),Cs=({reactorName:s,reactorAvatarUrl:l,taskTitle:n,emoji:o})=>e.jsxs(S.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:300,damping:25},className:"flex items-center gap-3 p-3 rounded-xl border bg-background/60 backdrop-blur-sm shadow-lg w-80",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(F,{className:"h-10 w-10",children:[e.jsx(K,{src:l}),e.jsx(P,{children:ws(s)})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-background rounded-full p-1 text-lg leading-none",children:o})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:[e.jsx("strong",{children:s})," reacted to an activity"]}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:['Task: "',n,'"']})]})]}),Ne=["ðŸ‘","ðŸ”¥","â¤ï¸"],Ts=(s,l,n,o)=>{const[p,w]=v.useState([]),[g,c]=v.useState(!0),d=v.useRef([]);return v.useEffect(()=>{if(!s){c(!1),w([]);return}const t=Ee(Le(he,"teams",s,"activities"),Re("timestamp","desc"),De(50)),i=Ie(t,r=>{const h=[];r.forEach(m=>{h.push({id:m.id,...m.data()})}),d.current.length>0&&h.forEach(m=>{const x=d.current.find(f=>f.id===m.id);x&&Ne.forEach(f=>{var a,j;const k=new Set(((a=x.reactions)==null?void 0:a[f])||[]);(((j=m.reactions)==null?void 0:j[f])||[]).forEach(N=>{var E;if(!k.has(N)){const u=n.find(T=>T.uid===N),y=m.actor.uid;u&&((E=m.task)!=null&&E.title)&&(o(u,m.task.title,f),l===y&&N!==l&&ze.sendNotification({title:`${f} New Reaction`,body:`${u.displayName||"Someone"} reacted to your activity on "${m.task.title}"`,type:"general",data:{taskId:m.task.id,type:"reaction"}}))}})})}),w(h),d.current=h,c(!1)});return()=>i()},[s,l,n,o]),{activities:p,loading:g}},ye=s=>s?s.split(" ").map(l=>l[0]).join("").toUpperCase():"",Ss=s=>{if(!s||s<60)return"~1m";const l=Math.floor(s/60),n=Math.floor(l/60);return n>0?`${n}h ${l%60}m`:`${l}m`},As=({activity:s,isLast:l})=>{const{user:n,userProfile:o}=q(),p=async c=>{var r;if(!n||!(o!=null&&o.teamId))return;const d=Pe(he,"teams",o.teamId,"activities",s.id),i=(((r=s.reactions)==null?void 0:r[c])||[]).includes(n.uid);await Oe(d,{[`reactions.${c}`]:i?Be(n.uid):qe(n.uid)})},w=()=>{var t,i,r,h,m,x,f,k,C;const c=e.jsx("strong",{className:"font-semibold text-foreground",children:s.actor.displayName}),d=e.jsxs("span",{className:"font-semibold text-primary truncate",children:['"',(t=s.task)==null?void 0:t.title,'"']});switch(s.type){case"TASK_CREATED":return e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," created task ",d]});case"TASK_COMPLETED":const a=((r=(i=s.task)==null?void 0:i.subtasks)==null?void 0:r.filter(y=>y.isCompleted).length)||0,j=((m=(h=s.task)==null?void 0:h.subtasks)==null?void 0:m.length)||0,N=((x=s.task)==null?void 0:x.timeSpent)||0;return e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," completed task ",d]}),(N>0||j>0)&&e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[N>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:Ss(N)})]}),j>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(W,{className:"h-3 w-3"}),e.jsxs("span",{children:[a,"/",j," subtasks"]})]})]})]});case"SUBTASK_CREATED":const E=e.jsxs("strong",{className:"font-medium text-foreground/90",children:['"',(f=s.subtask)==null?void 0:f.title,'"']});return e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," added subtask ",E," to ",d]});case"SUBTASK_COMPLETED":const u=e.jsxs("strong",{className:"font-medium text-foreground/90",children:['"',(k=s.subtask)==null?void 0:k.title,'"']});return e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," completed subtask ",u," in ",d]});case"COMMENT_ADDED":return e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," commented on ",d]}),e.jsx("blockquote",{className:"mt-2 border-l-2 pl-3 text-sm italic text-foreground/80",children:(C=s.comment)==null?void 0:C.contentPreview})]});default:return null}},g=()=>{switch(s.type){case"TASK_CREATED":return e.jsx(Ns,{className:"h-4 w-4 text-blue-500"});case"TASK_COMPLETED":return e.jsx(W,{className:"h-4 w-4 text-green-500"});case"SUBTASK_CREATED":return e.jsx(xe,{className:"h-4 w-4 text-blue-500"});case"SUBTASK_COMPLETED":return e.jsx(fe,{className:"h-4 w-4 text-green-500"});case"COMMENT_ADDED":return e.jsx(Fe,{className:"h-4 w-4 text-purple-500"});default:return e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})}};return e.jsxs(S.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},className:"relative pl-12 py-4",children:[!l&&e.jsx("div",{className:"absolute left-5 top-5 -ml-px mt-1 h-full w-0.5 bg-border"}),e.jsx("div",{className:"absolute left-0 top-4 flex items-center justify-center",children:e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-background border",children:g()})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:w()}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground flex-shrink-0 ml-4",children:[e.jsxs(F,{className:"h-5 w-5",children:[e.jsx(K,{src:s.actor.photoURL}),e.jsx(P,{className:"text-[10px]",children:ye(s.actor.displayName)})]}),e.jsx("span",{children:s.timestamp?ss(s.timestamp.toDate(),{addSuffix:!0}):""})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap pt-1",children:[Object.entries(s.reactions||{}).map(([c,d])=>{if(d.length>0){const t=n?d.includes(n.uid):!1;return e.jsxs(A,{variant:t?"secondary":"outline",size:"sm",className:"h-6 px-2 gap-1 rounded-full border-border/50",onClick:()=>p(c),children:[e.jsx("span",{className:M("text-sm transition-transform",t&&"scale-110"),children:c}),e.jsx("span",{className:M("text-xs",t?"text-primary font-semibold":"text-muted-foreground"),children:d.length})]},c)}return null}),e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-full text-muted-foreground",children:e.jsx(fs,{className:"h-3.5 w-3.5"})})}),e.jsx(Ue,{className:"w-auto p-1",children:e.jsx("div",{className:"flex gap-1",children:Ne.map(c=>e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-lg rounded-full",onClick:()=>p(c),children:c},c))})})]})]})]})]})};function Ms(){var t;const{user:s,userProfile:l}=q(),{teamMembers:n}=V(),[o,p]=v.useState(null),w=v.useCallback((i,r,h)=>{Se.custom(m=>e.jsx(Cs,{reactorName:i.displayName||"A team member",reactorAvatarUrl:i.photoURL,taskTitle:r,emoji:h}),{duration:4e3})},[]),{activities:g,loading:c}=Ts(l==null?void 0:l.teamId,s==null?void 0:s.uid,n,w),d=v.useMemo(()=>o?g.filter(i=>i.actor.uid===o):g,[g,o]);return l!=null&&l.teamId?e.jsxs(I,{className:"shadow-elegant h-[600px] flex flex-col",children:[e.jsxs(U,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Team Activity"]}),e.jsx(Ae,{children:e.jsxs(J,{className:"w-full whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>p(null),className:M("rounded-full",!o&&"border-2 border-primary"),children:e.jsx(F,{className:"h-8 w-8",children:e.jsx(P,{className:"bg-muted",children:e.jsx(D,{className:"h-4 w-4"})})})})}),e.jsx(ee,{children:e.jsx("p",{children:"All Activity"})})]}),n.map(i=>e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>p(i.uid),className:M("rounded-full",o===i.uid&&"border-2 border-primary"),children:e.jsxs(F,{className:"h-8 w-8",children:[e.jsx(K,{src:i.photoURL}),e.jsx(P,{children:ye(i.displayName||i.email)})]})})}),e.jsx(ee,{children:e.jsx("p",{children:i.displayName||i.email})})]},i.uid))]}),e.jsx(Me,{orientation:"horizontal"})]})})]}),e.jsx(_,{className:"flex-1 p-0 overflow-hidden",children:e.jsx(J,{className:"h-full",children:c?e.jsx("div",{className:"space-y-4 p-4",children:[...Array(5)].map((i,r)=>e.jsx(Xe,{className:"h-20 w-full"},r))}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-16",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("h3",{className:"font-medium text-muted-foreground mb-2",children:o?`No activity found for ${(t=n.find(i=>i.uid===o))==null?void 0:t.displayName}`:"No activity yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o?"This team member hasn't performed any actions yet.":"Create or complete a task to get started."})]}):e.jsx("div",{className:"p-4",children:e.jsx(je,{children:d.map((i,r)=>e.jsx(As,{activity:i,isLast:r===d.length-1},i.id))})})})})]}):e.jsxs(I,{className:"shadow-elegant h-full",children:[e.jsx(U,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Team Activity"]})}),e.jsxs(_,{className:"flex flex-col items-center justify-center h-full text-center py-16",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("h3",{className:"font-medium text-muted-foreground mb-2",children:"No Team Found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Join or create a team to see your activity feed."})]})]})}function Es(){const{userProfile:s,sendTeamRequest:l,fetchReceivedTeamRequests:n,acceptTeamRequest:o,declineTeamRequest:p}=q(),{teamMembers:w}=V(),{toast:g}=Ke(),[c,d]=v.useState(""),[t,i]=v.useState([]),[r,h]=v.useState(!1);v.useEffect(()=>{s!=null&&s.teamId||m()},[s]);const m=async()=>{try{const a=await n();i(a)}catch(a){console.error("Failed to fetch team requests:",a)}},x=async()=>{if(c.trim()){h(!0);try{await l(c.trim()),d(""),g({title:"Invite Sent!",description:`A team invitation has been sent to ${c.trim()}.`})}catch(a){g({title:"Error",description:a.message,variant:"destructive"})}finally{h(!1)}}},f=async(a,j)=>{h(!0);try{await o(a,j)}catch(N){g({title:"Error",description:N.message,variant:"destructive"})}finally{h(!1)}},k=async a=>{h(!0);try{await p(a),m()}catch(j){g({title:"Error",description:j.message,variant:"destructive"})}finally{h(!1)}},C=(a,j)=>a&&a.trim()?a.split(" ").map(N=>N[0]).join("").toUpperCase().slice(0,2):j?j.split("@")[0].slice(0,2).toUpperCase():"??";return s!=null&&s.teamId?e.jsxs(I,{className:"shadow-elegant",children:[e.jsx(U,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Your Team"]})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:w.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-muted/50 rounded-lg",children:[e.jsxs(F,{className:"h-8 w-8",children:[e.jsx(K,{src:a.photoURL||""}),e.jsx(P,{className:"text-xs",children:C(a.displayName,a.email)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a.displayName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email})]})]},a.uid))}),e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx("label",{htmlFor:"invite-email",className:"text-sm font-medium",children:"Invite a new member"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{id:"invite-email",placeholder:"colleague@example.com",value:c,onChange:a=>d(a.target.value)}),e.jsx(A,{onClick:x,disabled:r||!c.trim(),size:"icon",children:r?e.jsx(te,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"})})]})]})]})]}):e.jsxs(I,{className:"shadow-elegant",children:[e.jsx(U,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Join or Create a Team"]})}),e.jsxs(_,{className:"space-y-6",children:[t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Pending Invitations"}),t.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-primary/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a.senderName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.senderEmail})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"icon",variant:"outline",className:"h-8 w-8 text-green-500 hover:bg-green-500/10",onClick:()=>f(a.id,a.senderId),disabled:r,children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx(A,{size:"icon",variant:"outline",className:"h-8 w-8 text-red-500 hover:bg-red-500/10",onClick:()=>k(a.id),disabled:r,children:e.jsx(We,{className:"h-4 w-4"})})]})]},a.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"invite-email-create",className:"text-sm font-medium",children:"Invite a colleague to start a team"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{id:"invite-email-create",placeholder:"colleague@example.com",value:c,onChange:a=>d(a.target.value)}),e.jsxs(A,{onClick:x,disabled:r||!c.trim(),children:[r?e.jsx(te,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(le,{className:"h-4 w-4 mr-2"}),"Send Invite"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sending an invite will create a new team with you and the invitee."})]})]})]})}const Ds={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},B={hidden:{y:20,opacity:0},visible:s=>({y:0,opacity:1,transition:{type:"spring",stiffness:100}})},$=({title:s,value:l,icon:n,colorClass:o,bgColorClass:p})=>e.jsx(S.div,{variants:B,children:e.jsx(I,{className:"shadow-elegant overflow-hidden",children:e.jsxs(_,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:s}),e.jsx("p",{className:M("text-xl sm:text-2xl font-bold",o),children:l})]}),e.jsx("div",{className:M("h-10 w-10 sm:h-12 sm:w-12 rounded-lg flex items-center justify-center",p),children:e.jsx(n,{className:M("h-5 w-5 sm:h-6 sm:w-6",o)})})]})})});function Vs(){const{tasks:s,teamMembers:l,setTaskFormActive:n,addTask:o,updateTask:p,getTotalTasksCount:w,getCompletedTasksCount:g,getActiveTasksCount:c,getCurrentStreak:d,getLongestStreak:t,loading:i}=V(),{user:r,userProfile:h,loading:m}=q(),[x,f]=v.useState(null),[k,C]=v.useState(!1);v.useEffect(()=>(n(k||!!x),()=>n(!1)),[k,x,n]);const a=i||m,j=w(),N=g(),E=c(),u=d(),y=t(),T=j>0?Math.round(N/j*100):0,L=H=>{const G={...H,createdBy:(r==null?void 0:r.uid)||null};G.estimatedTime===void 0&&delete G.estimatedTime,o(G),C(!1)},Z=H=>{x&&(p(x.id,H),f(null))};return a?e.jsx(es,{}):k||x?e.jsx("div",{className:"container max-w-2xl mx-auto p-4 sm:p-6",children:e.jsx(ae,{task:x||void 0,onSubmit:x?Z:L,onCancel:()=>{C(!1),f(null)},teamMembers:l})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container max-w-7xl mx-auto p-4 md:p-6 space-y-6",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Dashboard"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome back, ",(h==null?void 0:h.displayName)||(r==null?void 0:r.email),"!"]})]}),e.jsxs(A,{onClick:()=>C(!0),variant:"focus",className:"hover-scale hidden md:flex",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"})," New Task"]})]})}),e.jsxs(S.div,{variants:Ds,initial:"hidden",animate:"visible",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsx($,{title:"Total Tasks",value:j,icon:ls,colorClass:"text-primary",bgColorClass:"bg-primary/10"}),e.jsx($,{title:"Completed",value:N,icon:Ve,colorClass:"text-success",bgColorClass:"bg-success/10"}),e.jsx($,{title:"Active Tasks",value:E,icon:Y,colorClass:"text-focus",bgColorClass:"bg-focus/10"}),e.jsx($,{title:"Completion Rate",value:`${T}%`,icon:pe,colorClass:"text-break",bgColorClass:"bg-break/10"}),e.jsx($,{title:"Current Streak",value:`${u} ${u===1?"day":"days"}`,icon:ue,colorClass:"text-orange-500",bgColorClass:"bg-orange-500/10"}),e.jsx($,{title:"Longest Streak",value:`${y} ${y===1?"day":"days"}`,icon:ge,colorClass:"text-purple-500",bgColorClass:"bg-purple-500/10"})]}),e.jsx(S.div,{variants:B,initial:"hidden",animate:"visible",children:e.jsxs(I,{className:"shadow-elegant",children:[e.jsx(U,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Activity Overview"]})}),e.jsx(_,{children:e.jsx(Ze,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(S.div,{variants:B,initial:"hidden",animate:"visible",className:"lg:col-span-2",children:e.jsx(Ms,{})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(S.div,{variants:B,initial:"hidden",animate:"visible",children:e.jsx(ks,{})}),e.jsx(S.div,{variants:B,initial:"hidden",animate:"visible",children:e.jsx(Es,{})})]})]})]}),e.jsx(ne,{open:!!x,onOpenChange:()=>f(null),children:e.jsxs(re,{className:"sm:max-w-[500px] shadow-elegant max-h-[90vh] flex flex-col p-0",children:[e.jsxs(ce,{className:"p-6 pb-4 border-b",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Edit Task"]}),e.jsx(de,{children:"Make changes to your task here. Click save when you're done."})]}),x&&e.jsx(ae,{task:x,onSubmit:Z,onCancel:()=>f(null),teamMembers:l})]})})]})}export{Vs as default};
