import{c as M,W as Y,r as l,j as e,B as d,e as A,f as T,g as O,I as G,K as J,h as P,S as K,v as Q,p as V,k as X,bw as Z}from"./index-C20fHVmm.js";import{T as ee}from"./textarea-DJZO54Po.js";import te from"./purify.es-aGzT-_H7.js";import{R as se,a as D,b as ae}from"./resizable-VLfMrKzG.js";import{D as re}from"./download-UVAAmKOw.js";import{S as ne}from"./save-DRoTLn0j.js";import{E as oe}from"./external-link-GduCjZXm.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],le=M("link",ie);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],w=M("pencil",ce);function ge(){const{toast:n}=Y(),[y,I]=l.useState(null),[m,L]=l.useState(null),[c,U]=l.useState(()=>{const t=localStorage.getItem("mindmeld-notes");return t?JSON.parse(t):[]}),[a,h]=l.useState(null),[N,b]=l.useState(""),[g,i]=l.useState(""),[E,u]=l.useState(!1),H=async()=>{try{const t=await Z();L(t),I({displayName:"Microsoft Account"}),n({title:"Microsoft Connected",description:"You can now import OneNote pages."})}catch(t){console.error(t),n({title:"Connection failed",description:t.message,variant:"destructive"})}},R=async()=>{if(!m){n({title:"Not connected",description:"Connect Microsoft first.",variant:"destructive"});return}try{const s=await(await fetch("https://graph.microsoft.com/v1.0/me/onenote/pages",{headers:{Authorization:`Bearer ${m}`}})).json();if(!s.value)throw new Error("No OneNote pages found.");const o=s.value.map(r=>{var j,p;return{id:r.id,title:r.title||"Untitled Page",content:"",contentUrl:r.contentUrl,webUrl:(p=(j=r.links)==null?void 0:j.oneNoteWebUrl)==null?void 0:p.href,type:"onenote",createdAt:new Date(r.createdDateTime).toISOString(),updatedAt:new Date(r.lastModifiedDateTime).toISOString()}}),C=[...o,...c.filter(r=>r.type!=="onenote")];x(C),n({title:"OneNote imported",description:`${o.length} pages added from OneNote.`})}catch(t){console.error(t),n({title:"Import failed",description:t.message,variant:"destructive"})}},x=t=>{localStorage.setItem("mindmeld-notes",JSON.stringify(t)),U(t)},S=()=>{if(!N.trim()){n({title:"Title required",description:"Please enter a title.",variant:"destructive"});return}const t={id:Date.now().toString(),title:N,content:"",type:"text",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},s=[t,...c];x(s),h(t),b(""),i(""),n({title:"Note created",description:"Your new note has been created successfully."})},_=async()=>{if(!a)return;const t={...a,content:g,updatedAt:new Date().toISOString()},s=c.map(o=>o.id===a.id?t:o);x(s),h(t),n({title:"Note saved",description:"Your note has been saved successfully."})},B=async t=>{if(h(t),t.type==="text")i(t.content),u(!1);else if(t.type==="onenote"&&t.contentUrl&&m){u(!0),i("");try{const s=await fetch(t.contentUrl,{headers:{Authorization:`Bearer ${m}`}});if(!s.ok)throw new Error("Failed to fetch OneNote content.");const o=await s.text(),r=new DOMParser().parseFromString(o,"text/html"),p=Array.from(r.querySelectorAll('img[src^="https://graph.microsoft.com"]')).map(async f=>{const k=f.getAttribute("src");if(!k)return;const z=await fetch(k,{headers:{Authorization:`Bearer ${m}`}});if(!z.ok)return;const $=await z.blob();return new Promise(W=>{const v=new FileReader;v.onloadend=()=>{f.src=v.result,W(!0)},v.readAsDataURL($)})});await Promise.all(p),r.body.querySelectorAll("[style]").forEach(f=>f.removeAttribute("style"));const de=r.body.innerHTML,q=te.sanitize(r.body.innerHTML,{ADD_TAGS:["img"]});i(q)}catch(s){console.error(s),i('<p class="text-red-500">Could not load note preview.</p>'),n({title:"Error",description:s.message,variant:"destructive"})}finally{u(!1)}}else i("Preview not available for this note."),u(!1)},F=t=>{const s=c.filter(o=>o.id!==t);x(s),(a==null?void 0:a.id)===t&&(h(null),i("")),n({title:"Note deleted",description:"The note has been removed.",variant:"destructive"})};return e.jsxs("div",{className:"container max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notes"}),e.jsx("p",{className:"text-muted-foreground",children:"Create, organize, and import notes"})]}),e.jsx("div",{className:"flex items-center gap-4",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Linked: ",y.displayName]}),e.jsxs(d,{onClick:R,variant:"focus",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Import OneNote"]})]}):e.jsxs(d,{onClick:H,variant:"outline",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Connect Microsoft"]})})]}),e.jsxs(se,{direction:"horizontal",className:"rounded-lg border h-[calc(100vh-200px)]",children:[e.jsx(D,{defaultSize:25,minSize:15,children:e.jsxs(A,{className:"h-full border-0 rounded-none shadow-none",children:[e.jsxs(T,{children:[e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"My Notes"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{placeholder:"Note title...",value:N,onChange:t=>b(t.target.value),onKeyPress:t=>t.key==="Enter"&&S(),className:"flex-1"}),e.jsx(d,{onClick:S,size:"icon",variant:"focus",className:"hover-scale",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsx(P,{className:"p-0",children:e.jsx(K,{className:"h-[calc(100vh-350px)]",children:e.jsxs("div",{className:"p-4 space-y-2",children:[c.map(t=>e.jsx("div",{className:Q("p-3 rounded-lg border cursor-pointer transition-smooth hover-scale",(a==null?void 0:a.id)===t.id?"bg-primary/10 border-primary/30":"hover:bg-muted/50"),onClick:()=>B(t),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(t.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{variant:"secondary",className:"text-xs",children:t.type==="onenote"?"OneNote":"📝"}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:text-destructive",onClick:s=>{s.stopPropagation(),F(t.id)},children:e.jsx(X,{className:"h-3 w-3"})})]})]})},t.id)),c.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No notes yet"}),e.jsx("p",{className:"text-xs",children:"Create or import notes above"})]})]})})})]})}),e.jsx(ae,{withHandle:!0}),e.jsx(D,{defaultSize:75,minSize:30,children:a?e.jsxs(A,{className:"h-full border-0 rounded-none shadow-none flex flex-col",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{className:"flex items-center gap-2",children:e.jsx("span",{children:a.title})}),a.type==="text"?e.jsxs(d,{onClick:_,variant:"focus",size:"sm",className:"hover-scale",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"})," Save"]}):a.webUrl&&e.jsx("a",{href:a.webUrl,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(d,{variant:"outline",size:"sm",className:"hover-scale",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"})," Open in OneNote"]})})]})}),e.jsx(P,{className:"flex-1 p-6 overflow-auto",children:E?e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Loading note preview..."}):a.type==="text"?e.jsx(ee,{value:g,onChange:t=>i(t.target.value),placeholder:"Write your notes here...",className:"h-full w-full resize-none border-0 p-0 bg-transparent focus-visible:ring-0 text-base leading-relaxed"}):e.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:g}})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(w,{className:"h-16 w-16 mx-auto text-muted-foreground/50"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"Select a note to start editing"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a note from the sidebar or create/import one"})]})]})})})]})]})}export{ge as default};
