import{c as ce,j as e,T as ys,a as ks,b as ke,d as Se,P as se,C as as,U as J,e as X,f as Y,g as Z,h as ee,r as p,A as Ne,k as be,l as we,S as re,B as T,m as k,X as ts,L as ls,M as Ss,n as ne,o as Ee,p as Ae,q as oe,s as He,u as ns,D as ze,t as Oe,v as rs,w as is,x as cs,y as Ds,z as Fs,E as Is,F as os,G as ds,H as ms,I as xs,J as Ts,K as Ms,N as Us,O as Ls,Q as Ps,R as ue,V as fe,W as Rs,Y as $s,Z as Es,_ as As,$ as Hs,a0 as zs,a1 as Ge}from"./index-BOMCLsi_.js";import{T as Os,a as _s,b as Ke,c as B,d as qs,e as G,u as De,w as Qs}from"./xlsx-D4hK8F-4.js";import{f as H,s as me}from"./format-BmZa2Fkx.js";import{m as ve,S as We,a as Vs,C as Bs}from"./skeletons-OrUvxu0E.js";import{T as hs}from"./trending-up-D0DttzfC.js";import{T as Gs}from"./textarea-iMbD7bqt.js";import{A as _e,S as Ks,e as Me}from"./index-DvSqf5q0.js";import{S as Ws,R as us,a as pe,b as fs}from"./resizable-C-O4PE_Y.js";import{C as js}from"./calendar-D4ZJ7g6y.js";import{C as ie}from"./checkbox-pEVMzDLQ.js";import{S as ge}from"./separator-CMjyzDEp.js";import{D as qe,a as Qe,b as Js,c as Xs,d as Ys,F as ps,e as Zs,f as ea,g as sa}from"./drawer-CtMx6SxT.js";import{u as gs,a as Ns,P as bs,D as ws,S as Ue,v as Le,b as aa,c as Ve,C as vs,d as ta,e as la}from"./sortable.esm-ClIdRzMj.js";import{D as na}from"./download-C7V0izbZ.js";import{C as ra}from"./chevron-down-QVhbesXr.js";import{F as ia}from"./file-down-CwB7biTZ.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./index-CqAVEad7.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],oa=ce("arrow-right",ca);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],ma=ce("chevrons-right",da);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ha=ce("circle-play",xa);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],fa=ce("hash",ua);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],pa=ce("phone-call",ja);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Na=ce("user-check",ga),ba=()=>({interested:0,notInterested:0,followUp:0,callback:0,notPicked:0,sendDetails:0,totalCalls:0,duration:0}),Fe=(s,r)=>{const t={};let a=0,l=0,n=0;return s.forEach(d=>{d.callHistory.forEach(f=>{if(r!=="all"&&f.type!==r)return;const o=H(me(new Date(f.timestamp)),"yyyy-MM-dd");t[o]||(t[o]=ba());const c=t[o];switch(c.totalCalls+=1,c.duration+=f.duration,a+=1,n+=f.duration,f.feedback){case"Interested":c.interested+=1,l+=1;break;case"Not Interested":c.notInterested+=1;break;case"Follow Up":c.followUp+=1;break;case"Callback":c.callback+=1;break;case"Not Picked":c.notPicked+=1;break;case"Send Details":c.sendDetails+=1;break}})}),{totalCalls:a,interested:l,totalDuration:n,avgDuration:a>0?Math.round(n/a):0,tableData:t}},he=({title:s,value:r,subValue:t,icon:a,color:l})=>e.jsxs(X,{className:"shadow-sm border-2",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Z,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${l.replace("text-","bg-")}`,children:e.jsx(a,{className:`h-4 w-4 ${l}`})})]}),e.jsxs(ee,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),t&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t})]})]}),Je=s=>{const r=Math.floor(s/3600),t=Math.floor(s%3600/60),a=s%60;return[r,t,a].map(l=>l.toString().padStart(2,"0")).join(":")},Ie=({data:s,onDateClick:r})=>{const t=Object.keys(s.tableData).sort((a,l)=>new Date(l).getTime()-new Date(a).getTime());return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(he,{title:"Total Calls",value:s.totalCalls.toString(),icon:se,color:"text-blue-500"}),e.jsx(he,{title:"Interested",value:s.interested.toString(),subValue:`${s.totalCalls>0?(s.interested/s.totalCalls*100).toFixed(1):0}%`,icon:hs,color:"text-green-500"}),e.jsx(he,{title:"Total Duration",value:Je(s.totalDuration),icon:as,color:"text-purple-500"}),e.jsx(he,{title:"Avg Duration",value:`${Math.round(s.avgDuration/60)}m ${s.avgDuration%60}s`,icon:J,color:"text-orange-500"})]}),e.jsxs(X,{className:"shadow-sm",children:[e.jsx(Y,{children:e.jsx(Z,{className:"text-lg",children:"Daily Call Summary"})}),e.jsx(ee,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(_s,{children:e.jsxs(Ke,{className:"bg-muted/50",children:[e.jsx(B,{className:"font-semibold",children:"Date"}),e.jsx(B,{className:"text-center font-semibold",children:"Interested"}),e.jsx(B,{className:"text-center font-semibold",children:"Not Interested"}),e.jsx(B,{className:"text-center font-semibold",children:"Follow Up"}),e.jsx(B,{className:"text-center font-semibold",children:"Send Details"}),e.jsx(B,{className:"text-center font-semibold",children:"Callback"}),e.jsx(B,{className:"text-center font-semibold",children:"Not Picked"}),e.jsx(B,{className:"text-center font-bold",children:"Total Calls"}),e.jsx(B,{className:"text-right font-semibold",children:"Duration"})]})}),e.jsx(qs,{children:t.map(a=>{const l=s.tableData[a];return e.jsxs(Ke,{onClick:()=>r(a),className:"cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(G,{className:"font-medium",children:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-300 font-medium",children:l.interested})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-300 font-medium",children:l.notInterested})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-300 font-medium",children:l.followUp})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300 font-medium",children:l.sendDetails})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-yellow-50 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300 font-medium",children:l.callback})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-gray-50 text-gray-700 dark:bg-gray-900 dark:text-gray-300 font-medium",children:l.notPicked})}),e.jsx(G,{className:"text-center",children:e.jsx("span",{className:"font-bold text-lg",children:l.totalCalls})}),e.jsx(G,{className:"text-right font-medium",children:Je(l.duration)})]},a)})})]})})})]})]})},wa=({contacts:s,onDateClick:r})=>{const t=Fe(s,"New Call"),a=Fe(s,"Follow-up"),l=Fe(s,"all");return e.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(ys,{defaultValue:"new-calls",className:"space-y-6",children:[e.jsxs(ks,{className:"grid w-full grid-cols-3 md:w-auto md:inline-grid bg-muted p-1 h-auto",children:[e.jsx(ke,{value:"new-calls",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"New Calls"}),e.jsx(ke,{value:"follow-up",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Follow-up Calls"}),e.jsx(ke,{value:"consolidated",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Consolidated Report"})]}),e.jsx(Se,{value:"new-calls",children:e.jsx(Ie,{data:t,onDateClick:n=>r(n,"New Call")})}),e.jsx(Se,{value:"follow-up",children:e.jsx(Ie,{data:a,onDateClick:n=>r(n,"Follow-up")})}),e.jsx(Se,{value:"consolidated",children:e.jsx(Ie,{data:l,onDateClick:n=>r(n,"all")})})]})})},Xe=s=>{switch(s){case"Interested":return e.jsx(T,{className:"bg-green-100 text-green-800 border-green-200",children:"Interested"});case"Follow Up":return e.jsx(T,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Follow-up"});case"Callback":return e.jsx(T,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Callback"});case"Send Details":return e.jsx(T,{className:"bg-indigo-100 text-indigo-800 border-indigo-200",children:"Send Details"});case"Not Interested":return e.jsx(T,{variant:"destructive",children:"Not Interested"});case"Not Picked":return e.jsx(T,{variant:"outline",children:"Not Picked"});default:return e.jsx(T,{variant:"secondary",children:s})}},va=s=>{const r=Math.floor(s/60),t=s%60;return`${r}m ${t.toString().padStart(2,"0")}s`},je=({contact:s,onUpdateCallLogMessage:r})=>{const[t,a]=p.useState(null),[l,n]=p.useState(!1);if(!s)return null;const d=s.callHistory?Object.values(s.callHistory).sort((c,b)=>new Date(b.timestamp).getTime()-new Date(c.timestamp).getTime()):[],f=c=>c.split(" ").map(b=>b[0]).join("").toUpperCase(),o=async()=>{!t||!s||(n(!0),await r(s.id,t.originalIndex,t.content),n(!1),a(null))};return e.jsxs("div",{className:"p-4 md:p-6 flex-1 flex flex-col bg-background overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 flex-shrink-0",children:[e.jsx(Ne,{className:"h-16 w-16 border",children:e.jsx(be,{className:"text-2xl bg-muted",children:f(s.name)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),s.phone]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 flex-1 overflow-hidden",children:[e.jsx("div",{className:"md:w-1/3 space-y-4 flex-shrink-0",children:e.jsxs(X,{className:"shadow-sm",children:[e.jsx(Y,{children:e.jsx(Z,{className:"text-base",children:"Key Info"})}),e.jsxs(ee,{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(hs,{className:"h-4 w-4"}),"Status"]}),Xe(s.status)]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(fa,{className:"h-4 w-4"}),"Total Calls"]}),e.jsx("span",{className:"font-medium",children:s.callCount})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Last Contact"]}),e.jsx("span",{className:"font-medium text-right",children:H(new Date(s.lastContacted),"PP")})]})]})]})}),e.jsxs("div",{className:"md:w-2/3 flex flex-col overflow-hidden min-h-0",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:"Call History"}),e.jsx(re,{className:"flex-1 -mr-6 pr-6",children:e.jsxs("div",{className:"relative pl-8 border-l-2 border-dashed border-border",children:[e.jsx(_e,{children:d.map((c,b)=>e.jsxs(ve.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3,delay:b*.05},className:"relative mb-8",children:[e.jsx("div",{className:"absolute -left-[calc(0.5rem+1px)] top-1 h-4 w-4 rounded-full bg-primary ring-4 ring-background"}),e.jsxs("div",{className:"pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Xe(c.feedback),c.type==="New Call"&&e.jsx(T,{variant:"outline",className:"border-green-500 text-green-600",children:"New Call"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:H(new Date(c.timestamp),"PP, p")})]}),(t==null?void 0:t.originalIndex)!==c.originalIndex&&e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>a({originalIndex:c.originalIndex,content:c.message}),children:e.jsx(Ks,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[(t==null?void 0:t.originalIndex)===c.originalIndex?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Gs,{value:t.content,onChange:x=>a({...t,content:x.target.value}),className:"text-sm",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>a(null),disabled:l,children:[e.jsx(ts,{className:"h-4 w-4 mr-1"})," Cancel"]}),e.jsxs(k,{size:"sm",onClick:o,disabled:l,children:[l?e.jsx(ls,{className:"h-4 w-4 animate-spin"}):e.jsx(Ws,{className:"h-4 w-4 mr-1"})," Save"]})]})]}):c.message&&e.jsxs("p",{className:"text-sm text-muted-foreground italic bg-muted/30 p-3 rounded-md border",children:['"',c.message,'"']}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[c.spokenTo&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Na,{className:"h-3 w-3"})," Spoke to: ",e.jsx("span",{className:"font-medium text-foreground",children:c.spokenTo})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(as,{className:"h-3 w-3"})," Duration: ",e.jsx("span",{className:"font-medium text-foreground",children:va(c.duration)})]})]})]})]})]},c.originalIndex))}),d.length===0&&e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(Ss,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"No call history recorded for this contact."})]})]})})]})]})]})},Ye=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],Pe=({filters:s,onFiltersChange:r})=>{var l;const t=n=>{r({...s,dateRange:n})},a=(n,d,f)=>{const o=s[n],c=f?[...o,d]:o.filter(b=>b!==d);r({...s,[n]:c})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium text-xs",children:"Date Range"}),e.jsxs(Ee,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:oe("w-full justify-start text-left font-normal mt-1",!s.dateRange&&"text-muted-foreground"),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),(l=s.dateRange)!=null&&l.from?s.dateRange.to?e.jsxs(e.Fragment,{children:[H(s.dateRange.from,"LLL dd")," - ",H(s.dateRange.to,"LLL dd")]}):H(s.dateRange.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(He,{className:"w-auto p-0",align:"start",children:e.jsx(js,{initialFocus:!0,mode:"range",selected:s.dateRange,onSelect:t,numberOfMonths:1})})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium text-xs",children:"Initial Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Ye.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`initial-${n}`,checked:s.initialCallFeedback.includes(n),onCheckedChange:d=>a("initialCallFeedback",n,!!d)}),e.jsx("label",{htmlFor:`initial-${n}`,className:"text-sm",children:n})]},`initial-${n}`))})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium text-xs",children:"Follow-up Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Ye.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`followup-${n}`,checked:s.followUpCallFeedback.includes(n),onCheckedChange:d=>a("followUpCallFeedback",n,!!d)}),e.jsx("label",{htmlFor:`followup-${n}`,className:"text-sm",children:n})]},`followup-${n}`))})]})]})},Ca=s=>{switch(s){case"Interested":return e.jsx(T,{className:"bg-green-100 text-green-800",children:"Interested"});case"Follow Up":return e.jsx(T,{className:"bg-blue-100 text-blue-800",children:"Follow-up"});case"Callback":return e.jsx(T,{className:"bg-yellow-100 text-yellow-800",children:"Callback"});case"Send Details":return e.jsx(T,{className:"bg-indigo-100 text-indigo-800",children:"Send Details"});case"Not Interested":return e.jsx(T,{variant:"destructive",children:"Not Interested"});case"Not Picked":return e.jsx(T,{variant:"outline",children:"Not Picked"});default:return e.jsx(T,{variant:"secondary",children:s})}},Cs=({call:s,isOverlay:r=!1,onSelectContact:t})=>e.jsxs("button",{onClick:()=>t&&t(s.contact),className:oe("w-full text-left p-3 rounded-lg border bg-background shadow-sm",r?"cursor-grabbing":"cursor-grab",!r&&"hover:bg-muted/50 transition-colors"),children:[e.jsxs("p",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(Fs,{className:"h-3.5 w-3.5"})," ",s.contact.name]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1.5 flex items-center gap-2",children:[e.jsx(se,{className:"h-3 w-3"})," ",s.contact.phone]})]}),ya=({call:s,onSelectContact:r})=>{const{attributes:t,listeners:a,setNodeRef:l,transform:n,transition:d,isDragging:f}=Ve({id:s.log.originalIndex}),o={transform:vs.Transform.toString(n),transition:d};return e.jsx("div",{ref:l,style:o,...t,...a,className:oe(f&&"opacity-50"),children:e.jsx(Cs,{call:s,onSelectContact:r})})},Ze=({data:s,onSelectContact:r,onUpdateCallLogFeedback:t})=>{const[a,l]=p.useState({}),[n,d]=p.useState(null);p.useEffect(()=>{if(s){const g=s.calls.reduce((w,N)=>{const{feedback:u}=N.log;return w[u]||(w[u]=[]),w[u].push(N),w},{});l(g)}},[s]);const f=gs(Ns(bs,{activationConstraint:{distance:10}})),o=g=>Object.keys(a).find(w=>a[w].some(N=>N.log.originalIndex===g)),c=g=>{const{active:w}=g,N=w.id,u=o(N);if(u){const R=a[u].find(L=>L.log.originalIndex===N);d(R||null)}},b=g=>{const{active:w,over:N}=g;if(d(null),!N)return;const u=w.id,R=N.id,L=o(u),I=o(R)||R;if(!L||!I||L===I)return;const _=a[L].find(q=>q.log.originalIndex===u);if(!_)return;l(q=>{const A={...q};return A[L]=A[L].filter(ae=>ae.log.originalIndex!==u),A[I]||(A[I]=[]),A[I]=[...A[I],_],A});const K=I;t(_.contact.id,_.log.originalIndex,K)},x=["Interested","Follow Up","Callback","Not Interested","Not Picked","Send Details"];return e.jsxs(ws,{sensors:f,onDragStart:c,onDragEnd:b,children:[e.jsxs(re,{className:"h-full w-full",children:[e.jsx("div",{className:"flex space-x-4 pb-4",children:x.map(g=>{const w=a[g]||[];return e.jsxs("div",{id:g,className:"w-72 flex-shrink-0 bg-muted/30 rounded-lg p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-shrink-0",children:[Ca(g),e.jsxs("span",{className:"font-semibold text-sm text-muted-foreground",children:["(",w.length,")"]})]}),e.jsx(Ue,{items:w.map(N=>N.log.originalIndex),strategy:Le,children:e.jsx("div",{className:"space-y-2",children:w.map(N=>e.jsx(ya,{call:N,onSelectContact:r},N.log.originalIndex))})})]},g)})}),e.jsx(Ds,{orientation:"horizontal"})]}),e.jsx(aa,{children:n?e.jsx(Cs,{call:n,isOverlay:!0}):null})]})},ka=s=>{const{isOpen:r,onOpenChange:t,data:a}=s;return ns()?e.jsx(qe,{open:r,onOpenChange:t,children:e.jsxs(Qe,{className:"p-4 h-[85vh]",children:[e.jsxs(Js,{className:"flex-shrink-0 text-left",children:[e.jsxs(Xs,{children:["Call Details for ",a?H(new Date(a.date),"MMMM d, yyyy"):""]}),e.jsx(Ys,{children:"Drag and drop contacts to update their status."})]}),e.jsx("div",{className:"flex-1 overflow-hidden mt-4",children:e.jsx(Ze,{...s})})]})}):e.jsx(ze,{open:r,onOpenChange:t,children:e.jsxs(Oe,{className:"max-w-[95vw] w-full h-[85vh] flex flex-col",children:[e.jsxs(rs,{className:"flex-shrink-0",children:[e.jsxs(is,{children:["Call Details for ",a?H(new Date(a.date),"MMMM d, yyyy"):""]}),e.jsx(cs,{children:"Drag and drop contacts between columns to update their status."})]}),e.jsx("div",{className:"flex-1 overflow-hidden mt-4",children:e.jsx(Ze,{...s})})]})})},es=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],Sa=({open:s,onOpenChange:r,onExport:t})=>{var c,b;const[a,l]=p.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),n=x=>{l(g=>({...g,dateRange:x}))},d=(x,g,w)=>{l(N=>{const u=N[x];return w?{...N,[x]:[...u,g]}:{...N,[x]:u.filter(R=>R!==g)}})},f=()=>{t(a),r(!1)},o=()=>{l({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]})};return e.jsx(ze,{open:s,onOpenChange:r,children:e.jsxs(Oe,{className:"sm:max-w-lg",children:[e.jsxs(rs,{children:[e.jsx(is,{children:"Export Contacts to Excel"}),e.jsx(cs,{children:"Select filters to refine the contact list for your export."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium",children:"Date Range"}),e.jsxs(Ee,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:oe("w-full justify-start text-left font-normal mt-2",!a.dateRange&&"text-muted-foreground"),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),(c=a.dateRange)!=null&&c.from?a.dateRange.to?e.jsxs(e.Fragment,{children:[H(a.dateRange.from,"LLL dd, y")," -"," ",H(a.dateRange.to,"LLL dd, y")]}):H(a.dateRange.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(He,{className:"w-auto p-0",align:"start",children:e.jsx(js,{initialFocus:!0,mode:"range",defaultMonth:(b=a.dateRange)==null?void 0:b.from,selected:a.dateRange,onSelect:n,numberOfMonths:2})})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium",children:"Initial Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:es.map(x=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`export-initial-${x}`,checked:a.initialCallFeedback.includes(x),onCheckedChange:g=>d("initialCallFeedback",x,!!g)}),e.jsx("label",{htmlFor:`export-initial-${x}`,className:"text-sm font-medium leading-none",children:x})]},`initial-${x}`))})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx(ne,{className:"font-medium",children:"Follow-up Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:es.map(x=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`export-followup-${x}`,checked:a.followUpCallFeedback.includes(x),onCheckedChange:g=>d("followUpCallFeedback",x,!!g)}),e.jsx("label",{htmlFor:`export-followup-${x}`,className:"text-sm font-medium leading-none",children:x})]},`followup-${x}`))})]})]}),e.jsxs(Is,{children:[e.jsxs(k,{variant:"outline",onClick:o,children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Clear"]}),e.jsxs(k,{onClick:f,children:[e.jsx(na,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})})},Da=({liveCallData:s,onUpdateCallLogMessage:r})=>{if(!s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(se,{className:"h-16 w-16 mx-auto mb-4 opacity-30"}),e.jsx("h3",{className:"text-xl font-semibold",children:"No Active Call"}),e.jsx("p",{className:"text-sm",children:"Live call details will appear here when a call is initiated from the Sales Dialer app."})]})});const{status:t,currentContact:a,nextContact:l,queuePosition:n}=s,d=f=>f.split(" ").map(o=>o[0]).join("").toUpperCase();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsxs(X,{className:"w-full max-w-md shadow-2xl border-2 border-red-500 animate-pulse-glow-destructive",children:[e.jsx(Y,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500 animate-ping"}),e.jsx(Z,{className:"text-2xl font-bold",children:"Live Call in Progress"})]})}),e.jsxs(ee,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 rounded-lg bg-muted/30",children:[e.jsx(T,{variant:t==="calling"?"destructive":"secondary",className:"animate-pulse",children:t==="calling"?"Calling Now":"Countdown..."}),e.jsx(Ne,{className:"h-24 w-24 border-4 border-muted",children:e.jsx(be,{className:"text-3xl",children:d(a.name)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:a.name}),e.jsx("p",{className:"text-lg text-muted-foreground text-center",children:a.phone})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(Y,{className:"pb-2",children:e.jsxs(Z,{className:"text-base flex items-center gap-2",children:[e.jsx(ma,{className:"h-4 w-4 text-muted-foreground"}),"Up Next"]})}),e.jsx(ee,{children:l?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.phone})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last contact in the queue."})})]}),e.jsxs(X,{children:[e.jsx(Y,{className:"pb-2",children:e.jsxs(Z,{className:"text-base flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),"Queue Position"]})}),e.jsx(ee,{children:e.jsx("p",{className:"font-medium",children:n})})]})]})]})]})}),e.jsx("div",{className:"h-full overflow-hidden rounded-lg border bg-background shadow-sm",children:e.jsx(je,{contact:a,onUpdateCallLogMessage:r})})]})},Te=30,Fa=({id:s,contact:r,children:t,onRemove:a})=>{const{attributes:l,listeners:n,setNodeRef:d,transform:f,transition:o}=Ve({id:s}),c={transform:vs.Transform.toString(f),transition:o};return e.jsxs("div",{ref:d,style:c,...l,...n,className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50 border cursor-grab",children:[t,e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>a(s),children:e.jsx(Ls,{className:"h-4 w-4"})})]})},Ia=({contact:s,isSelected:r,onToggle:t,onAdd:a})=>{const{attributes:l,listeners:n,setNodeRef:d}=Ve({id:s.id}),f=o=>o.split(" ").map(c=>c[0]).join("").toUpperCase();return e.jsxs("div",{ref:d,...l,...n,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>a(s),children:[e.jsx(ie,{id:`contact-${s.id}`,checked:r,onCheckedChange:()=>t(s.id),onClick:o=>o.stopPropagation()}),e.jsxs("label",{htmlFor:`contact-${s.id}`,className:"flex items-center gap-3 cursor-pointer flex-1",children:[e.jsx(Ne,{className:"h-10 w-10 border",children:e.jsx(be,{children:f(s.name)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone})]})]})]})},Ta=({contacts:s})=>{const{user:r}=os(),{toast:t}=ds(),[a,l]=p.useState(""),n=ms(a,300),[d,f]=p.useState(new Set),[o,c]=p.useState([]),[b,x]=p.useState(!1),[g,w]=p.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),[N,u]=p.useState(Te),R=gs(Ns(bs,{activationConstraint:{distance:10}})),L=p.useMemo(()=>s.filter(i=>{if(n&&!(i.name.toLowerCase().includes(n.toLowerCase())||i.phone.includes(n)))return!1;const{dateRange:h,initialCallFeedback:y,followUpCallFeedback:z}=g;if(h!=null&&h.from||h!=null&&h.to){const M=h.from?me(h.from):null,m=h.to?Me(h.to):null;if(!i.callHistory.some(D=>{const v=new Date(D.timestamp);return(!M||v>=M)&&(!m||v<=m)}))return!1}const P=y.length>0,Q=z.length>0;if(!P&&!Q)return!0;let V=!1;if(P){const M=i.callHistory.find(m=>m.type==="New Call");M&&y.includes(M.feedback)&&(V=!0)}let S=!1;return Q&&i.callHistory.some(m=>m.type==="Follow-up"&&z.includes(m.feedback))&&(S=!0),P&&Q?V||S:P?V:Q?S:!0}),[s,n,g]);p.useEffect(()=>{u(Te)},[L]);const I=p.useMemo(()=>{const i=new Set(o.map(h=>h.id));return L.filter(h=>!i.has(h.id))},[L,o]),_=p.useMemo(()=>I.slice(0,N),[I,N]),K=i=>{f(h=>{const y=new Set(h);return y.has(i)?y.delete(i):y.add(i),y})},q=i=>{f(i?new Set(I.map(h=>h.id)):new Set)},A=()=>{const i=s.filter(y=>d.has(y.id)),h=[...o];i.forEach(y=>{h.some(z=>z.id===y.id)||h.push(y)}),c(h),f(new Set),t({title:`${i.length} contact(s) added to queue.`})},ae=i=>{o.some(h=>h.id===i.id)||c(h=>[...h,i])},Ce=i=>{c(h=>h.filter(y=>y.id!==i))},de=async()=>{if(!(!r||o.length===0)){x(!0);try{const i={};i[`dialingQueue/${r.uid}`]=o,i["dialerBridge/activeWebUser"]=r.uid,await Ps(ue(fe),i),t({title:"Dialing Queue Sent!",description:"Open the Sales Dialer app and press 'Start Dialing' to begin."}),c([])}catch(i){console.error("Failed to send dialing queue:",i),t({title:"Failed to send queue",variant:"destructive"})}finally{x(!1)}}},te=i=>{const{active:h,over:y}=i;if(!y)return;const z=String(h.id),P=String(y.id),Q=o.some(S=>S.id===z),V=o.some(S=>S.id===P);if(Q&&V&&z!==P)c(S=>{const M=S.findIndex(j=>j.id===z),m=S.findIndex(j=>j.id===P);return la(S,M,m)});else if(!Q&&(V||y.id==="call-queue-droppable")){const S=I.find(M=>M.id===z);S&&c(M=>{const m=[...M];if(V){const j=m.findIndex(D=>D.id===P);m.splice(j,0,S)}else m.push(S);return m})}},xe=i=>i.split(" ").map(h=>h[0]).join("").toUpperCase();return e.jsx(ws,{sensors:R,collisionDetection:ta,onDragEnd:te,children:e.jsxs(us,{direction:"horizontal",className:"h-full rounded-lg border",children:[e.jsx(pe,{defaultSize:55,minSize:30,children:e.jsxs(X,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[e.jsxs(Y,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"})," Available Contacts"]}),e.jsx(xs,{placeholder:"Search contacts...",value:a,onChange:i=>l(i.target.value),className:"pl-10"}),e.jsxs(Ts,{children:[e.jsx(Ms,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"w-full mt-2",children:[e.jsx(ps,{className:"h-4 w-4 mr-2"})," Advanced Filters ",e.jsx(ra,{className:"h-4 w-4 ml-auto"})]})}),e.jsx(Us,{className:"pt-4 space-y-4",children:e.jsx(Pe,{filters:g,onFiltersChange:w})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(ie,{id:"select-all",checked:d.size>0&&d.size===I.length,onCheckedChange:q}),e.jsxs("label",{htmlFor:"select-all",className:"text-sm font-medium",children:["Select All (",I.length,")"]})]})]}),e.jsx(ee,{className:"flex-1 overflow-hidden p-0",children:e.jsx(re,{className:"h-full",children:e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx(Ue,{items:_.map(i=>i.id),strategy:Le,children:_.map(i=>e.jsx(Ia,{contact:i,isSelected:d.has(i.id),onToggle:K,onAdd:ae},i.id))}),N<I.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{variant:"outline",onClick:()=>u(i=>i+Te),children:"Load More"})})]})})})]})}),e.jsx(fs,{withHandle:!0}),e.jsx(pe,{defaultSize:45,minSize:30,children:e.jsxs(X,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[e.jsx(Y,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"})," Call Queue"]})}),e.jsx(ee,{className:"flex-1 overflow-hidden p-0",children:e.jsx(re,{className:"h-full",children:e.jsxs("div",{className:"p-4 space-y-2",id:"call-queue-droppable",children:[e.jsx(Ue,{items:o.map(i=>i.id),strategy:Le,children:e.jsx(_e,{children:o.map((i,h)=>e.jsx(ve.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsxs(Fa,{id:i.id,contact:i,onRemove:Ce,children:[e.jsxs("span",{className:"font-mono text-sm text-muted-foreground cursor-grab",children:[h+1,"."]}),e.jsx(Ne,{className:"h-10 w-10 border",children:e.jsx(be,{children:xe(i.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.phone})]})]})},i.id))})}),o.length===0&&e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:e.jsx("p",{children:"Click or drag contacts here to build your queue."})})]})})}),e.jsxs("div",{className:"p-4 border-t flex flex-col gap-4 flex-shrink-0",children:[e.jsxs(k,{onClick:A,disabled:d.size===0,variant:"outline",children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Add ",d.size>0?`(${d.size})`:""," to Queue"]}),e.jsxs(k,{onClick:de,disabled:o.length===0||b,children:[b?e.jsx(ls,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Send Queue to Dialer (",o.length,")"]})]})]})})]})})},Re=30,$e=As.forwardRef(({activeFilterCount:s,...r},t)=>e.jsxs(k,{ref:t,variant:"outline",className:"gap-2",...r,children:[e.jsx(ps,{className:"h-4 w-4"}),"Filters",s>0&&e.jsx(T,{variant:"secondary",className:"rounded-full px-2",children:s})]}));$e.displayName="FilterTrigger";const ss=({searchTerm:s,setSearchTerm:r,isFilterOpen:t,setIsFilterOpen:a,filters:l,setFilters:n,loading:d,visibleContacts:f,handleSelectContact:o,selectedContact:c,visibleCount:b,filteredContacts:x,setVisibleCount:g,isMobile:w,activeFilterCount:N})=>e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xs,{placeholder:"Search by name or phone number...",value:s,onChange:u=>r(u.target.value),className:"pl-10"})]}),w?e.jsxs(qe,{open:t,onOpenChange:a,children:[e.jsx(sa,{asChild:!0,children:e.jsx($e,{activeFilterCount:N})}),e.jsx(Qe,{children:e.jsx(Pe,{filters:l,onFiltersChange:n,onApply:()=>a(!1)})})]}):e.jsxs(Ee,{open:t,onOpenChange:a,children:[e.jsx(Ae,{asChild:!0,children:e.jsx($e,{activeFilterCount:N})}),e.jsx(He,{className:"w-80",align:"end",children:e.jsx(Pe,{filters:l,onFiltersChange:n,onApply:()=>a(!1)})})]})]}),e.jsx(re,{className:"flex-1 -mx-4",children:e.jsx("div",{className:"px-4 space-y-2",children:d?e.jsx("div",{className:"space-y-2",children:[...Array(10)].map((u,R)=>e.jsx(Bs,{},R))}):f.length>0?e.jsxs(e.Fragment,{children:[f.map(u=>e.jsxs("button",{onClick:()=>o(u),className:oe("w-full text-left p-4 bg-background rounded-lg border hover:bg-muted/50 transition-colors flex items-center justify-between",(c==null?void 0:c.id)===u.id&&"bg-muted/50 border-primary"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:u.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(se,{className:"h-3 w-3"})," ",u.phone]}),u.callHistory.length>0&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(we,{className:"h-3 w-3"})," ",new Date(u.callHistory[0].timestamp).toLocaleDateString()]})]})]}),e.jsx(zs,{className:"h-5 w-5 text-muted-foreground"})]},u.id)),b<x.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{variant:"outline",onClick:()=>g(u=>u+Re),children:"Load More"})})]}):e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"font-medium",children:"No contacts found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters."})]})})})]});function Ja(){var M;const{user:s}=os(),{toast:r}=ds(),{contacts:t,loading:a}=Rs();p.useState(null);const[l,n]=p.useState("contacts"),[d,f]=p.useState(null),[o,c]=p.useState(""),b=ms(o,300),[x,g]=p.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),[w,N]=p.useState(!1),u=ns(),[R,L]=p.useState(null),[I,_]=p.useState(!1),[K,q]=p.useState(Re),[A,ae]=p.useState(null),[Ce,de]=p.useState(!1);p.useEffect(()=>{if(!s)return;const m=ue(fe,"liveCallStatus"),j=$s(m,D=>{const v=D.val();if(v&&v.currentContact){const C=O=>{const W=O.callHistory?Object.entries(O.callHistory).map(([E,le])=>({...le,originalIndex:E})).sort((E,le)=>new Date(le.timestamp).getTime()-new Date(E.timestamp).getTime()).map((E,le,ye)=>({...E,type:le===ye.length-1?"New Call":"Follow-up"})):[],$=W[0]||null;return{id:O.phoneNumber,name:O.name||"N/A",phone:O.phoneNumber,callHistory:W,status:($==null?void 0:$.feedback)||"No History",lastContacted:($==null?void 0:$.timestamp)||new Date().toISOString(),callCount:O.callCount||0}},F=C(v.currentContact),U=v.nextContact?C(v.nextContact):void 0;ae({...v,currentContact:F,nextContact:U}),l!=="live-call"&&n("live-call")}else ae(null),l==="live-call"&&n("contacts")});return()=>{j()}},[s,l]);const te=p.useMemo(()=>t.filter(m=>{if(b&&!(m.name.toLowerCase().includes(b.toLowerCase())||m.phone.includes(b)))return!1;const{dateRange:j,initialCallFeedback:D,followUpCallFeedback:v}=x;if(j!=null&&j.from||j!=null&&j.to){const C=j.from?me(j.from):null,F=j.to?Me(j.to):null;if(!m.callHistory.some(O=>{const W=new Date(O.timestamp);return(!C||W>=C)&&(!F||W<=F)}))return!1}if(D.length>0){const C=m.callHistory.find(F=>F.type==="New Call");if(!C||!D.includes(C.feedback))return!1}return!(v.length>0&&!m.callHistory.some(F=>F.type==="Follow-up"&&v.includes(F.feedback)))}),[t,b,x]);p.useEffect(()=>{q(Re)},[b,x]);const xe=p.useMemo(()=>te.slice(0,K),[te,K]),i=m=>{const j=t.filter(F=>{const{dateRange:U,initialCallFeedback:O,followUpCallFeedback:W}=m;if(U!=null&&U.from||U!=null&&U.to){const $=U.from?me(U.from):null,E=U.to?Me(U.to):null;if(!F.callHistory.some(ye=>{const Be=new Date(ye.timestamp);return(!$||Be>=$)&&(!E||Be<=E)}))return!1}if(O.length>0){const $=F.callHistory.find(E=>E.type==="New Call");if(!$||!O.includes($.feedback))return!1}return!(W.length>0&&!F.callHistory.some(E=>E.type==="Follow-up"&&W.includes(E.feedback)))});if(j.length===0){r({title:"No Contacts Found",description:"No contacts match the selected filters.",variant:"destructive"});return}const D=j.map(F=>({Name:F.name,"Phone Number":F.phone})),v=De.json_to_sheet(D),C=De.book_new();De.book_append_sheet(C,v,"Contacts"),v["!cols"]=[{wch:30},{wch:20}],Qs(C,"Filtered_Contacts.xlsx"),r({title:"Export Successful",description:`Exported ${j.length} contacts.`})},h=m=>{const j=t.find(D=>D.id===m.id);f(j||m),l==="live-call"&&de(!0)},y=(m,j)=>{const D=t.flatMap(v=>v.callHistory.filter(C=>{const F=H(me(new Date(C.timestamp)),"yyyy-MM-dd"),U=j==="all"||C.type===j;return F===m&&U}).map(C=>({contact:v,log:C})));L({date:m,calls:D})},z=m=>{f(m),de(!0)},P=async(m,j,D)=>{if(!s){r({title:"Authentication Error",variant:"destructive"});return}const v=ue(fe,`contacts/${m}/callHistory/${j}/message`);try{await Ge(v,D),r({title:"Note updated successfully!"})}catch(C){console.error("Error updating call log message:",C),r({title:"Failed to update note",variant:"destructive"})}},Q=async(m,j,D)=>{if(!s){r({title:"Authentication Error",variant:"destructive"});return}const v=ue(fe,`contacts/${m}/callHistory/${j}/feedback`);try{await Ge(v,D),r({title:"Contact status updated!"})}catch(C){console.error("Error updating call log feedback:",C),r({title:"Failed to update status",variant:"destructive"})}},V={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},S=((M=x.dateRange)!=null&&M.from?1:0)+x.initialCallFeedback.length+x.followUpCallFeedback.length;return a&&t.length===0?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[e.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(J,{className:"h-5 w-5 text-primary"})}),"Sales Tracker"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-9 w-32"}),e.jsx(We,{className:"h-9 w-48"})]})]}),e.jsx(Vs,{})]}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[e.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-2 md:p-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-lg md:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(J,{className:"h-5 w-5 text-primary"})}),e.jsx("span",{className:"hidden sm:inline",children:"Sales Tracker"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",size:u?"icon":"default",onClick:()=>_(!0),children:[e.jsx(ia,{className:oe("h-4 w-4",!u&&"mr-2")}),e.jsx("span",{className:"hidden md:inline",children:"Export"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded-lg",children:[e.jsxs(k,{size:"sm",variant:l==="live-call"?"default":"ghost",onClick:()=>n("live-call"),className:"gap-2 px-2 md:px-3 relative",children:[A&&e.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 animate-ping"}),e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Live Call"})]}),e.jsxs(k,{size:"sm",variant:l==="dialer"?"default":"ghost",onClick:()=>n("dialer"),className:"gap-2 px-2 md:px-3",children:[e.jsx(pa,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Dialer"})]}),e.jsxs(k,{size:"sm",variant:l==="contacts"?"default":"ghost",onClick:()=>n("contacts"),className:"gap-2 px-2 md:px-3",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Contacts"})]}),e.jsxs(k,{size:"sm",variant:l==="analytics"?"default":"ghost",onClick:()=>n("analytics"),className:"gap-2 px-2 md:px-3",children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Analytics"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(_e,{mode:"wait",children:e.jsx(ve.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:V,className:"p-4 md:p-6 h-full",children:l==="live-call"?e.jsx(Da,{liveCallData:A,onUpdateCallLogMessage:P}):l==="dialer"?e.jsx(Ta,{contacts:t}):l==="contacts"?u?e.jsx(ss,{searchTerm:o,setSearchTerm:c,isFilterOpen:w,setIsFilterOpen:N,filters:x,setFilters:g,loading:a,visibleContacts:xe,handleSelectContact:h,selectedContact:d,visibleCount:K,filteredContacts:te,setVisibleCount:q,isMobile:u,activeFilterCount:S}):e.jsxs(us,{direction:"horizontal",className:"h-full rounded-lg border",children:[e.jsx(pe,{defaultSize:40,minSize:30,children:e.jsx("div",{className:"p-4 h-full",children:e.jsx(ss,{searchTerm:o,setSearchTerm:c,isFilterOpen:w,setIsFilterOpen:N,filters:x,setFilters:g,loading:a,visibleContacts:xe,handleSelectContact:h,selectedContact:d,visibleCount:K,filteredContacts:te,setVisibleCount:q,isMobile:u,activeFilterCount:S})})}),e.jsx(fs,{withHandle:!0}),e.jsx(pe,{defaultSize:60,minSize:40,children:d?e.jsx(je,{contact:d,onUpdateCallLogMessage:P}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"Select a contact to view details"})]})})})]}):e.jsx(re,{className:"h-full -m-4 md:-m-6",children:e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(wa,{contacts:t,onDateClick:y})})})},l)})}),u&&e.jsx(qe,{open:!!d,onOpenChange:m=>!m&&f(null),children:e.jsxs(Zs,{children:[e.jsx(ea,{className:"fixed inset-0 bg-black/40"}),e.jsx(Qe,{className:"bg-background flex flex-col outline-none h-[90%] mt-24 fixed bottom-0 left-0 right-0 rounded-t-lg",children:e.jsx(je,{contact:d,onUpdateCallLogMessage:P})})]})}),e.jsx(ka,{isOpen:!!R,onOpenChange:m=>!m&&L(null),data:R,onSelectContact:z,onUpdateCallLogFeedback:Q}),e.jsx(Sa,{open:I,onOpenChange:_,onExport:i}),e.jsx(ze,{open:Ce,onOpenChange:de,children:e.jsx(Oe,{className:"max-w-4xl h-[85vh] flex flex-col",children:e.jsx(je,{contact:d,onUpdateCallLogMessage:P})})})]})}export{Ja as default};
