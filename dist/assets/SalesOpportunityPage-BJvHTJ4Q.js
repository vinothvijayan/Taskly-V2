import{c as oe,a1 as ce,a2 as U,a3 as de,a4 as me,a5 as xe,a6 as he,a7 as ue,j as e,a8 as fe,a9 as D,aa as y,ab as O,ac as k,I as V,ad as E,o as je,p as ge,B as N,q as K,l as Q,s as pe,y as X,r as h,e as W,f as _,g as z,h as q,D as Ne,ae as ve,t as Ce,v as we,w as be,J as Se,af as De,ag as ye,ah as Oe,ai as H,E as ke,G as Ee,M as Te,A as G,k as J,m as Pe}from"./index-Coi4WSvr.js";import{u as Ae,a as Fe,D as Me,d as Ie,c as Le,b as Y,C as Ve,S as We,v as qe,P as Re,e as Be}from"./sortable.esm-CBj6-_Q_.js";import{C as Ue}from"./calendar-DhbG5RqC.js";import{f as _e}from"./format-BmZa2Fkx.js";import{a as ze,m as Z}from"./skeletons-CvyxRrJU.js";import{D as He,E as Ge,f as Je}from"./DeleteConfirmationDialog-DeeVsBo_.js";import{T as $e}from"./textarea-CMKVUKrd.js";import{A as Ke}from"./award-DRZrzT_v.js";import{P as Qe}from"./plus-c2vjmgUz.js";import{S as Xe,A as Ye}from"./alert-dialog-DOsUdvSI.js";import{S as Ze}from"./send-BxaMbfxe.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],ee=oe("indian-rupee",es),ss=ce({title:U().min(3,"Title must be at least 3 characters."),contact:U().min(2,"Contact name is required."),value:de.number().min(0,"Value must be a positive number."),closeDate:me({required_error:"A close date is required."}),stage:xe(["Lead","Contact Made","Proposal Sent","Negotiation","Closed Won","Closed Lost"]).default("Lead")});function as({opportunity:s,onSubmit:i,onCancel:u}){const l=he({resolver:ue(ss),defaultValues:{title:(s==null?void 0:s.title)||"",contact:(s==null?void 0:s.contact)||"",value:(s==null?void 0:s.value)||0,closeDate:s!=null&&s.closeDate?new Date(s.closeDate):new Date,stage:(s==null?void 0:s.stage)||"Lead"}}),d=n=>{i({...n,closeDate:n.closeDate.toISOString()})};return e.jsx(fe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(d),className:"space-y-4",children:[e.jsx(D,{control:l.control,name:"title",render:({field:n})=>e.jsxs(y,{children:[e.jsx(O,{children:"Opportunity Title"}),e.jsx(k,{children:e.jsx(V,{placeholder:"e.g., New website for Acme Inc.",...n})}),e.jsx(E,{})]})}),e.jsx(D,{control:l.control,name:"contact",render:({field:n})=>e.jsxs(y,{children:[e.jsx(O,{children:"Contact Name"}),e.jsx(k,{children:e.jsx(V,{placeholder:"Enter contact name...",...n})}),e.jsx(E,{})]})}),e.jsx(D,{control:l.control,name:"value",render:({field:n})=>e.jsxs(y,{children:[e.jsx(O,{children:"Value (₹)"}),e.jsx(k,{children:e.jsx(V,{type:"number",placeholder:"25000",...n})}),e.jsx(E,{})]})}),e.jsx(D,{control:l.control,name:"closeDate",render:({field:n})=>e.jsxs(y,{className:"flex flex-col",children:[e.jsx(O,{children:"Expected Close Date"}),e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(k,{children:e.jsxs(N,{variant:"outline",className:K("w-full pl-3 text-left font-normal",!n.value&&"text-muted-foreground"),children:[n.value?_e(n.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(Q,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(pe,{className:"w-auto p-0",align:"start",children:e.jsx(Ue,{mode:"single",selected:n.value,onSelect:n.onChange,disabled:o=>o<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(E,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(N,{type:"button",variant:"ghost",onClick:u,children:"Cancel"}),e.jsx(N,{type:"submit",children:"Save Opportunity"})]})]})})}const $=["Lead","Contact Made","Proposal Sent","Negotiation","Closed Won","Closed Lost"],se=({opportunity:s,onEdit:i,onDelete:u,isExpanded:l,onExpand:d})=>{const{attributes:n,listeners:o,setNodeRef:r,transform:f,transition:j,isDragging:g}=Y({id:s.id}),{addNoteToOpportunity:m}=X(),{userProfile:x}=Se(),[p,v]=h.useState(""),T={transform:Ve.Transform.toString(f),transition:g?"none":j},P=t=>{t.stopPropagation(),p.trim()&&(m(s.id,p),v(""))},A=t=>t?t.split(" ")[0]:"",C=t=>t?t.split(" ").map(w=>w[0]).join("").toUpperCase().slice(0,2):"";return e.jsx("div",{ref:r,style:T,...n,...o,children:e.jsxs(W,{className:K("mb-4 shadow-sm hover:shadow-md transition-all duration-300 cursor-grab active:cursor-grabbing group",g&&"opacity-50",l&&"ring-2 ring-primary"),onClick:t=>{t.target.closest('button, a, [role="menuitem"], textarea')||d()},children:[e.jsxs(q,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-sm mb-2 pr-2 flex-1",children:s.title}),e.jsxs(De,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>t.stopPropagation(),children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsxs(Oe,{align:"end",onClick:t=>t.stopPropagation(),children:[e.jsxs(H,{onClick:()=>i(s),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(H,{onClick:()=>u(s),className:"text-destructive",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),s.value.toLocaleString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),s.contact]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),"Close: ",new Date(s.closeDate).toLocaleDateString()]})]}),e.jsx(Ye,{children:l&&e.jsx(Z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("h4",{className:"text-xs font-semibold uppercase text-muted-foreground flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"})," Notes"]}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto pr-2",children:s.notes&&s.notes.length>0?[...s.notes].reverse().map(t=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-6 w-6",children:e.jsx(J,{className:"text-xs",children:C(t.authorName)})}),e.jsxs("div",{className:"flex-1 bg-muted/50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-medium",children:A(t.authorName)}),e.jsx("span",{className:"text-muted-foreground",children:Je(new Date(t.createdAt),{addSuffix:!0})})]}),e.jsx("p",{className:"text-sm mt-1",children:t.content})]})]},t.id)):e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No notes yet."})}),e.jsxs("div",{className:"flex gap-2 items-start",onClick:t=>t.stopPropagation(),children:[e.jsx(G,{className:"h-8 w-8 mt-1",children:e.jsx(J,{className:"text-xs",children:x!=null&&x.displayName?C(x.displayName):"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx($e,{placeholder:"Add a note...",className:"text-sm",rows:2,value:p,onChange:t=>v(t.target.value)}),e.jsxs(N,{size:"sm",className:"mt-2",onClick:P,disabled:!p.trim(),children:[e.jsx(Ze,{className:"h-3 w-3 mr-2"})," Add Note"]})]})]})]})})})]})})},ts=({title:s,opportunities:i,onEdit:u,onDelete:l,expandedOppId:d,setExpandedOppId:n})=>{const{setNodeRef:o}=Y({id:s});return e.jsxs("div",{ref:o,className:"w-72 flex-shrink-0 bg-muted/50 rounded-xl flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h3",{className:"font-semibold text-sm flex items-center justify-between",children:[s,e.jsx(Pe,{variant:"secondary",children:i.length})]})}),e.jsx(We,{items:i.map(r=>r.id),strategy:qe,children:e.jsx("div",{className:"p-2 flex-1 overflow-y-auto",children:i.map(r=>e.jsx(se,{opportunity:r,onEdit:u,onDelete:l,isExpanded:d===r.id,onExpand:()=>n(d===r.id?null:r.id)},r.id))})})]})};function gs(){const{opportunities:s,updateOpportunity:i,addOpportunity:u,deleteOpportunity:l,loading:d}=X(),[n,o]=h.useState(null),[r,f]=h.useState(!1),[j,g]=h.useState(null),[m,x]=h.useState(null),[p,v]=h.useState(null),T=Ae(Fe(Re,{activationConstraint:{distance:8}})),P=h.useMemo(()=>s.filter(a=>a.stage!=="Closed Won"&&a.stage!=="Closed Lost").reduce((a,c)=>a+c.value,0),[s]),A=h.useMemo(()=>s.filter(a=>a.stage==="Closed Won").reduce((a,c)=>a+c.value,0),[s]),C=a=>{const{active:c}=a;o(s.find(b=>b.id===c.id)||null),v(null)},t=()=>{o(null)},w={sideEffects:Be({styles:{active:{opacity:"0.5"}}})},ae=a=>{const{active:c,over:b}=a;if(o(null),!b)return;const F=c.id,S=b.id;if(F===S)return;const B=s.find(L=>L.id===F);if(!B)return;const ie=$.includes(S),M=s.find(L=>L.id===S),I=ie?S:M==null?void 0:M.stage;I&&B.stage!==I&&i(F,{stage:I})},te=async a=>{j?await i(j.id,a):await u(a),f(!1),g(null)},R=()=>{f(!1),g(null)},ne=a=>{g(a),f(!0)},le=a=>{x(a)},re=()=>{m&&(l(m.id),x(null))};return d?e.jsx(ze,{}):e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsx(Z.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sales Opportunities"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your sales pipeline from lead to close."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"grid gap-4 grid-cols-2",children:[e.jsxs(W,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Total Pipeline Value"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["₹",P.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["from ",s.filter(a=>a.stage!=="Closed Won"&&a.stage!=="Closed Lost").length," opportunities"]})]})]}),e.jsxs(W,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Total Won Value"}),e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₹",A.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["from ",s.filter(a=>a.stage==="Closed Won").length," deals"]})]})]})]}),e.jsxs(Ne,{open:r,onOpenChange:a=>{a?f(!0):R()},children:[e.jsx(ve,{asChild:!0,children:e.jsxs(N,{variant:"focus",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"})," New Opportunity"]})}),e.jsxs(Ce,{children:[e.jsx(we,{children:e.jsx(be,{children:j?"Edit Opportunity":"Create New Opportunity"})}),e.jsx(as,{opportunity:j||void 0,onSubmit:te,onCancel:R})]})]})]})]})}),e.jsxs(Me,{sensors:T,onDragStart:C,onDragEnd:ae,onDragCancel:t,collisionDetection:Ie,children:[e.jsx("div",{className:"flex-1 flex gap-6 overflow-x-auto pb-4",children:$.map(a=>e.jsx(ts,{title:a,opportunities:s.filter(c=>c.stage===a),onEdit:ne,onDelete:le,expandedOppId:p,setExpandedOppId:v},a))}),e.jsx(Le,{dropAnimation:w,children:n?e.jsx(se,{opportunity:n,onEdit:()=>{},onDelete:()=>{},isExpanded:!1,onExpand:()=>{}}):null})]}),e.jsx(He,{open:!!m,onOpenChange:a=>!a&&x(null),onConfirm:re,title:"Delete Opportunity",itemName:m==null?void 0:m.title})]})}export{gs as default};
