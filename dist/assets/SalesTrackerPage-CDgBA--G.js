import{c as ge,j as e,T as Qs,a as Gs,b as ze,d as Oe,P as ce,C as fs,U as ie,e as Q,f as G,g as K,h as W,r as p,A as Ae,k as Le,l as Pe,B as D,S as oe,m as P,X as ps,L as Be,M as Ks,n as re,o as We,p as Je,q as fe,s as Xe,I as $e,u as js,D as Ye,t as Ze,v as Ns,w as bs,x as vs,y as ws,z as Ws,E as es,F as Js,G as Xs,H as Ys,J as Cs,K as ys,N as Se,O as le,Q as ne,R as Zs,V as et,W as st,Y as tt,Z as at,_ as lt,$ as nt,a0 as He}from"./index-Coi4WSvr.js";import{T as it,a as rt,b as ls,c as Y,d as ot,e as Z,r as ct,u as De,w as dt}from"./xlsx-CwQVswdx.js";import{f as _,s as Ie}from"./format-BmZa2Fkx.js";import{m as he,S as ns,a as mt,C as xt}from"./skeletons-CvyxRrJU.js";import{T as ks}from"./trending-up-Biy7uYmy.js";import{T as ht}from"./textarea-CMKVUKrd.js";import{S as ut}from"./send-BxaMbfxe.js";import{A as Te,S as gt,a as Ss,b as Ds,c as Is,d as Fs,e as Ts,f as Ms,g as As,h as Ls,i as is}from"./alert-dialog-DOsUdvSI.js";import{S as Ps,R as $s,a as be,b as Qe}from"./resizable-DSl8GRYF.js";import{C as Rs}from"./calendar-DhbG5RqC.js";import{C as ue}from"./checkbox-BhXHA9pu.js";import{S as Me}from"./separator-BVdObix0.js";import{D as ss,a as ts,b as ft,c as pt,d as jt,e as Nt,f as bt,F as vt,g as wt}from"./drawer-tSm-RE7J.js";import{u as Es,a as Us,P as zs,D as Os,b as Re,S as Hs,v as _s,c as Ct,C as qs}from"./sortable.esm-CBj6-_Q_.js";import{P as Vs}from"./plus-c2vjmgUz.js";import{D as yt}from"./download-xAN63aXp.js";import{U as rs,F as kt}from"./upload-DWe4BXzI.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./index-DHwlpwL_.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Dt=ge("arrow-right",St);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],Ft=ge("chevrons-right",It);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Mt=ge("circle-play",Tt);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Lt=ge("hash",At);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],$t=ge("phone-call",Pt);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Et=ge("user-check",Rt),Ut=()=>({interested:0,notInterested:0,followUp:0,callback:0,notPicked:0,sendDetails:0,totalCalls:0,duration:0}),_e=(s,l)=>{const i={};let t=0,n=0,a=0;return s.forEach(m=>{m.callHistory.forEach(f=>{if(l!=="all"&&f.type!==l)return;const x=_(Ie(new Date(f.timestamp)),"yyyy-MM-dd");i[x]||(i[x]=Ut());const o=i[x];switch(o.totalCalls+=1,o.duration+=f.duration,t+=1,a+=f.duration,f.feedback){case"Interested":o.interested+=1,n+=1;break;case"Not Interested":o.notInterested+=1;break;case"Follow Up":o.followUp+=1;break;case"Callback":o.callback+=1;break;case"Not Picked":o.notPicked+=1;break;case"Send Details":o.sendDetails+=1;break}})}),{totalCalls:t,interested:n,totalDuration:a,avgDuration:t>0?Math.round(a/t):0,tableData:i}},ke=({title:s,value:l,subValue:i,icon:t,color:n})=>e.jsxs(Q,{className:"shadow-sm border-2",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${n.replace("text-","bg-")}`,children:e.jsx(t,{className:`h-4 w-4 ${n}`})})]}),e.jsxs(W,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]}),os=s=>{const l=Math.floor(s/3600),i=Math.floor(s%3600/60),t=s%60;return[l,i,t].map(n=>n.toString().padStart(2,"0")).join(":")},qe=({data:s,onDateClick:l})=>{const i=Object.keys(s.tableData).sort((t,n)=>new Date(n).getTime()-new Date(t).getTime());return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(ke,{title:"Total Calls",value:s.totalCalls.toString(),icon:ce,color:"text-blue-500"}),e.jsx(ke,{title:"Interested",value:s.interested.toString(),subValue:`${s.totalCalls>0?(s.interested/s.totalCalls*100).toFixed(1):0}%`,icon:ks,color:"text-green-500"}),e.jsx(ke,{title:"Total Duration",value:os(s.totalDuration),icon:fs,color:"text-purple-500"}),e.jsx(ke,{title:"Avg Duration",value:`${Math.round(s.avgDuration/60)}m ${s.avgDuration%60}s`,icon:ie,color:"text-orange-500"})]}),e.jsxs(Q,{className:"shadow-sm",children:[e.jsx(G,{children:e.jsx(K,{className:"text-lg",children:"Daily Call Summary"})}),e.jsx(W,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(it,{children:[e.jsx(rt,{children:e.jsxs(ls,{className:"bg-muted/50",children:[e.jsx(Y,{className:"font-semibold",children:"Date"}),e.jsx(Y,{className:"text-center font-semibold",children:"Interested"}),e.jsx(Y,{className:"text-center font-semibold",children:"Not Interested"}),e.jsx(Y,{className:"text-center font-semibold",children:"Follow Up"}),e.jsx(Y,{className:"text-center font-semibold",children:"Send Details"}),e.jsx(Y,{className:"text-center font-semibold",children:"Callback"}),e.jsx(Y,{className:"text-center font-semibold",children:"Not Picked"}),e.jsx(Y,{className:"text-center font-bold",children:"Total Calls"}),e.jsx(Y,{className:"text-right font-semibold",children:"Duration"})]})}),e.jsx(ot,{children:i.map(t=>{const n=s.tableData[t];return e.jsxs(ls,{onClick:()=>l(t),className:"cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(Z,{className:"font-medium",children:new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-300 font-medium",children:n.interested})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-300 font-medium",children:n.notInterested})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-300 font-medium",children:n.followUp})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300 font-medium",children:n.sendDetails})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-yellow-50 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300 font-medium",children:n.callback})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] h-7 rounded-md bg-gray-50 text-gray-700 dark:bg-gray-900 dark:text-gray-300 font-medium",children:n.notPicked})}),e.jsx(Z,{className:"text-center",children:e.jsx("span",{className:"font-bold text-lg",children:n.totalCalls})}),e.jsx(Z,{className:"text-right font-medium",children:os(n.duration)})]},t)})})]})})})]})]})},zt=({contacts:s,onDateClick:l})=>{const i=_e(s,"New Call"),t=_e(s,"Follow-up"),n=_e(s,"all");return e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(Qs,{defaultValue:"new-calls",className:"space-y-6",children:[e.jsxs(Gs,{className:"grid w-full grid-cols-3 md:w-auto md:inline-grid bg-muted p-1 h-auto",children:[e.jsx(ze,{value:"new-calls",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"New Calls"}),e.jsx(ze,{value:"follow-up",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Follow-up Calls"}),e.jsx(ze,{value:"consolidated",className:"px-6 py-2.5 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:"Consolidated Report"})]}),e.jsx(Oe,{value:"new-calls",children:e.jsx(qe,{data:i,onDateClick:a=>l(a,"New Call")})}),e.jsx(Oe,{value:"follow-up",children:e.jsx(qe,{data:t,onDateClick:a=>l(a,"Follow-up")})}),e.jsx(Oe,{value:"consolidated",children:e.jsx(qe,{data:n,onDateClick:a=>l(a,"all")})})]})})},cs=s=>{switch(s){case"Interested":return e.jsx(P,{className:"bg-green-100 text-green-800 border-green-200",children:"Interested"});case"Follow Up":return e.jsx(P,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Follow-up"});case"Callback":return e.jsx(P,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Callback"});case"Send Details":return e.jsx(P,{className:"bg-indigo-100 text-indigo-800 border-indigo-200",children:"Send Details"});case"Not Interested":return e.jsx(P,{variant:"destructive",children:"Not Interested"});case"Not Picked":return e.jsx(P,{variant:"outline",children:"Not Picked"});default:return e.jsx(P,{variant:"secondary",children:s})}},Ot=s=>{const l=Math.floor(s/60),i=s%60;return`${l}m ${i.toString().padStart(2,"0")}s`},Fe=({contact:s,onUpdateCallLogMessage:l,onMarkAsSent:i})=>{const[t,n]=p.useState(null),[a,m]=p.useState(!1);if(!s)return null;const f=s.callHistory?Object.values(s.callHistory).sort((u,h)=>new Date(h.timestamp).getTime()-new Date(u.timestamp).getTime()):[],x=u=>u.split(" ").map(h=>h[0]).join("").toUpperCase(),o=async()=>{!t||!s||(m(!0),await l(s.id,t.originalIndex,t.content),m(!1),n(null))};return e.jsxs("div",{className:"p-4 md:p-6 flex-1 flex flex-col bg-background overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 flex-shrink-0",children:[e.jsx(Ae,{className:"h-16 w-16 border",children:e.jsx(Le,{className:"text-2xl bg-muted",children:x(s.name)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),s.phone]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"md:w-1/3 space-y-4 flex-shrink-0",children:[e.jsxs(Q,{className:"shadow-sm",children:[e.jsx(G,{children:e.jsx(K,{className:"text-base",children:"Key Info"})}),e.jsxs(W,{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(ks,{className:"h-4 w-4"}),"Status"]}),cs(s.status)]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(Lt,{className:"h-4 w-4"}),"Total Calls"]}),e.jsx("span",{className:"font-medium",children:s.callCount})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Last Contact"]}),e.jsx("span",{className:"font-medium text-right",children:_(new Date(s.lastContacted),"PP")})]})]})]}),s.status==="Send Details"&&e.jsx(he.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(Q,{className:"shadow-sm bg-blue-50 border-blue-200 dark:bg-blue-950 dark:border-blue-800",children:[e.jsx(G,{children:e.jsx(K,{className:"text-base text-blue-800 dark:text-blue-300",children:"Action Required"})}),e.jsxs(W,{children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"This contact is waiting for details to be sent."}),e.jsxs(D,{onClick:()=>i(s.id),className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"Mark Details as Sent"]})]})]})})]}),e.jsxs("div",{className:"md:w-2/3 flex flex-col overflow-hidden min-h-0",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:"Call History"}),e.jsx(oe,{className:"flex-1 -mr-6 pr-6",children:e.jsxs("div",{className:"relative pl-8 border-l-2 border-dashed border-border",children:[e.jsx(Te,{children:f.map((u,h)=>e.jsxs(he.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3,delay:h*.05},className:"relative mb-8",children:[e.jsx("div",{className:"absolute -left-[calc(0.5rem+1px)] top-1 h-4 w-4 rounded-full bg-primary ring-4 ring-background"}),e.jsxs("div",{className:"pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[cs(u.feedback),u.type==="New Call"&&e.jsx(P,{variant:"outline",className:"border-green-500 text-green-600",children:"New Call"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:_(new Date(u.timestamp),"PP, p")})]}),(t==null?void 0:t.originalIndex)!==u.originalIndex&&e.jsx(D,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>n({originalIndex:u.originalIndex,content:u.message}),children:e.jsx(gt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[(t==null?void 0:t.originalIndex)===u.originalIndex?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ht,{value:t.content,onChange:j=>n({...t,content:j.target.value}),className:"text-sm",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>n(null),disabled:a,children:[e.jsx(ps,{className:"h-4 w-4 mr-1"})," Cancel"]}),e.jsxs(D,{size:"sm",onClick:o,disabled:a,children:[a?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):e.jsx(Ps,{className:"h-4 w-4 mr-1"})," Save"]})]})]}):u.message&&e.jsxs("p",{className:"text-sm text-muted-foreground italic bg-muted/30 p-3 rounded-md border",children:['"',u.message,'"']}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[u.spokenTo&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Et,{className:"h-3 w-3"})," Spoke to: ",e.jsx("span",{className:"font-medium text-foreground",children:u.spokenTo})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(fs,{className:"h-3 w-3"})," Duration: ",e.jsx("span",{className:"font-medium text-foreground",children:Ot(u.duration)})]})]})]})]})]},u.originalIndex))}),f.length===0&&e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(Ks,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"No call history recorded for this contact."})]})]})})]})]})]})},ds=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],ms=({filters:s,onFiltersChange:l})=>{var n;const i=a=>{l({...s,dateRange:a})},t=(a,m,f)=>{const x=s[a],o=f?[...x,m]:x.filter(u=>u!==m);l({...s,[a]:o})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-medium text-xs",children:"Date Range"}),e.jsxs(We,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:fe("w-full justify-start text-left font-normal mt-1",!s.dateRange&&"text-muted-foreground"),children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),(n=s.dateRange)!=null&&n.from?s.dateRange.to?e.jsxs(e.Fragment,{children:[_(s.dateRange.from,"LLL dd")," - ",_(s.dateRange.to,"LLL dd")]}):_(s.dateRange.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(Xe,{className:"w-auto p-0",align:"start",children:e.jsx(Rs,{initialFocus:!0,mode:"range",selected:s.dateRange,onSelect:i,numberOfMonths:1})})]})]}),e.jsx(Me,{}),e.jsxs("div",{children:[e.jsx(re,{className:"font-medium text-xs",children:"Initial Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:ds.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:`initial-${a}`,checked:s.initialCallFeedback.includes(a),onCheckedChange:m=>t("initialCallFeedback",a,!!m)}),e.jsx("label",{htmlFor:`initial-${a}`,className:"text-sm",children:a})]},`initial-${a}`))})]}),e.jsx(Me,{}),e.jsxs("div",{children:[e.jsx(re,{className:"font-medium text-xs",children:"Follow-up Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:ds.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:`followup-${a}`,checked:s.followUpCallFeedback.includes(a),onCheckedChange:m=>t("followUpCallFeedback",a,!!m)}),e.jsx("label",{htmlFor:`followup-${a}`,className:"text-sm",children:a})]},`followup-${a}`))})]})]})};function Ht({open:s,onOpenChange:l,onConfirm:i,logDetails:t}){const[n,a]=p.useState(""),m=n!=="Delete This",f=()=>{i(),a("")},x=o=>{o||a(""),l(o)};return t?e.jsx(Ss,{open:s,onOpenChange:x,children:e.jsxs(Ds,{children:[e.jsxs(Is,{children:[e.jsx(Fs,{children:"Are you absolutely sure?"}),e.jsxs(Ts,{children:["This action cannot be undone. This will permanently delete the call log for",e.jsxs("strong",{children:[" ",t.contactName]})," from",e.jsxs("strong",{children:[" ",_(new Date(t.log.timestamp),"PP")]}),"."]})]}),e.jsxs("div",{className:"space-y-2 my-4",children:[e.jsx(re,{htmlFor:"delete-confirm",children:'To confirm, type "Delete This" below:'}),e.jsx($e,{id:"delete-confirm",value:n,onChange:o=>a(o.target.value),autoComplete:"off"})]}),e.jsxs(Ms,{children:[e.jsx(As,{children:"Cancel"}),e.jsx(Ls,{onClick:f,disabled:m,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}):null}function _t({open:s,onOpenChange:l,onConfirm:i,itemCount:t,itemName:n}){const[a,m]=p.useState(""),f=a!=="Delete This",x=()=>{i(),m("")},o=u=>{u||m(""),l(u)};return t===0?null:e.jsx(Ss,{open:s,onOpenChange:o,children:e.jsxs(Ds,{children:[e.jsxs(Is,{children:[e.jsx(Fs,{children:"Are you absolutely sure?"}),e.jsxs(Ts,{children:["This action cannot be undone. This will permanently delete",e.jsxs("strong",{children:[" ",t," selected ",n]}),"."]})]}),e.jsxs("div",{className:"space-y-2 my-4",children:[e.jsx(re,{htmlFor:"delete-confirm",children:'To confirm, type "Delete This" below:'}),e.jsx($e,{id:"delete-confirm",value:a,onChange:u=>m(u.target.value),autoComplete:"off"})]}),e.jsxs(Ms,{children:[e.jsx(As,{children:"Cancel"}),e.jsx(Ls,{onClick:x,disabled:f,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}const qt=s=>{switch(s){case"Interested":return e.jsx(P,{className:"bg-green-100 text-green-800",children:"Interested"});case"Follow Up":return e.jsx(P,{className:"bg-blue-100 text-blue-800",children:"Follow-up"});case"Callback":return e.jsx(P,{className:"bg-yellow-100 text-yellow-800",children:"Callback"});case"Send Details":return e.jsx(P,{className:"bg-indigo-100 text-indigo-800",children:"Send Details"});case"Not Interested":return e.jsx(P,{variant:"destructive",children:"Not Interested"});case"Not Picked":return e.jsx(P,{variant:"outline",children:"Not Picked"});default:return e.jsx(P,{variant:"secondary",children:s})}},Bs=({call:s,isOverlay:l=!1,onSelectContact:i,isSelected:t,onDelete:n})=>e.jsxs("div",{className:fe("w-full text-left p-3 rounded-lg border bg-background shadow-sm relative group",l?"cursor-grabbing":"cursor-grab",!l&&"hover:bg-muted/50 transition-colors",t&&"ring-2 ring-primary border-primary"),children:[n&&e.jsx(D,{variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6 text-muted-foreground hover:text-destructive opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation(),n()},children:e.jsx(es,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{onClick:()=>i&&i(s.contact),children:[t&&e.jsx(Js,{className:"h-4 w-4 text-white bg-primary rounded-full absolute -top-1.5 -left-1.5"}),e.jsxs("p",{className:"font-medium text-sm flex items-center gap-2 pr-6",children:[e.jsx(Xs,{className:"h-3.5 w-3.5"})," ",s.contact.name]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1.5 flex items-center gap-2",children:[e.jsx(ce,{className:"h-3 w-3"})," ",s.contact.phone]})]})]}),Vt=({call:s,onSelectContact:l,onToggleSelect:i,isSelected:t,onDelete:n})=>{const{attributes:a,listeners:m,setNodeRef:f,transform:x,transition:o,isDragging:u}=Re({id:s.log.originalIndex}),h={transform:qs.Transform.toString(x),transition:o};return e.jsx("div",{ref:f,style:h,...a,...m,className:fe(u&&"opacity-50"),onClick:()=>i(s.log.originalIndex),children:e.jsx(Bs,{call:s,onSelectContact:l,isSelected:t,onDelete:n})})},xs=({data:s,onSelectContact:l,onUpdateCallLogFeedback:i,onDeleteCallLog:t,onDeleteMultipleCallLogs:n})=>{const[a,m]=p.useState({}),[f,x]=p.useState(null),[o,u]=p.useState(new Set),[h,j]=p.useState(null),[q,$]=p.useState(!1),{addOpportunitiesFromContacts:U}=ws();p.useEffect(()=>{if(s){const b=s.calls.reduce((S,C)=>{const{feedback:I}=C.log;return S[I]||(S[I]=[]),S[I].push(C),S},{});m(b),u(new Set)}},[s]);const A=Es(Us(zs,{activationConstraint:{distance:10}})),N=b=>Object.keys(a).find(S=>a[S].some(C=>C.log.originalIndex===b)),z=b=>{const{active:S}=b,C=S.id,I=N(C);if(I){const c=a[I].find(v=>v.log.originalIndex===C);x(c||null)}},pe=b=>{const{active:S,over:C}=b;if(x(null),!C)return;const I=S.id,c=C.id,v=N(I),F=te.includes(c)?c:N(c);if(!v||!F||v===F)return;const E=a[v].find(V=>V.log.originalIndex===I);if(!E)return;m(V=>{const M={...V};return M[v]=M[v].filter(ae=>ae.log.originalIndex!==I),M[F]||(M[F]=[]),M[F]=[...M[F],E],M});const me=F;i(E.contact.id,E.log.originalIndex,me)},J=b=>{u(S=>{const C=new Set(S);return C.has(b)?C.delete(b):C.add(b),C})},ee=()=>{if(o.size===0||!s)return;const b=s.calls.filter(C=>o.has(C.log.originalIndex)).map(C=>C.contact),S=Array.from(new Map(b.map(C=>[C.id,C])).values());U(S),u(new Set)},se=()=>{h&&(t(h.contact.id,h.log.originalIndex),j(null))},de=()=>{if(o.size===0||!s)return;const b=s.calls.filter(S=>o.has(S.log.originalIndex)).map(S=>({contactId:S.contact.id,logId:S.log.originalIndex}));n(b),u(new Set),$(!1)},X=p.useMemo(()=>s?new Set(s.calls.map(b=>b.log.originalIndex)):new Set,[s]),je=()=>{o.size===X.size?u(new Set):u(X)},te=["Interested","Follow Up","Callback","Not Interested","Not Picked","Send Details"];return e.jsxs(e.Fragment,{children:[e.jsxs(Os,{sensors:A,onDragStart:z,onDragEnd:pe,children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs(oe,{className:"h-full w-full",children:[e.jsx("div",{className:"flex space-x-4 pb-4",children:te.map(b=>{const S=a[b]||[],{setNodeRef:C}=Re({id:b});return e.jsxs("div",{ref:C,className:"w-72 flex-shrink-0 bg-muted/30 rounded-lg p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-shrink-0",children:[qt(b),e.jsxs("span",{className:"font-semibold text-sm text-muted-foreground",children:["(",S.length,")"]})]}),e.jsx(Hs,{items:S.map(I=>I.log.originalIndex),strategy:_s,children:e.jsx("div",{className:"space-y-2",children:S.map(I=>e.jsx(Vt,{call:I,onSelectContact:l,onToggleSelect:J,isSelected:o.has(I.log.originalIndex),onDelete:()=>j(I)},I.log.originalIndex))})})]},b)})}),e.jsx(Ws,{orientation:"horizontal"})]}),e.jsx(Ct,{children:f?e.jsx(Bs,{call:f,isOverlay:!0}):null})]}),s&&s.calls.length>0&&e.jsxs("div",{className:"flex-shrink-0 p-4 border-t bg-background flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:je,children:o.size===X.size?"Deselect All":"Select All"}),e.jsxs("span",{className:"text-sm font-medium",children:[o.size," log(s) selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{onClick:()=>$(!0),disabled:o.size===0,variant:"destructive",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),e.jsxs(D,{onClick:ee,disabled:o.size===0,children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Add to Opportunities"]})]})]})]}),e.jsx(Ht,{open:!!h,onOpenChange:b=>!b&&j(null),onConfirm:se,logDetails:h?{contactName:h.contact.name,log:h.log}:null}),e.jsx(_t,{open:q,onOpenChange:$,onConfirm:de,itemCount:o.size,itemName:"call logs"})]})},Bt=s=>{const{isOpen:l,onOpenChange:i,data:t}=s;return js()?e.jsx(ss,{open:l,onOpenChange:i,children:e.jsxs(ts,{className:"p-4 h-[85vh] flex flex-col",children:[e.jsxs(ft,{className:"flex-shrink-0 text-left",children:[e.jsxs(pt,{children:["Call Details for ",t?_(new Date(t.date),"MMMM d, yyyy"):""]}),e.jsx(jt,{children:"Drag and drop contacts to update their status. Tap to select."})]}),e.jsx(xs,{...s})]})}):e.jsx(Ye,{open:l,onOpenChange:i,children:e.jsxs(Ze,{className:"max-w-[95vw] w-full h-[85vh] flex flex-col",children:[e.jsxs(Ns,{className:"flex-shrink-0",children:[e.jsxs(bs,{children:["Call Details for ",t?_(new Date(t.date),"MMMM d, yyyy"):""]}),e.jsx(vs,{children:"Drag and drop contacts between columns to update their status. Click to select."})]}),e.jsx(xs,{...s})]})})},hs=["Interested","Not Interested","Follow Up","Callback","Not Picked","Send Details"],Qt=({open:s,onOpenChange:l,onExport:i})=>{var o,u;const[t,n]=p.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),a=h=>{n(j=>({...j,dateRange:h}))},m=(h,j,q)=>{n($=>{const U=$[h];return q?{...$,[h]:[...U,j]}:{...$,[h]:U.filter(A=>A!==j)}})},f=()=>{i(t),l(!1)},x=()=>{n({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]})};return e.jsx(Ye,{open:s,onOpenChange:l,children:e.jsxs(Ze,{className:"sm:max-w-lg",children:[e.jsxs(Ns,{children:[e.jsx(bs,{children:"Export Contacts to Excel"}),e.jsx(vs,{children:"Select filters to refine the contact list for your export."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-medium",children:"Date Range"}),e.jsxs(We,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:fe("w-full justify-start text-left font-normal mt-2",!t.dateRange&&"text-muted-foreground"),children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),(o=t.dateRange)!=null&&o.from?t.dateRange.to?e.jsxs(e.Fragment,{children:[_(t.dateRange.from,"LLL dd, y")," -"," ",_(t.dateRange.to,"LLL dd, y")]}):_(t.dateRange.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(Xe,{className:"w-auto p-0",align:"start",children:e.jsx(Rs,{initialFocus:!0,mode:"range",defaultMonth:(u=t.dateRange)==null?void 0:u.from,selected:t.dateRange,onSelect:a,numberOfMonths:2})})]})]}),e.jsx(Me,{}),e.jsxs("div",{children:[e.jsx(re,{className:"font-medium",children:"Initial Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:hs.map(h=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:`export-initial-${h}`,checked:t.initialCallFeedback.includes(h),onCheckedChange:j=>m("initialCallFeedback",h,!!j)}),e.jsx("label",{htmlFor:`export-initial-${h}`,className:"text-sm font-medium leading-none",children:h})]},`initial-${h}`))})]}),e.jsx(Me,{}),e.jsxs("div",{children:[e.jsx(re,{className:"font-medium",children:"Follow-up Call Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:hs.map(h=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:`export-followup-${h}`,checked:t.followUpCallFeedback.includes(h),onCheckedChange:j=>m("followUpCallFeedback",h,!!j)}),e.jsx("label",{htmlFor:`export-followup-${h}`,className:"text-sm font-medium leading-none",children:h})]},`followup-${h}`))})]})]}),e.jsxs(Ys,{children:[e.jsxs(D,{variant:"outline",onClick:x,children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),"Clear"]}),e.jsxs(D,{onClick:f,children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})})},Gt=({liveCallData:s,onUpdateCallLogMessage:l,onMarkAsSent:i})=>{if(!s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(ce,{className:"h-16 w-16 mx-auto mb-4 opacity-30"}),e.jsx("h3",{className:"text-xl font-semibold",children:"No Active Call"}),e.jsx("p",{className:"text-sm",children:"Live call details will appear here when a call is initiated from the Sales Dialer app."})]})});const{status:t,currentContact:n,nextContact:a,queuePosition:m}=s,f=x=>x.split(" ").map(o=>o[0]).join("").toUpperCase();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsxs(Q,{className:"w-full max-w-md shadow-2xl border-2 border-red-500 animate-pulse-glow-destructive",children:[e.jsx(G,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500 animate-ping"}),e.jsx(K,{className:"text-2xl font-bold",children:"Live Call in Progress"})]})}),e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 rounded-lg bg-muted/30",children:[e.jsx(P,{variant:t==="calling"?"destructive":"secondary",className:"animate-pulse",children:t==="calling"?"Calling Now":"Countdown..."}),e.jsx(Ae,{className:"h-24 w-24 border-4 border-muted",children:e.jsx(Le,{className:"text-3xl",children:f(n.name)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:n.name}),e.jsx("p",{className:"text-lg text-muted-foreground text-center",children:n.phone})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(K,{className:"text-base flex items-center gap-2",children:[e.jsx(Ft,{className:"h-4 w-4 text-muted-foreground"}),"Up Next"]})}),e.jsx(W,{children:a?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.phone})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last contact in the queue."})})]}),e.jsxs(Q,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(K,{className:"text-base flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),"Queue Position"]})}),e.jsx(W,{children:e.jsx("p",{className:"font-medium",children:m})})]})]})]})]})}),e.jsx("div",{className:"h-full overflow-hidden rounded-lg border bg-background shadow-sm",children:e.jsx(Fe,{contact:n,onUpdateCallLogMessage:l,onMarkAsSent:i})})]})},Ve=20,Kt=({id:s,contact:l,children:i,onRemove:t})=>{const{attributes:n,listeners:a,setNodeRef:m,transform:f,transition:x}=Re({id:s}),o={transform:qs.Transform.toString(f),transition:x};return e.jsxs("div",{ref:m,style:o,...n,...a,className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50 border cursor-grab",children:[i,e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>t(s),children:e.jsx(es,{className:"h-4 w-4"})})]})},us=({contact:s,isSelected:l,onToggle:i,onAdd:t})=>{const{attributes:n,listeners:a,setNodeRef:m}=Re({id:s.id}),f=x=>x.split(" ").map(o=>o[0]).join("").toUpperCase();return e.jsxs("div",{ref:m,...n,...a,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>t(s),children:[e.jsx(ue,{id:`contact-${s.id}`,checked:l,onCheckedChange:()=>i(s.id),onClick:x=>x.stopPropagation()}),e.jsxs("label",{htmlFor:`contact-${s.id}`,className:"flex items-center gap-3 cursor-pointer flex-1",children:[e.jsx(Ae,{className:"h-10 w-10 border",children:e.jsx(Le,{children:f(s.name)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone})]})]})]})},Wt=({contacts:s,onSaveImportedContacts:l})=>{const{user:i}=Cs(),{toast:t}=ys(),[n,a]=p.useState(""),[m,f]=p.useState(new Set),[x,o]=p.useState([]),[u,h]=p.useState(!1),[j,q]=p.useState([]),[$,U]=p.useState(!1),A=p.useRef(null),[N,z]=p.useState(Ve),pe=Es(Us(zs,{activationConstraint:{distance:10}})),J=p.useMemo(()=>{const c=new Set(x.map(y=>y.id)),v=new Set(j.map(y=>y.id));return s.filter(y=>!c.has(y.id)&&!v.has(y.id)&&(y.name.toLowerCase().includes(n.toLowerCase())||y.phone.includes(n)))},[s,x,j,n]),ee=p.useMemo(()=>J.slice(0,N),[J,N]);p.useEffect(()=>{z(Ve)},[n]);const se=c=>{f(v=>{const y=new Set(v);return y.has(c)?y.delete(c):y.add(c),y})},de=()=>{const v=[...s,...j].filter(F=>m.has(F.id)),y=[...x];v.forEach(F=>{y.some(E=>E.id===F.id)||y.push(F)}),o(y),f(new Set),t({title:`${v.length} contact(s) added to queue.`})},X=c=>{x.some(v=>v.id===c.id)||o(v=>[...v,c])},je=c=>{o(v=>v.filter(y=>y.id!==c))},te=async()=>{if(!(!i||x.length===0)){h(!0);try{const c={};c[`dialingQueue/${i.uid}`]=x,c["dialerBridge/activeWebUser"]=i.uid,await Se(le(ne),c),t({title:"Dialing Queue Sent!",description:"Open the Sales Dialer app and press 'Start Dialing' to begin."}),o([])}catch(c){console.error("Failed to send dialing queue:",c),t({title:"Failed to send queue",variant:"destructive"})}finally{h(!1)}}},b=c=>{const{active:v,over:y}=c;if(!y)return;const F=String(v.id),E=String(y.id),V=[...J,...j].find(M=>M.id===F);V&&(y.id==="call-queue-droppable"||x.some(M=>M.id===E))&&(x.some(M=>M.id===F)||o(M=>[...M,V]))},S=c=>{var F;const v=(F=c.target.files)==null?void 0:F[0];if(!v)return;const y=new FileReader;y.onload=E=>{var Ne;const me=(Ne=E.target)==null?void 0:Ne.result,V=ct(me,{type:"binary"}),M=V.SheetNames[0],ae=V.Sheets[M],ve=De.sheet_to_json(ae),Ee=new Set(s.map(r=>r.phone));let we=0,Ce=0;const ye=ve.map(r=>{const d=String(r.Phone||r.phone||r["Phone Number"]||"").trim(),g=String(r.Name||r.name||"Unknown").trim();return!d||!g?null:Ee.has(d)?(Ce++,null):(we++,{id:d,name:g,phone:d,callHistory:[],status:"New",lastContacted:new Date().toISOString(),callCount:0})}).filter(r=>r!==null);q(r=>[...r,...ye]),t({title:"Import Complete",description:`${we} new contacts imported. ${Ce} duplicates were ignored.`})},y.readAsBinaryString(v),A.current&&(A.current.value="")},C=async()=>{U(!0);try{await l(j),q([])}catch{}finally{U(!1)}},I=c=>c.split(" ").map(v=>v[0]).join("").toUpperCase();return e.jsx(Os,{sensors:pe,onDragStart:()=>{},onDragEnd:b,children:e.jsxs($s,{direction:"horizontal",className:"h-full rounded-lg border",children:[e.jsx(be,{defaultSize:30,minSize:20,children:e.jsxs(Q,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[e.jsxs(G,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"})," Imported Contacts"]}),e.jsx("input",{type:"file",ref:A,onChange:S,accept:".xlsx, .xls, .csv",className:"hidden"}),e.jsxs(D,{variant:"outline",onClick:()=>{var c;return(c=A.current)==null?void 0:c.click()},children:[e.jsx(rs,{className:"h-4 w-4 mr-2"})," Import from File"]})]}),e.jsx(W,{className:"flex-1 overflow-hidden p-0",children:e.jsx(oe,{className:"h-full",children:e.jsxs("div",{className:"p-4 space-y-2",children:[j.map(c=>e.jsx(us,{contact:c,isSelected:m.has(c.id),onToggle:se,onAdd:X},c.id)),j.length===0&&e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:e.jsx("p",{children:"Import contacts to get started."})})]})})}),j.length>0&&e.jsx("div",{className:"p-4 border-t",children:e.jsxs(D,{onClick:C,disabled:$,className:"w-full",children:[$?e.jsx(Be,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ps,{className:"h-4 w-4 mr-2"}),"Save ",j.length," Imported Contacts"]})})]})}),e.jsx(Qe,{withHandle:!0}),e.jsx(be,{defaultSize:40,minSize:30,children:e.jsxs(Q,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[e.jsxs(G,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"})," Available Contacts"]}),e.jsx($e,{placeholder:"Search contacts...",value:n,onChange:c=>a(c.target.value)})]}),e.jsx(W,{className:"flex-1 overflow-hidden p-0",children:e.jsx(oe,{className:"h-full",children:e.jsxs("div",{className:"p-4 space-y-2",children:[ee.map(c=>e.jsx(us,{contact:c,isSelected:m.has(c.id),onToggle:se,onAdd:X},c.id)),N<J.length&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx(D,{variant:"outline",onClick:()=>z(c=>c+Ve),children:"Load More"})})]})})})]})}),e.jsx(Qe,{withHandle:!0}),e.jsx(be,{defaultSize:30,minSize:20,children:e.jsxs(Q,{className:"flex flex-col h-full border-0 shadow-none rounded-none",children:[e.jsx(G,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"})," Call Queue"]})}),e.jsx(W,{className:"flex-1 overflow-hidden p-0",children:e.jsx(oe,{className:"h-full",children:e.jsxs("div",{className:"p-4 space-y-2",id:"call-queue-droppable",children:[e.jsx(Hs,{items:x.map(c=>c.id),strategy:_s,children:e.jsx(Te,{children:x.map((c,v)=>e.jsx(he.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsxs(Kt,{id:c.id,contact:c,onRemove:je,children:[e.jsxs("span",{className:"font-mono text-sm text-muted-foreground cursor-grab",children:[v+1,"."]}),e.jsx(Ae,{className:"h-10 w-10 border",children:e.jsx(Le,{children:I(c.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.phone})]})]})},c.id))})}),x.length===0&&e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:e.jsx("p",{children:"Drag contacts here to build your queue."})})]})})}),e.jsxs("div",{className:"p-4 border-t flex flex-col gap-4 flex-shrink-0",children:[e.jsxs(D,{onClick:de,disabled:m.size===0,variant:"outline",children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Add ",m.size>0?`(${m.size})`:""," to Queue"]}),e.jsxs(D,{onClick:te,disabled:x.length===0||u,children:[u?e.jsx(Be,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Send Queue to Dialer (",x.length,")"]})]})]})})]})})},Ge=30,Ke=at.forwardRef(({activeFilterCount:s,...l},i)=>e.jsxs(D,{ref:i,variant:"outline",className:"gap-2",...l,children:[e.jsx(vt,{className:"h-4 w-4"}),"Filters",s>0&&e.jsx(P,{variant:"secondary",className:"rounded-full px-2",children:s})]}));Ke.displayName="FilterTrigger";const gs=({searchTerm:s,setSearchTerm:l,isFilterOpen:i,setIsFilterOpen:t,filters:n,setFilters:a,loading:m,visibleContacts:f,handleSelectContact:x,selectedContact:o,visibleCount:u,filteredContacts:h,setVisibleCount:j,isMobile:q,activeFilterCount:$,selectedForOppIds:U,onToggleSelection:A})=>e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx($e,{placeholder:"Search by name or phone number...",value:s,onChange:N=>l(N.target.value),className:"pl-10"})]}),q?e.jsxs(ss,{open:i,onOpenChange:t,children:[e.jsx(wt,{asChild:!0,children:e.jsx(Ke,{activeFilterCount:$})}),e.jsx(ts,{children:e.jsx(ms,{filters:n,onFiltersChange:a,onApply:()=>t(!1)})})]}):e.jsxs(We,{open:i,onOpenChange:t,children:[e.jsx(Je,{asChild:!0,children:e.jsx(Ke,{activeFilterCount:$})}),e.jsx(Xe,{className:"w-80",align:"end",children:e.jsx(ms,{filters:n,onFiltersChange:a,onApply:()=>t(!1)})})]})]}),e.jsx(oe,{className:"flex-1 -mx-4",children:e.jsx("div",{className:"px-4 space-y-2",children:m?e.jsx("div",{className:"space-y-2",children:[...Array(10)].map((N,z)=>e.jsx(xt,{},z))}):f.length>0?e.jsxs(e.Fragment,{children:[f.map(N=>e.jsxs("div",{onClick:()=>x(N),className:fe("w-full text-left p-4 bg-background rounded-lg border hover:bg-muted/50 transition-colors flex items-center justify-between cursor-pointer",(o==null?void 0:o.id)===N.id&&"bg-muted/50 border-primary",U.has(N.id)&&"ring-2 ring-primary border-primary"),children:[e.jsx(ue,{checked:U.has(N.id),onCheckedChange:()=>A(N.id),onClick:z=>z.stopPropagation(),className:"mr-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:N.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{className:"h-3 w-3"})," ",N.phone]}),N.callHistory.length>0&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"h-3 w-3"})," ",new Date(N.callHistory[0].timestamp).toLocaleDateString()]})]})]}),e.jsx(nt,{className:"h-5 w-5 text-muted-foreground"})]},N.id)),u<h.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(D,{variant:"outline",onClick:()=>j(N=>N+Ge),children:"Load More"})})]}):e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"font-medium",children:"No contacts found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters."})]})})})]});function fa(){var Ne;const{user:s}=Cs(),{toast:l}=ys(),{contacts:i,loading:t}=Zs(),{addOpportunitiesFromContacts:n}=ws();p.useState(null);const[a,m]=p.useState("contacts"),[f,x]=p.useState(null),[o,u]=p.useState(""),h=et(o,300),[j,q]=p.useState({dateRange:void 0,initialCallFeedback:[],followUpCallFeedback:[]}),[$,U]=p.useState(!1),A=js(),[N,z]=p.useState(null),[pe,J]=p.useState(!1),[ee,se]=p.useState(Ge),[de,X]=p.useState(null),[je,te]=p.useState(!1),[b,S]=p.useState(new Set);p.useEffect(()=>{if(!s)return;const r=le(ne,"liveCallStatus"),d=st(r,g=>{const w=g.val();if(w&&w.currentContact){const k=O=>{const B=O.callHistory?Object.entries(O.callHistory).map(([H,xe])=>({...xe,originalIndex:H})).sort((H,xe)=>new Date(xe.timestamp).getTime()-new Date(H.timestamp).getTime()).map((H,xe,Ue)=>({...H,type:xe===Ue.length-1?"New Call":"Follow-up"})):[],L=B[0]||null;return{id:O.phoneNumber,name:O.name||"N/A",phone:O.phoneNumber,callHistory:B,status:(L==null?void 0:L.feedback)||"No History",lastContacted:(L==null?void 0:L.timestamp)||new Date().toISOString(),callCount:O.callCount||0}},T=k(w.currentContact),R=w.nextContact?k(w.nextContact):void 0;X({...w,currentContact:T,nextContact:R}),a!=="live-call"&&m("live-call")}else X(null),a==="live-call"&&m("contacts")});return()=>{d()}},[s,a]);const C=p.useMemo(()=>i.filter(r=>{if(h&&!(r.name.toLowerCase().includes(h.toLowerCase())||r.phone.includes(h)))return!1;const{dateRange:d,initialCallFeedback:g,followUpCallFeedback:w}=j;if(d!=null&&d.from||d!=null&&d.to){const k=d.from?Ie(d.from):null,T=d.to?is(d.to):null;if(!r.callHistory.some(O=>{const B=new Date(O.timestamp);return(!k||B>=k)&&(!T||B<=T)}))return!1}if(g.length>0){const k=r.callHistory.find(T=>T.type==="New Call");if(!k||!g.includes(k.feedback))return!1}return!(w.length>0&&!r.callHistory.some(T=>T.type==="Follow-up"&&w.includes(T.feedback)))}),[i,h,j]);p.useEffect(()=>{se(Ge)},[h,j]);const I=p.useMemo(()=>C.slice(0,ee),[C,ee]),c=r=>{const d=i.filter(T=>{const{dateRange:R,initialCallFeedback:O,followUpCallFeedback:B}=r;if(R!=null&&R.from||R!=null&&R.to){const L=R.from?Ie(R.from):null,H=R.to?is(R.to):null;if(!T.callHistory.some(Ue=>{const as=new Date(Ue.timestamp);return(!L||as>=L)&&(!H||as<=H)}))return!1}if(O.length>0){const L=T.callHistory.find(H=>H.type==="New Call");if(!L||!O.includes(L.feedback))return!1}return!(B.length>0&&!T.callHistory.some(H=>H.type==="Follow-up"&&B.includes(H.feedback)))});if(d.length===0){l({title:"No Contacts Found",description:"No contacts match the selected filters.",variant:"destructive"});return}const g=d.map(T=>({Name:T.name,"Phone Number":T.phone})),w=De.json_to_sheet(g),k=De.book_new();De.book_append_sheet(k,w,"Contacts"),w["!cols"]=[{wch:30},{wch:20}],dt(k,"Filtered_Contacts.xlsx"),l({title:"Export Successful",description:`Exported ${d.length} contacts.`})},v=r=>{const d=i.find(g=>g.id===r.id);x(d||r),a==="live-call"&&te(!0)},y=(r,d)=>{const g=i.flatMap(w=>w.callHistory.filter(k=>{const T=_(Ie(new Date(k.timestamp)),"yyyy-MM-dd"),R=d==="all"||k.type===d;return T===r&&R}).map(k=>({contact:w,log:k})));z({date:r,calls:g})},F=r=>{x(r),te(!0)},E=async(r,d,g)=>{if(!s){l({title:"Authentication Error",variant:"destructive"});return}const w=le(ne,`contacts/${r}/callHistory/${d}/message`);try{await He(w,g),l({title:"Note updated successfully!"})}catch(k){console.error("Error updating call log message:",k),l({title:"Failed to update note",variant:"destructive"})}},me=async(r,d,g)=>{if(!s){l({title:"Authentication Error",variant:"destructive"});return}const w=le(ne,`contacts/${r}/callHistory/${d}/feedback`);try{await He(w,g),l({title:"Contact status updated!"})}catch(k){console.error("Error updating call log feedback:",k),l({title:"Failed to update status",variant:"destructive"})}},V=async(r,d)=>{if(!s){l({title:"Authentication Error",variant:"destructive"});return}const g=le(ne,`contacts/${r}/callHistory/${d}`);try{if(await He(g,null),l({title:"Call log deleted."}),N){const w=N.calls.filter(k=>k.log.originalIndex!==d);z({...N,calls:w})}}catch(w){console.error("Error deleting call log:",w),l({title:"Failed to delete log",variant:"destructive"})}},M=async r=>{if(!s||r.length===0)return;const d={};r.forEach(({contactId:g,logId:w})=>{d[`contacts/${g}/callHistory/${w}`]=null});try{if(await Se(le(ne),d),l({title:`${r.length} call log(s) deleted.`}),N){const g=new Set(r.map(k=>k.logId)),w=N.calls.filter(k=>!g.has(k.log.originalIndex));z({...N,calls:w})}}catch(g){console.error("Error deleting multiple call logs:",g),l({title:"Failed to delete logs",variant:"destructive"})}},ae=async r=>{var B;if(!s){l({title:"Authentication Error",variant:"destructive"});return}const d=i.find(L=>L.id===r),g=(B=d==null?void 0:d.callHistory)==null?void 0:B[0];if(!d||!g||g.feedback!=="Send Details"){l({title:"Invalid Action",description:"This action is only for contacts awaiting details.",variant:"destructive"});return}const w=g.originalIndex;if(!w){l({title:"Data Error",description:"Cannot find the original call log to update.",variant:"destructive"});return}const k=le(ne,`contacts/${r}/callHistory/${w}`),T=g.message||"",O={feedback:"Interested",message:`[Details Sent on ${new Date().toLocaleDateString()}] ${T}`.trim()};try{await Se(k,O),l({title:"Status Updated!",description:`${d.name} is now marked as Interested.`})}catch(L){console.error("Error marking as sent:",L),l({title:"Update Failed",variant:"destructive"})}},ve=r=>{S(d=>{const g=new Set(d);return g.has(r)?g.delete(r):g.add(r),g})},Ee=()=>{const r=i.filter(d=>b.has(d.id));n(r),S(new Set)},we=async r=>{if(!s||r.length===0)return;const d={};r.forEach(g=>{const w=`contacts/${g.phone}`;d[w]={name:g.name,phoneNumber:g.phone,callCount:0,callHistory:{}}});try{await Se(le(ne),d),l({title:"Contacts Saved!",description:`${r.length} new contacts have been saved to your main list.`})}catch(g){throw console.error("Error saving imported contacts:",g),l({title:"Save Failed",description:"Could not save the imported contacts to Firebase.",variant:"destructive"}),g}},Ce={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},ye=((Ne=j.dateRange)!=null&&Ne.from?1:0)+j.initialCallFeedback.length+j.followUpCallFeedback.length;return t&&i.length===0?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[e.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),"Sales Tracker"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-9 w-32"}),e.jsx(ns,{className:"h-9 w-48"})]})]}),e.jsx(mt,{})]}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-background",children:[e.jsxs("header",{className:"flex-shrink-0 bg-background border-b p-2 md:p-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-lg md:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),e.jsx("span",{className:"hidden sm:inline",children:"Sales Tracker"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"outline",size:A?"icon":"default",onClick:()=>J(!0),children:[e.jsx(kt,{className:fe("h-4 w-4",!A&&"mr-2")}),e.jsx("span",{className:"hidden md:inline",children:"Export"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded-lg",children:[e.jsxs(D,{size:"sm",variant:a==="live-call"?"default":"ghost",onClick:()=>m("live-call"),className:"gap-2 px-2 md:px-3 relative",children:[de&&e.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 animate-ping"}),e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Live Call"})]}),e.jsxs(D,{size:"sm",variant:a==="dialer"?"default":"ghost",onClick:()=>m("dialer"),className:"gap-2 px-2 md:px-3",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Dialer"})]}),e.jsxs(D,{size:"sm",variant:a==="contacts"?"default":"ghost",onClick:()=>m("contacts"),className:"gap-2 px-2 md:px-3",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Contacts"})]}),e.jsxs(D,{size:"sm",variant:a==="analytics"?"default":"ghost",onClick:()=>m("analytics"),className:"gap-2 px-2 md:px-3",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Analytics"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[e.jsx(Te,{mode:"wait",children:e.jsx(he.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:Ce,className:"p-4 md:p-6 h-full",children:a==="live-call"?e.jsx(Gt,{liveCallData:de,onUpdateCallLogMessage:E,onMarkAsSent:ae}):a==="dialer"?e.jsx(Wt,{contacts:i,onSaveImportedContacts:we}):a==="contacts"?A?e.jsx(gs,{searchTerm:o,setSearchTerm:u,isFilterOpen:$,setIsFilterOpen:U,filters:j,setFilters:q,loading:t,visibleContacts:I,handleSelectContact:v,selectedContact:f,visibleCount:ee,filteredContacts:C,setVisibleCount:se,isMobile:A,activeFilterCount:ye,selectedForOppIds:b,onToggleSelection:ve}):e.jsxs($s,{direction:"horizontal",className:"h-full rounded-lg border",children:[e.jsx(be,{defaultSize:40,minSize:30,children:e.jsx("div",{className:"p-4 h-full",children:e.jsx(gs,{searchTerm:o,setSearchTerm:u,isFilterOpen:$,setIsFilterOpen:U,filters:j,setFilters:q,loading:t,visibleContacts:I,handleSelectContact:v,selectedContact:f,visibleCount:ee,filteredContacts:C,setVisibleCount:se,isMobile:A,activeFilterCount:ye,selectedForOppIds:b,onToggleSelection:ve})})}),e.jsx(Qe,{withHandle:!0}),e.jsx(be,{defaultSize:60,minSize:40,children:f?e.jsx(Fe,{contact:f,onUpdateCallLogMessage:E,onMarkAsSent:ae}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"Select a contact to view details"})]})})})]}):e.jsx(oe,{className:"h-full -m-4 md:-m-6",children:e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(zt,{contacts:i,onDateClick:y})})})},a)}),e.jsx(Te,{children:b.size>0&&a==="contacts"&&e.jsx(he.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10",children:e.jsxs("div",{className:"flex items-center gap-4 bg-background p-3 rounded-lg shadow-lg border",children:[e.jsxs("span",{className:"text-sm font-medium",children:[b.size," contact(s) selected"]}),e.jsxs(D,{onClick:Ee,children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Add to Opportunities"]})]})})})]}),A&&e.jsx(ss,{open:!!f,onOpenChange:r=>!r&&x(null),children:e.jsxs(Nt,{children:[e.jsx(bt,{className:"fixed inset-0 bg-black/40"}),e.jsx(ts,{className:"bg-background flex flex-col outline-none h-[90%] mt-24 fixed bottom-0 left-0 right-0 rounded-t-lg",children:e.jsx(Fe,{contact:f,onUpdateCallLogMessage:E,onMarkAsSent:ae})})]})}),e.jsx(Bt,{isOpen:!!N,onOpenChange:r=>!r&&z(null),data:N,onSelectContact:F,onUpdateCallLogFeedback:me,onDeleteCallLog:V,onDeleteMultipleCallLogs:M}),e.jsx(Qt,{open:pe,onOpenChange:J,onExport:c}),e.jsx(Ye,{open:je,onOpenChange:te,children:e.jsx(Ze,{className:"max-w-4xl h-[85vh] flex flex-col",children:e.jsx(Fe,{contact:f,onUpdateCallLogMessage:E,onMarkAsSent:ae})})})]})}export{fa as default};
