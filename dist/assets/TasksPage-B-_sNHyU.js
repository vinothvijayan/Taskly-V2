import{c as ue,av as M,aw as Y,V as J,ax as xe,r as v,s as X,a2 as he,j as e,p as E,C as R,A as Z,ay as ee,l as se,e as fe,v as H,h as ge,an as pe,ao as je,B as k,ap as ve,aq as F,az as be,k as ye,n as Ne,aA as Te,aB as we,y as De,a8 as Se,aC as Ce,aD as U,K as ke,I as Me,S as $,D as Ee,z as Pe,E as Ae,F as ze,G as Le}from"./index-C20fHVmm.js";import{R as Ie,a as q,b as Oe}from"./resizable-VLfMrKzG.js";import{c as Fe,T as V,a as Re}from"./scoring-Pjt2sHeW.js";import{A as Be}from"./award-agzPjywG.js";import{c as Ke,C as _e,f as He,S as Ue,v as $e,u as qe,a as Ve,P as Ge,D as Qe,b as We}from"./sortable.esm-Cydrjq7h.js";import{c as B,E as Ye}from"./DeleteConfirmationDialog-DqhjKW4I.js";import{S as Je}from"./alert-dialog-CR5ji12a.js";import{T as Xe}from"./skeletons-Bb8mVUWj.js";import{a as te,s as ae,C as Ze}from"./subDays-BYudXbBI.js";import{f as z}from"./format-CcypP5ZI.js";import"./textarea-DJZO54Po.js";import"./send-5UL8mSPm.js";import"./select-DzEN2igF.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],ss=ue("layout-grid",es);function G(s){return M(s,B(s))}function ts(s){return M(s,te(B(s),1))}function as(s){return M(s,ae(B(s),1))}const rs=s=>{if(s<60)return"~1m";const l=Math.floor(s/60),i=Math.floor(l/60);return i>0?`${i}h ${l%60}m`:`${l}m`};function ns(){const{tasks:s,teamMembers:l}=Y(),{user:i}=J(),{showConfetti:b}=xe(),c=v.useMemo(()=>{if(l.length<=1)return null;const g=new Date,u=X(g),j=he(g),y=l.map(a=>{const p=s.filter(n=>n.createdBy===a.uid),x=Fe(p,u,j),r=p.filter(n=>{if(n.status!=="completed"||!n.completedAt)return!1;const d=new Date(n.completedAt);return d>=u&&d<=j}).reduce((n,d)=>n+(d.timeSpent||0),0);return{userId:a.uid,name:a.displayName||a.email,avatarUrl:a.photoURL,score:x,totalTimeSpent:r}}).sort((a,p)=>p.score-a.score);return y[0].score>0?y[0]:null},[s,l]);return v.useEffect(()=>{if(c&&i&&c.userId===i.uid){const g=new Date().toISOString().split("T")[0],u=`confetti_shown_${i.uid}_${g}`;sessionStorage.getItem(u)||(b(),sessionStorage.setItem(u,"true"))}},[c,i,b]),c?e.jsxs("div",{className:"flex items-center gap-3 p-2 pr-3 bg-gradient-to-r from-amber-50/50 via-background to-background border border-amber-200/60 dark:from-amber-950/30 dark:border-amber-800/50 rounded-full text-sm shadow-sm transition-all hover:shadow-md hover:border-amber-300/80",children:[e.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-full bg-amber-100 dark:bg-amber-900/50",children:e.jsx(Be,{className:"h-5 w-5 text-amber-500 dark:text-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-amber-700 dark:text-amber-300 -mb-1",children:"Top Performer"}),e.jsx("span",{className:"font-bold text-foreground truncate",children:c.name})]}),c.totalTimeSpent>0&&e.jsxs(E,{variant:"secondary",className:"text-xs font-mono flex items-center gap-1 bg-amber-100/50 dark:bg-amber-900/30 border-amber-200/50 dark:border-amber-800/50 text-amber-800 dark:text-amber-200",children:[e.jsx(R,{className:"h-3 w-3"}),rs(c.totalTimeSpent)]}),e.jsxs(Z,{className:"h-8 w-8 border-2 border-background",children:[e.jsx(ee,{src:c.avatarUrl}),e.jsx(se,{className:"text-xs bg-muted",children:c.name.split(" ").map(g=>g[0]).join("").toUpperCase()})]})]}):null}function re({task:s,assignedProfiles:l,onEdit:i,onDelete:b,onStartTimer:c}){const{attributes:g,listeners:u,setNodeRef:j,transform:N,transition:y,isDragging:a}=Ke({id:s.id,data:{type:"Task",task:s}}),p={transition:y,transform:_e.Transform.toString(N)},x=s.status==="completed",o=r=>r?r.split(" ").map(n=>n[0]).join("").toUpperCase():"";return e.jsx("div",{ref:j,style:p,...g,...u,children:e.jsx(fe,{className:H("mb-4 shadow-sm hover:shadow-md transition-shadow cursor-grab active:cursor-grabbing",a&&"opacity-50 ring-2 ring-primary",x&&"bg-muted/50 opacity-70"),children:e.jsxs(ge,{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:H("font-semibold text-sm leading-snug pr-2",x&&"line-through text-muted-foreground"),children:s.title}),e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:r=>r.stopPropagation(),children:e.jsx(Ye,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(F,{onClick:()=>i(s),children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(F,{onClick:()=>c(s.id),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Start Timer"]}),e.jsxs(F,{onClick:()=>b(s.id),className:"text-destructive",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[s.priority==="high"&&e.jsx(E,{variant:"destructive",children:"High"}),s.priority==="medium"&&e.jsx(E,{variant:"secondary",children:"Medium"}),s.dueDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3 w-3"})," ",new Date(s.dueDate).toLocaleDateString()]}),s.estimatedTime&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"})," ",s.estimatedTime,"m"]})]}),l.length>0&&e.jsx("div",{className:"flex items-center justify-end pt-2",children:e.jsx("div",{className:"flex -space-x-2 overflow-hidden",children:l.map(r=>e.jsxs(Z,{className:"h-6 w-6 border-2 border-background",children:[e.jsx(ee,{src:r.photoURL}),e.jsx(se,{className:"text-[10px]",children:o(r.displayName)})]},r.uid))})})]})})})}const Q=15;function is({id:s,title:l,tasks:i,assignedProfilesMap:b,onEdit:c,onDelete:g,onStartTimer:u}){const{setNodeRef:j}=He({id:s}),[N,y]=v.useState(Q),a=()=>{y(x=>x+Q)},p=i.slice(0,N);return e.jsxs("div",{ref:j,className:"w-72 flex-shrink-0 bg-muted/50 rounded-xl flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border/50",children:e.jsxs("h3",{className:"font-semibold text-sm flex items-center justify-between",children:[e.jsx("span",{children:l}),e.jsx(E,{variant:"secondary",children:i.length})]})}),e.jsx("div",{className:"p-2 flex-1 overflow-y-auto",children:e.jsx(Ue,{items:i.map(x=>x.id),strategy:$e,children:i.length>0?e.jsxs(e.Fragment,{children:[p.map(x=>e.jsx(re,{task:x,assignedProfiles:b.get(x.id)||[],onEdit:c,onDelete:g,onStartTimer:u},x.id)),i.length>N&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(k,{variant:"ghost",size:"sm",onClick:a,children:["Load More (",i.length-N," more)"]})})]}):e.jsx("div",{className:"text-center text-sm text-muted-foreground py-16 px-4 border-2 border-dashed rounded-lg m-2",children:"No tasks here."})})})]})}const W=[{id:"todo",title:"To Do"},{id:"in-progress",title:"In Progress"},{id:"completed",title:"Completed"}];function os({tasks:s,teamMembers:l,onEdit:i,onDelete:b,onStartTimer:c,onTaskStatusChange:g}){const[u,j]=v.useState(null),N=v.useMemo(()=>{const o={todo:[],"in-progress":[],completed:[]};return s.forEach(r=>{o[r.status]&&o[r.status].push(r)}),o},[s]),y=v.useMemo(()=>{const o=new Map;return s.forEach(r=>{if(r.assignedTo&&r.assignedTo.length>0){const n=r.assignedTo.map(d=>l.find(T=>T.uid===d)).filter(d=>!!d);o.set(r.id,n)}}),o},[s,l]),a=qe(Ve(Ge,{activationConstraint:{distance:10}})),p=o=>{var r;((r=o.active.data.current)==null?void 0:r.type)==="Task"&&j(o.active.data.current.task)},x=o=>{var C;j(null);const{active:r,over:n}=o;if(!n)return;const d=r.id,T=n.id,P=s.find(w=>w.id===d);if(!P)return;const h=P.status,S=W.find(w=>w.id===T)?T:(C=s.find(w=>w.id===T))==null?void 0:C.status;!S||h===S||g(d,S)};return e.jsxs(Qe,{sensors:a,onDragStart:p,onDragEnd:x,children:[e.jsx("div",{className:"flex-1 flex gap-6 overflow-x-auto pb-4",children:W.map(o=>e.jsx(is,{id:o.id,title:o.title,tasks:N[o.id],assignedProfilesMap:y,onEdit:i,onDelete:b,onStartTimer:c},o.id))}),e.jsx(We,{children:u?e.jsx(re,{task:u,assignedProfiles:y.get(u.id)||[],onEdit:()=>{},onDelete:()=>{},onStartTimer:()=>{}}):null})]})}function Ns(){const{tasks:s,teamMembers:l,addTask:i,updateTask:b,deleteTask:c,toggleTaskStatus:g,toggleTaskPriority:u,setTaskFormActive:j,loading:N}=Y(),{startTaskTimer:y}=Te(),{user:a}=J(),{createTaskOffline:p,updateTaskOffline:x,deleteTaskOffline:o,toggleTaskStatusOffline:r}=we();De();const[n,d]=v.useState(null),[T,P]=v.useState(""),[h,S]=v.useState(new Date),[C,w]=v.useState("list");v.useEffect(()=>(j(!!n),()=>j(!1)),[n,j]);const ne=()=>S(t=>ae(t,1)),ie=()=>S(t=>te(t,1)),oe=()=>G(h)?"My Day":as(h)?"Yesterday":ts(h)?"Tomorrow":z(h,"EEEE"),{todoTasks:L,completedTasks:A}=v.useMemo(()=>{const t=s.filter(m=>m.completedAt&&M(new Date(m.completedAt),h)?!0:G(h)?m.status==="completed"?!1:!!(m.dueDate&&M(new Date(m.dueDate),h)||m.dueDate&&new Date(m.dueDate)<X(new Date)||!m.dueDate):m.dueDate&&M(new Date(m.dueDate),h)&&m.status!=="completed"),f=t.filter(m=>m.status!=="completed"),D=t.filter(m=>m.status==="completed");return{todoTasks:f,completedTasks:D}},[s,h]),le=async t=>{!n||!(a!=null&&a.uid)||(navigator.onLine?b(n.id,t):await x(n.id,t,a.uid),d(null))},de=async()=>{if(!T.trim()||!(a!=null&&a.uid))return;const t={title:T.trim(),priority:"medium",status:"todo",createdBy:a.uid,dueDate:z(h,"yyyy-MM-dd")};navigator.onLine?i(t):await p(t,a.uid),P("")},I=t=>{const f=s.find(D=>D.id===t);f&&y(f)},O=async t=>{a!=null&&a.uid&&(navigator.onLine?c(t):await o(t,a.uid))},K=async t=>{a!=null&&a.uid&&(navigator.onLine?g(t):await r(t,a.uid))},ce=(t,f)=>{const D=s.find(m=>m.id===t);D&&D.status!==f&&b(t,{status:f,completedAt:f==="completed"?new Date().toISOString():void 0})},me=t=>{t.key==="Enter"&&de()},_=t=>!t||t.length===0?[]:t.map(f=>l.find(D=>D.uid===f)).filter(f=>f!==void 0);return v.useCallback(async t=>{if(!(a!=null&&a.uid))return;const f={...t,status:"todo",createdBy:a.uid,dueDate:z(h,"yyyy-MM-dd")};navigator.onLine?i({...f,createdAt:new Date().toISOString()}):await p(f,a.uid)},[a==null?void 0:a.uid,i,p,h]),N?e.jsx(Xe,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-48"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:ne,className:"rounded-full h-10 w-10",children:e.jsx(Ze,{className:"h-6 w-6",strokeWidth:2.5})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:oe()}),e.jsx("p",{className:"text-muted-foreground",children:z(h,"EEEE, MMMM d")})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:ie,className:"rounded-full h-10 w-10",children:e.jsx(Se,{className:"h-6 w-6",strokeWidth:2.5})})]}),e.jsxs("div",{className:"flex justify-end w-48 items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded-lg",children:[e.jsx(k,{size:"sm",variant:C==="list"?"default":"ghost",onClick:()=>w("list"),className:"h-7 px-2",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:C==="board"?"default":"ghost",onClick:()=>w("board"),className:"h-7 px-2",children:e.jsx(ss,{className:"h-4 w-4"})})]}),e.jsx(ns,{})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:C==="list"?e.jsxs(Ie,{direction:"horizontal",className:"h-full rounded-lg border shadow-sm",children:[e.jsx(q,{defaultSize:60,minSize:40,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Active Tasks"}),e.jsx(E,{variant:"secondary",children:L.length})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-xs bg-muted/50 rounded-lg px-3",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Me,{value:T,onChange:t=>P(t.target.value),onKeyPress:me,placeholder:"Add a new task...",className:"border-0 shadow-none focus-visible:ring-0 bg-transparent h-8"})]})]})}),e.jsx($,{className:"flex-1",children:e.jsx("div",{className:"p-4 space-y-2",children:L.length>0||A.length>0?L.map(t=>e.jsx(V,{task:t,onEdit:d,onDelete:O,onToggleStatus:K,onTogglePriority:u,onStartTimer:I,assignedProfiles:_(t.assignedTo)},t.id)):e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:e.jsx("p",{children:"No tasks for this day."})})})})]})}),e.jsx(Oe,{withHandle:!0}),e.jsx(q,{defaultSize:40,minSize:30,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-success"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Completed"})]}),e.jsx(E,{variant:"secondary",children:A.length})]}),e.jsx($,{className:"flex-1",children:e.jsx("div",{className:"p-4 space-y-2",children:A.length>0?A.map(t=>e.jsx(V,{task:t,onEdit:d,onDelete:O,onToggleStatus:K,onTogglePriority:u,onStartTimer:I,assignedProfiles:_(t.assignedTo)},t.id)):e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:e.jsx("p",{children:"No completed tasks for this day."})})})})]})})]}):e.jsx(os,{tasks:s,teamMembers:l,onEdit:d,onDelete:O,onStartTimer:I,onTaskStatusChange:ce})})]}),e.jsx(Ee,{open:!!n,onOpenChange:()=>d(null),children:e.jsxs(Pe,{className:"sm:max-w-[500px] shadow-elegant max-h-[90vh] flex flex-col p-0",children:[e.jsxs(Ae,{className:"p-6 pb-4 border-b",children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"Edit Task"]}),e.jsx(Le,{children:"Make changes to your task here. Click save when you're done."})]}),n&&e.jsx(Re,{task:n,onSubmit:le,onCancel:()=>d(null),teamMembers:l})]})})]})}export{Ns as default};
