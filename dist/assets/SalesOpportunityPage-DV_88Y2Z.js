import{c as fe,a9 as je,j as e,aa as pe,ab as E,ac as A,ad as V,ae as W,I as M,af as q,t as Ne,u as ve,B as p,v as te,n as ae,w as we,ag as Ce,ah as be,ai as Se,aj as De,ak as ye,al as Q,H as ne,$ as Oe,W as Le,r as d,m as le,e as U,h as _,D as ke,am as Me,K as Ie,z as Te,E as Pe,F as Fe,p as ie,a6 as Ee,V as Ae,an as Ve,ao as We,ap as qe,aq as X,k as ze,O as Be,P as He,q as Re,o as $e,M as Ue,A as Y,l as Z}from"./index-C20fHVmm.js";import{u as _e,a as Ke,D as Ge,d as Je,b as Qe,e as Xe,P as Ye,c as re,S as Ze,v as es,C as ss}from"./sortable.esm-Cydrjq7h.js";import{C as ts}from"./calendar-BvZK3pUK.js";import{f as ce}from"./format-CcypP5ZI.js";import{a as as}from"./skeletons-Bb8mVUWj.js";import{D as ns,E as ls,C as is,f as rs}from"./DeleteConfirmationDialog-DqhjKW4I.js";import{T as cs}from"./textarea-DJZO54Po.js";import{A as os}from"./award-agzPjywG.js";import{S as ds}from"./alert-dialog-CR5ji12a.js";import{S as ms}from"./send-5UL8mSPm.js";import"./subDays-BYudXbBI.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],oe=fe("indian-rupee",xs),hs=be({title:Q().min(3,"Title must be at least 3 characters."),contact:Q().min(2,"Contact name is required."),value:ye.number().min(0,"Value must be a positive number."),closeDate:De({required_error:"A close date is required."}),stage:Se(["Interested Lead","Meeting","Follow-ups","Closed Won","Closed Lost"]).default("Interested Lead")});function us({opportunity:s,onSubmit:x,onCancel:v}){const r=je({resolver:Ce(hs),defaultValues:{title:(s==null?void 0:s.title)||"",contact:(s==null?void 0:s.contact)||"",value:(s==null?void 0:s.value)||0,closeDate:s!=null&&s.closeDate?new Date(s.closeDate):new Date,stage:(s==null?void 0:s.stage)||"Interested Lead"}}),h=n=>{x({...n,closeDate:n.closeDate.toISOString()})};return e.jsx(pe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(h),className:"space-y-4",children:[e.jsx(E,{control:r.control,name:"title",render:({field:n})=>e.jsxs(A,{children:[e.jsx(V,{children:"Opportunity Title"}),e.jsx(W,{children:e.jsx(M,{placeholder:"e.g., New website for Acme Inc.",...n})}),e.jsx(q,{})]})}),e.jsx(E,{control:r.control,name:"contact",render:({field:n})=>e.jsxs(A,{children:[e.jsx(V,{children:"Contact Name"}),e.jsx(W,{children:e.jsx(M,{placeholder:"Enter contact name...",...n})}),e.jsx(q,{})]})}),e.jsx(E,{control:r.control,name:"value",render:({field:n})=>e.jsxs(A,{children:[e.jsx(V,{children:"Value (â‚¹)"}),e.jsx(W,{children:e.jsx(M,{type:"number",placeholder:"25000",...n})}),e.jsx(q,{})]})}),e.jsx(E,{control:r.control,name:"closeDate",render:({field:n})=>e.jsxs(A,{className:"flex flex-col",children:[e.jsx(V,{children:"Expected Close Date"}),e.jsxs(Ne,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(W,{children:e.jsxs(p,{variant:"outline",className:te("w-full pl-3 text-left font-normal",!n.value&&"text-muted-foreground"),children:[n.value?ce(n.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(ae,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(we,{className:"w-auto p-0",align:"start",children:e.jsx(ts,{mode:"single",selected:n.value,onSelect:n.onChange,disabled:u=>u<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(q,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:v,children:"Cancel"}),e.jsx(p,{type:"submit",children:"Save Opportunity"})]})]})})}const ee=["Interested Lead","Meeting","Follow-ups","Closed Won","Closed Lost"],de=({opportunity:s,onEdit:x,onDelete:v,isExpanded:r,onExpand:h})=>{const{attributes:n,listeners:u,setNodeRef:w,transform:N,transition:C,isDragging:D}=re({id:s.id}),{addNoteToOpportunity:g,updateOpportunity:f}=ne(),{userProfile:l}=Ae(),[m,y]=d.useState(""),[b,L]=d.useState(""),k={transform:ss.Transform.toString(N),transition:D?"none":C},z=a=>{a.stopPropagation(),m.trim()&&(g(s.id,m),y(""))},I=a=>{a.stopPropagation(),b&&f(s.id,{meetingDate:new Date(b).toISOString(),meetingStatus:"scheduled"})},B=a=>{a.stopPropagation(),f(s.id,{meetingStatus:"done"})},H=a=>a?a.split(" ")[0]:"",T=a=>a?a.split(" ").map(P=>P[0]).join("").toUpperCase().slice(0,2):"";return e.jsx("div",{ref:w,style:k,...n,...u,children:e.jsxs(U,{className:te("mb-4 shadow-sm hover:shadow-md transition-all duration-300 cursor-grab active:cursor-grabbing group",D&&"opacity-50",r&&"ring-2 ring-primary"),onClick:a=>{a.target.closest('button, a, [role="menuitem"], textarea, input')||h()},children:[e.jsxs(_,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-sm mb-2 pr-2 flex-1",children:s.title}),e.jsxs(Ve,{children:[e.jsx(We,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>a.stopPropagation(),children:e.jsx(ls,{className:"h-4 w-4"})})}),e.jsxs(qe,{align:"end",onClick:a=>a.stopPropagation(),children:[e.jsxs(X,{onClick:()=>x(s),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(X,{onClick:()=>v(s),className:"text-destructive",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-muted-foreground",children:[(s.stage!=="Meeting"||r)&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Be,{className:"h-3 w-3"})," ",s.contact]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(He,{className:"h-3 w-3"})," ",s.phone]}),(s.stage!=="Meeting"||r)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{className:"h-3 w-3"}),s.value.toLocaleString()]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ae,{className:"h-3 w-3"}),new Date(s.closeDate).toLocaleDateString()]})]})]}),s.stage==="Meeting"&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dashed space-y-2",children:s.meetingDate?s.meetingStatus!=="done"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-semibold",children:"Meeting Scheduled:"}),e.jsx("p",{children:ce(new Date(s.meetingDate),"PPp")})]}),e.jsx(p,{size:"sm",className:"w-full h-8 bg-green-600 hover:bg-green-700",onClick:B,children:"Meeting Finished"})]}):e.jsxs(ie,{className:"bg-green-100 text-green-800 border-green-200 w-full justify-center py-1",children:[e.jsx(is,{className:"h-3 w-3 mr-1"}),"Meeting Done"]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(Re,{htmlFor:`meeting-date-${s.id}`,className:"text-xs text-muted-foreground",children:"Schedule Meeting"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{id:`meeting-date-${s.id}`,type:"datetime-local",className:"h-8 text-xs",value:b,onChange:a=>L(a.target.value),onClick:a=>a.stopPropagation()}),e.jsx(p,{size:"sm",className:"h-8 px-2",onClick:I,disabled:!b,children:"Set"})]})]})})]}),e.jsx($e,{children:r&&e.jsx(le.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("h4",{className:"text-xs font-semibold uppercase text-muted-foreground flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"})," Notes"]}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto pr-2",children:s.notes&&s.notes.length>0?[...s.notes].reverse().map(a=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"h-6 w-6",children:e.jsx(Z,{className:"text-xs",children:T(a.authorName)})}),e.jsxs("div",{className:"flex-1 bg-muted/50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-medium",children:H(a.authorName)}),e.jsx("span",{className:"text-muted-foreground",children:rs(new Date(a.createdAt),{addSuffix:!0})})]}),e.jsx("p",{className:"text-sm mt-1",children:a.content})]})]},a.id)):e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No notes yet."})}),e.jsxs("div",{className:"flex gap-2 items-start",onClick:a=>a.stopPropagation(),children:[e.jsx(Y,{className:"h-8 w-8 mt-1",children:e.jsx(Z,{className:"text-xs",children:l!=null&&l.displayName?T(l.displayName):"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(cs,{placeholder:"Add a note...",className:"text-sm",rows:2,value:m,onChange:a=>y(a.target.value)}),e.jsxs(p,{size:"sm",className:"mt-2",onClick:z,disabled:!m.trim(),children:[e.jsx(ms,{className:"h-3 w-3 mr-2"})," Add Note"]})]})]})]})})})]})})},se=({title:s,opportunities:x,onEdit:v,onDelete:r,expandedOppId:h,setExpandedOppId:n,isSearchable:u,searchTerm:w,onSearchChange:N,hasMore:C,onLoadMore:D,totalCount:g})=>{const{setNodeRef:f}=re({id:s});return e.jsxs("div",{ref:f,className:"w-72 flex-shrink-0 bg-muted/50 rounded-xl flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center justify-between",children:[s,e.jsx(ie,{variant:"secondary",children:g!==void 0?g:x.length})]}),u&&e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search leads...",value:w,onChange:l=>N==null?void 0:N(l.target.value),className:"pl-8 h-8"})]})]}),e.jsx(Ze,{items:x.map(l=>l.id),strategy:es,children:e.jsxs("div",{className:"p-2 flex-1 overflow-y-auto",children:[x.map(l=>e.jsx(de,{opportunity:l,onEdit:v,onDelete:r,isExpanded:h===l.id,onExpand:()=>n(h===l.id?null:l.id)},l.id)),C&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(p,{variant:"ghost",size:"sm",onClick:D,children:"Load More"})})]})})]})};function ys(){const{opportunities:s,updateOpportunity:x,addOpportunity:v,deleteOpportunity:r,loading:h,addOpportunitiesFromContacts:n}=ne(),{contacts:u,loading:w}=Oe();Le();const[N,C]=d.useState(null),[D,g]=d.useState(!1),[f,l]=d.useState(null),[m,y]=d.useState(null),[b,L]=d.useState(null),[k,z]=d.useState(""),[I,B]=d.useState(15),H=_e(Ke(Ye,{activationConstraint:{distance:8}}));d.useEffect(()=>{if(!(h||w)&&u.length>0){const t=u.filter(c=>c.callHistory&&c.callHistory.some(i=>i.feedback==="Interested"));t.length>0&&n(t)}},[u,h,w]);const T=d.useMemo(()=>s.filter(t=>t.stage!=="Closed Won"&&t.stage!=="Closed Lost").reduce((t,c)=>t+c.value,0),[s]),a=d.useMemo(()=>s.filter(t=>t.stage==="Closed Won").reduce((t,c)=>t+c.value,0),[s]),P=t=>{const{active:c}=t;C(s.find(i=>i.id===c.id)||null),L(null)},me=()=>{C(null)},xe={sideEffects:Xe({styles:{active:{opacity:"0.5"}}})},he=t=>{const{active:c,over:i}=t;if(C(null),!i)return;const j=c.id,o=i.id;if(j===o)return;const O=s.find($=>$.id===j);if(!O)return;const F=ee.includes(o),S=s.find($=>$.id===o),R=F?o:S==null?void 0:S.stage;R&&O.stage!==R&&x(j,{stage:R})},ue=async t=>{f?await x(f.id,t):await v(t),g(!1),l(null)},K=()=>{g(!1),l(null)},G=t=>{l(t),g(!0)},J=t=>{y(t)},ge=()=>{m&&(r(m.id),y(null))};return h||w?e.jsx(as,{}):e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsx(le.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sales Opportunities"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your sales pipeline from lead to close."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(U,{className:"w-52",children:e.jsxs(_,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Total Pipeline Value"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs("div",{className:"text-xl font-bold",children:["â‚¹",T.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["from ",s.filter(t=>t.stage!=="Closed Won"&&t.stage!=="Closed Lost").length," opportunities"]})]})}),e.jsx(U,{className:"w-52",children:e.jsxs(_,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Total Won Value"}),e.jsx(os,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs("div",{className:"text-xl font-bold text-green-600",children:["â‚¹",a.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["from ",s.filter(t=>t.stage==="Closed Won").length," deals"]})]})})]}),e.jsxs(ke,{open:D,onOpenChange:t=>{t?g(!0):K()},children:[e.jsx(Me,{asChild:!0,children:e.jsxs(p,{variant:"focus",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"})," New Opportunity"]})}),e.jsxs(Te,{children:[e.jsx(Pe,{children:e.jsx(Fe,{children:f?"Edit Opportunity":"Create New Opportunity"})}),e.jsx(us,{opportunity:f||void 0,onSubmit:ue,onCancel:K})]})]})]})]})}),e.jsxs(Ge,{sensors:H,onDragStart:P,onDragEnd:he,onDragCancel:me,collisionDetection:Je,children:[e.jsx("div",{className:"flex-1 flex gap-6 overflow-x-auto pb-4",children:ee.map(t=>{let c=s.filter(i=>i.stage===t);if(t==="Meeting"&&c.sort((i,j)=>{const o=S=>S.meetingStatus==="done"?3:S.meetingDate&&S.meetingStatus==="scheduled"?1:2,O=o(i),F=o(j);return O!==F?O-F:O===1&&i.meetingDate&&j.meetingDate?new Date(i.meetingDate).getTime()-new Date(j.meetingDate).getTime():0}),t==="Interested Lead"){const i=c.filter(o=>o.title.toLowerCase().includes(k.toLowerCase())||o.contact.toLowerCase().includes(k.toLowerCase())),j=i.slice(0,I);return e.jsx(se,{title:t,opportunities:j,onEdit:G,onDelete:J,expandedOppId:b,setExpandedOppId:L,isSearchable:!0,searchTerm:k,onSearchChange:z,hasMore:i.length>I,onLoadMore:()=>B(o=>o+15),totalCount:i.length},t)}return e.jsx(se,{title:t,opportunities:c,onEdit:G,onDelete:J,expandedOppId:b,setExpandedOppId:L},t)})}),e.jsx(Qe,{dropAnimation:xe,children:N?e.jsx(de,{opportunity:N,onEdit:()=>{},onDelete:()=>{},isExpanded:!1,onExpand:()=>{}}):null})]}),e.jsx(ns,{open:!!m,onOpenChange:t=>!t&&y(null),onConfirm:ge,title:"Delete Opportunity",itemName:m==null?void 0:m.title})]})}export{ys as default};
