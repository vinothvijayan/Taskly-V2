rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow reads and writes for chat attachments if the user is a participant in the chat
    match /chat_attachments/{chatRoomId}/{fileName} {
      allow read, write: if request.auth != null && 
                           (request.auth.uid == chatRoomId.split('_')[0] || 
                            request.auth.uid == chatRoomId.split('_')[1]);
    }
    
    // Allow reads and writes for meetly audio if the user is the owner
    match /meetly-audio/{userId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Allow reads and writes for journal audio if the user is the owner
    match /journal-audio/{userId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Allow reads for journal exports if the user is the owner
    match /journal-exports/{userId}/{fileName} {
      allow read: if request.auth != null && request.auth.uid == userId;
    }
  }
}